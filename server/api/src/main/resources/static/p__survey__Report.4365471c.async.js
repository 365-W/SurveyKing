(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5349],{66640:function(L,P,e){"use strict";e.r(P),e.d(P,{Report:function(){return $},default:function(){return ft}});var s=e(67294),B=e(72625),F=e(77613),N=e(72706),y=(0,s.createContext)({}),I=y.Provider,St=y.Consumer;function Q(r){var i=["Radio","Checkbox","Cascader","Select","QuestionSet"];if(i.includes(r.type))return!0;if(r.type==="FillBlank"||r.type==="MultipleBlank"){var a;if((a=r.children)!==null&&a!==void 0&&a.find(function(n){var o;return((o=n.attribute)===null||o===void 0?void 0:o.dataType)==="number"}))return!0}return!1}var U={Radio:"\u5355\u9009\u9898",Checkbox:"\u591A\u9009\u9898",Cascader:"\u7EA7\u8054\u9898",Select:"\u4E0B\u62C9\u9898",FillBlank:"\u5355\u884C\u6587\u672C\u9898",Textarea:"\u591A\u884C\u6587\u672C\u9898",MultipleBlank:"\u591A\u9879\u586B\u7A7A\u9898"},W=e(69610),z=e(54941),M=function(){function r(){(0,W.Z)(this,r),this._init=this._init.bind(this),this._cleanUp=this._cleanUp.bind(this),this.convertFromInput=this.convertFromInput.bind(this)}return(0,z.Z)(r,[{key:"_init",value:function(){this.canvas=document.createElement("canvas"),this.imgPreview=document.createElement("img"),this.imgPreview.style="position: absolute; top: -9999px",document.body.appendChild(this.imgPreview),this.canvasCtx=this.canvas.getContext("2d")}},{key:"_cleanUp",value:function(){document.body.removeChild(this.imgPreview)}},{key:"convertFromInput",value:function(a,n){this._init();var o=this;this.imgPreview.onload=function(){var f=new Image;o.canvas.width=o.imgPreview.clientWidth,o.canvas.height=o.imgPreview.clientHeight,f.crossOrigin="anonymous",f.src=o.imgPreview.src,f.onload=function(){o.canvasCtx.drawImage(f,0,0);var l=o.canvas.toDataURL("image/png");typeof n=="function"&&n(l),o._cleanUp()}},this.imgPreview.src=a}}]),r}(),w=e(11628),t=e(85893),A=function(i){var a;return i?(a=i.children)===null||a===void 0?void 0:a.filter(function(n){return Q(n)}).map(function(n){return n.type==="QuestionSet"?(0,t.jsx)(G,{schema:n},n.id):(0,t.jsx)(it,{schema:n},n.id)}):(0,t.jsx)(t.Fragment,{})},H=(0,F.P)(function(){var r=(0,w.IE)(),i=r.schema;return(0,t.jsx)("div",{children:A(i)})}),G=function(i){return(0,t.jsx)("div",{children:A(i.schema)})},Ct=e(13062),D=e(71230),Ft=e(66456),V=e(48995),It=e(89032),p=e(15746),Zt=e(57663),j=e(71577),K=e(94657),X=e(3375),J=e(68023),Y=e(96262),k=e(24894),q=e(79110),_=e(8690),tt=e(17813),et=e(79164),nt=e(19076),rt=e(23163);J.D([_.N,tt.N,et.N,k.N,q.N,rt.N,nt.N]);var S=[{color:"#5398ff"},{color:"#39d2d9"},{color:"#f16b79"},{color:"#b18160"},{color:"#94ed8c"},{color:"#ffb878"},{color:"#99a4ff"},{color:"#808bea"},{color:"#c36cff"}],at=(0,s.forwardRef)(function(r,i){var a=r.data,n=r.labels,o=r.loading,f=r.name,l=r.type,Z=(0,s.useRef)(null),c=(0,s.useRef)();return(0,s.useEffect)(function(){if(Z.current){var m=Y.S1(Z.current);return c.current=m,function(){m.dispose()}}},[]),(0,s.useImperativeHandle)(i,function(){return{saveAsImage:function(){var d;return(d=c.current)===null||d===void 0?void 0:d.getDataURL({type:"png"})}}}),(0,s.useEffect)(function(){!o&&c.current?(c.current.hideLoading(),c.current.clear(),l==="horizontalBar"?c.current.setOption({title:{text:f},tooltip:{show:!0,trigger:"item"},xAxis:{show:!1},yAxis:{type:"category",data:n,inverse:!0},series:[{type:"bar",barWidth:15,data:a==null?void 0:a.map(function(m,d){return{value:m,itemStyle:S[d%S.length]}}),showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"}}]}):l==="pie"?c.current.setOption({title:{text:f},tooltip:{show:!0,trigger:"item"},series:[{name:f,type:"pie",radius:"60%",data:a==null?void 0:a.map(function(m,d){return{value:m,name:n[d],itemStyle:S[d%S.length]}}),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},labelLine:{length:10,length2:25}}]}):l==="bar"&&c.current.setOption({title:{text:f},tooltip:{show:!0,trigger:"item"},xAxis:{type:"category",data:n,axisLabel:{interval:0,rotate:30}},yAxis:{show:!1},series:[{type:"bar",barWidth:15,data:a==null?void 0:a.map(function(m,d){return{value:m,itemStyle:S[d%S.length]}}),showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"}}]})):c.current&&c.current.showLoading()},[o,l,a]),(0,t.jsx)("div",{ref:Z,style:{height:300}})}),E=e(76826),it=(0,F.P)(function(r){var i,a,n=r.schema,o=(0,s.useContext)(y),f=o.loading,l=o.reportData,Z=(0,s.useState)("horizontalBar"),c=(0,K.Z)(Z,2),m=c[0],d=c[1],b=(l==null||(i=l.statistics[n.id])===null||i===void 0?void 0:i.total)||0,O=(0,s.useRef)(null),mt=(0,s.useMemo)(function(){return n.type==="FillBlank"?[{title:"\u5408\u8BA1",dataIndex:"sum",width:"25%"},{title:"\u5E73\u5747\u503C",dataIndex:"average",width:"25%"},{title:"\u6700\u9AD8\u503C",dataIndex:"max",width:"25%"},{title:"\u6700\u4F4E\u503C",dataIndex:"min",width:"25%"}]:[{title:"\u9009\u9879",dataIndex:"title",width:"50%"},{title:"\u6570\u636E\u91CF",dataIndex:"total",width:"25%",sorter:function(u,v){return u.total-v.total},showSorterTooltip:!1},{title:"\u5360\u6BD4",dataIndex:"percent",width:"25%",sorter:function(u,v){return parseFloat(u.percent)-parseFloat(v.percent)},showSorterTooltip:!1}]},[n.type]),xt=function(){var u,v=(u=O.current)===null||u===void 0?void 0:u.saveAsImage();v&&new M().convertFromInput(v,function(g){var x=document.createElement("a");x.href=g,x.download="haha.png",x.click(),x.remove()})},gt=function(){var u;return(u=n.children)===null||u===void 0?void 0:u.map(function(v){var g=v.id,x=v.title,h=l==null?void 0:l.statistics[g];if(h){var C=h.total||0,jt=(C/(b||1)*100).toFixed(2)+"%";return{id:g,title:(0,E.WO)(x),total:C,percent:jt,min:h.min,max:h.max,average:h.average,sum:h.sum}}return{id:g,title:(0,E.WO)(x),total:0,percent:"0%"}})},yt=function(){var u,v;if(n.type==="FillBlank"||n.type==="MatrixFillBlank")return(0,t.jsx)(t.Fragment,{});var g=((u=n.children)===null||u===void 0?void 0:u.map(function(h){return(0,E.WO)(h.title)}))||[],x=((v=n.children)===null||v===void 0?void 0:v.map(function(h){var C;return(l==null||(C=l.statistics[h.id])===null||C===void 0?void 0:C.total)||0}))||[];return(0,t.jsxs)(p.Z,{span:24,className:"question-chart",children:[(0,t.jsx)("div",{className:"question-chart-btns",children:(0,t.jsxs)(j.Z.Group,{size:"small",children:[(0,t.jsx)(j.Z,{type:"link",onClick:function(){return d("horizontalBar")},children:"\u6761\u5F62\u56FE"}),(0,t.jsx)(j.Z,{type:"link",onClick:function(){return d("bar")},children:"\u67F1\u5F62\u56FE"}),(0,t.jsx)(j.Z,{type:"link",onClick:function(){return d("pie")},children:"\u6247\u5F62\u56FE"}),(0,t.jsx)(j.Z,{type:"link",icon:(0,t.jsx)("div",{className:"divider"})}),(0,t.jsx)(j.Z,{type:"link",icon:(0,t.jsx)(X.Z,{}),onClick:xt})]})}),(0,t.jsx)("div",{children:(0,t.jsx)(at,{type:m,loading:f,labels:g,data:x,ref:O})})]})},pt=function(){return(0,t.jsx)(p.Z,{span:24,children:(0,t.jsx)(V.Z,{pagination:!1,size:"small",bordered:!0,columns:mt,rowKey:"id",dataSource:gt()})})};return(0,t.jsx)("div",{className:"question-item",children:(0,t.jsxs)(D.Z,{gutter:[12,12],className:"question-content",children:[(0,t.jsx)(p.Z,{xs:24,sm:12,children:(0,t.jsxs)(D.Z,{children:[(0,t.jsx)(p.Z,{span:24,children:(0,t.jsx)("span",{className:"question-label",children:(0,E.WO)(n.title)})}),yt()]})}),(0,t.jsx)(p.Z,{xs:24,sm:12,children:(0,t.jsxs)(D.Z,{children:[(0,t.jsx)(p.Z,{span:24,children:(0,t.jsx)("div",{className:"question-title",children:(0,t.jsxs)("div",{className:"question-data-desc",children:[(0,t.jsxs)("div",{children:["\u7C7B\u578B\uFF1A",U[n.type]]}),(0,t.jsxs)("div",{children:["\u5FC5\u586B\uFF1A",(a=n.attribute)!==null&&a!==void 0&&a.required?"\u662F":"\u5426"]}),(0,t.jsxs)("div",{children:[b,"\u6761\u6570\u636E"]})]})})}),pt()]})})]})})}),Rt=e(59250),ot=e(13013),Pt=e(30887),T=e(54689),Bt=e(47673),st=e(4107),lt=e(19957),ut=e(83663),dt=st.Z.Search,ct=(0,F.P)(function(){var r=(0,s.useContext)(y),i=r.reportData,a=(0,t.jsxs)(T.Z,{children:[(0,t.jsx)(T.Z.Item,{children:"\u6309\u6570\u636E\u5185\u5BB9\u7B5B\u9009"}),(0,t.jsx)(T.Z.Item,{children:"\u6309\u63D0\u4EA4\u65E5\u671F\u7B5B\u9009"})]});return(0,t.jsxs)("div",{className:"report-header",children:[(0,t.jsxs)("span",{children:["\u5171",(i==null?void 0:i.total)||0,"\u6761\u6570\u636E"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(dt,{size:"small",placeholder:"\u641C\u7D22",onSearch:function(o){r.loadReportData(o)},style:{width:200,marginRight:10}}),(0,t.jsx)(ot.Z,{overlay:a,placement:"bottomRight",children:(0,t.jsx)(lt.Z,{style:{cursor:"pointer"}})})]}),(0,t.jsx)(ut.Z,{})]})}),vt=function(){return(0,t.jsx)(ct,{})},ht=function(){return(0,t.jsx)("div",{className:"report-container",children:(0,t.jsx)(H,{})})},$=(0,F.P)(function(){var r=(0,w.IE)(),i=(0,s.useMemo)(function(){return new N.Cu(r)},[r]);return(0,s.useEffect)(function(){i.loadReportData()},[]),(0,t.jsx)("div",{className:"survey-report",children:(0,t.jsxs)(I,{value:i,children:[(0,t.jsx)(vt,{}),(0,t.jsx)(ht,{})]})})}),ft=$},11628:function(L,P,e){"use strict";e.d(P,{xI:function(){return B},Ge:function(){return y},IE:function(){return N}});var s=e(67294),B=(0,s.createContext)({}),F=B.Provider;function N(){var I=(0,s.useContext)(B);return I.store}function y(){var I=N();return I.flowStore}}}]);
