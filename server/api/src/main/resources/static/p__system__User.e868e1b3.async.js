(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7915],{64317:function(pe,re,e){"use strict";var Ee=e(22122),Q=e(28991),Pe=e(81253),S=e(67294),p=e(79976),se=e(22270),X=e(66758),ve=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],ce=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],me=S.forwardRef(function(m,le){var b=m.fieldProps,oe=m.children,_=m.params,ue=m.proFieldProps,k=m.mode,U=m.valueEnum,q=m.request,y=m.showSearch,M=m.options,ee=(0,Pe.Z)(m,ve),N=(0,S.useContext)(X.Z);return S.createElement(p.Z,(0,Ee.Z)({mode:"edit",valueEnum:(0,se.h)(U),request:q,params:_,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,Q.Z)({options:M,mode:k,showSearch:y,getPopupContainer:N.getPopupContainer},b),ref:le,proFieldProps:ue},ee),oe)}),Y=S.forwardRef(function(m,le){var b=m.fieldProps,oe=m.children,_=m.params,ue=m.proFieldProps,k=m.mode,U=m.valueEnum,q=m.request,y=m.options,M=(0,Pe.Z)(m,ce),ee=(0,Q.Z)({options:y,mode:k||"multiple",labelInValue:!0,showSearch:!0,showArrow:!1,autoClearSearchValue:!0,optionLabelProp:"label"},b),N=(0,S.useContext)(X.Z);return S.createElement(p.Z,(0,Ee.Z)({mode:"edit",valueEnum:(0,se.h)(U),request:q,params:_,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,Q.Z)({getPopupContainer:N.getPopupContainer},ee),ref:le,proFieldProps:ue},M),oe)}),P=me,u=Y,ae=P;ae.SearchSelect=u,ae.displayName="ProFormComponent",re.Z=ae},50727:function(pe,re,e){"use strict";var Ee=e(9715),Q=e(86835),Pe=e(57663),S=e(71577),p=e(22122),se=e(96156),X=e(28481),ve=e(81253),ce=e(87757),me=e.n(ce),Y=e(92137),P=e(28991),u=e(67294),ae=e(21770),m=e(49101),le=e(26369),b=e(22270),oe=e(48171),_=e(60249),ue=e(48526),k=e(80355),U=e(97462),q=e(88306),y=e(8880),M=["onTableChange","maxLength","formItemProps","recordCreatorProps","rowKey","controlled","defaultValue","onChange","editableFormRef"],ee=["record","position","creatorButtonText","newRecordType","parentKey","style"],N=u.createContext(void 0);function ge(t){var B=t.children,G=t.record,O=t.position,ie=t.newRecordType,ye=t.parentKey,D=(0,u.useContext)(N);return u.cloneElement(B,(0,P.Z)((0,P.Z)({},B.props),{},{onClick:function(){var L=(0,Y.Z)(me().mark(function z(De){var te,H,V,a;return me().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,(te=(H=B.props).onClick)===null||te===void 0?void 0:te.call(H,De);case 2:if(a=T.sent,a!==!1){T.next=5;break}return T.abrupt("return");case 5:D==null||(V=D.current)===null||V===void 0||V.addEditRecord(G,{position:O,newRecordType:ie,parentKey:ye});case 6:case"end":return T.stop()}},z)}));function W(z){return L.apply(this,arguments)}return W}()}))}function Ce(t){var B,G,O=t.onTableChange,ie=t.maxLength,ye=t.formItemProps,D=t.recordCreatorProps,L=t.rowKey,W=t.controlled,z=t.defaultValue,De=t.onChange,te=t.editableFormRef,H=(0,ve.Z)(t,M),V=(0,le.Z)(t.value),a=(0,u.useRef)(),Z=(0,u.useRef)();(0,u.useImperativeHandle)(H.actionRef,function(){return a.current});var T=(0,ae.Z)(function(){return t.value||z||[]},{value:t.value,onChange:t.onChange}),Ze=(0,X.Z)(T,2),c=Ze[0],Re=Ze[1],h=u.useMemo(function(){return typeof L=="function"?L:function(d,r){return d[L]||r}},[L]),A=function(r){if(typeof r=="number"&&!t.name){if(r>=c.length)return r;var i=c==null?void 0:c.at(r);return h==null?void 0:h(i,r)}if((typeof r=="string"||r>=c.length)&&t.name){var n=c.findIndex(function(l,o){var s;return(h==null||(s=h(l,o))===null||s===void 0?void 0:s.toString())===(r==null?void 0:r.toString())});return n}return r};(0,u.useImperativeHandle)(te,function(){var d=function(n){var l,o;if(n==null)throw new Error("rowIndex is required");var s=A(n),f=[t.name,(l=s==null?void 0:s.toString())!==null&&l!==void 0?l:""].flat(1).filter(Boolean);return(o=Z.current)===null||o===void 0?void 0:o.getFieldValue(f)},r=function(){var n,l=[t.name].flat(1).filter(Boolean);if(Array.isArray(l)&&l.length===0){var o,s=(o=Z.current)===null||o===void 0?void 0:o.getFieldsValue();return Array.isArray(s)?s:Object.keys(s).map(function(f){return s[f]})}return(n=Z.current)===null||n===void 0?void 0:n.getFieldValue(l)};return(0,P.Z)((0,P.Z)({},Z.current),{},{getRowData:d,getRowsData:r,setRowData:function(n,l){var o,s,f,C;if(n==null)throw new Error("rowIndex is required");var $=A(n),j=[t.name,(o=$==null?void 0:$.toString())!==null&&o!==void 0?o:""].flat(1).filter(Boolean),Oe=((s=Z.current)===null||s===void 0||(f=s.getFieldsValue)===null||f===void 0?void 0:f.call(s))||{},Fe=(0,y.Z)(Oe,j,(0,P.Z)((0,P.Z)({},d(n)),l||{}));return(C=Z.current)===null||C===void 0?void 0:C.setFieldsValue(Fe)}})}),(0,u.useEffect)(function(){!t.controlled||c.forEach(function(d,r){var i;(i=Z.current)===null||i===void 0||i.setFieldsValue((0,se.Z)({},h(d,r),d))},{})},[c,t.controlled]),(0,u.useEffect)(function(){if(t.name){var d;Z.current=(d=t.editable)===null||d===void 0?void 0:d.form}},[(B=t.editable)===null||B===void 0?void 0:B.form,t.name]);var v=D||{},g=v.record,J=v.position,w=v.creatorButtonText,x=v.newRecordType,he=v.parentKey,de=v.style,I=(0,ve.Z)(v,ee),ne=J==="top",K=(0,u.useMemo)(function(){return ie&&ie<=(c==null?void 0:c.length)?!1:D!==!1&&u.createElement(ge,{record:(0,b.h)(g,c==null?void 0:c.length,c)||{},position:J,parentKey:(0,b.h)(he,c==null?void 0:c.length,c),newRecordType:x},u.createElement(S.Z,(0,p.Z)({type:"dashed",style:(0,P.Z)({display:"block",margin:"10px 0",width:"100%"},de),icon:u.createElement(m.Z,null)},I),w||"\u6DFB\u52A0\u4E00\u884C\u6570\u636E"))},[D,ie,c==null?void 0:c.length]),F=(0,u.useMemo)(function(){return K?ne?{components:{header:{wrapper:function(r){var i,n=r.className,l=r.children;return u.createElement("thead",{className:n},l,u.createElement("tr",{style:{position:"relative"}},u.createElement("td",{colSpan:0,style:{visibility:"hidden"}},K),u.createElement("td",{style:{position:"absolute",left:0,width:"100%"},colSpan:(i=H.columns)===null||i===void 0?void 0:i.length},K)))}}}}:{tableViewRender:function(r,i){var n,l;return u.createElement(u.Fragment,null,(n=(l=t.tableViewRender)===null||l===void 0?void 0:l.call(t,r,i))!==null&&n!==void 0?n:i,K)}}:{}},[ne,K]),E=(0,P.Z)({},t.editable),R=(0,oe.J)(function(d,r){var i,n,l;if((i=t.editable)===null||i===void 0||(n=i.onValuesChange)===null||n===void 0||n.call(i,d,r),(l=t.onValuesChange)===null||l===void 0||l.call(t,r,d),t.controlled){var o;t==null||(o=t.onChange)===null||o===void 0||o.call(t,r)}});return((t==null?void 0:t.onValuesChange)||((G=t.editable)===null||G===void 0?void 0:G.onValuesChange)||t.controlled&&(t==null?void 0:t.onChange))&&(E.onValuesChange=R),u.createElement(u.Fragment,null,u.createElement(N.Provider,{value:a},u.createElement(k.Z,(0,p.Z)({search:!1,options:!1,pagination:!1,rowKey:L,revalidateOnFocus:!1},H,F,{tableLayout:"fixed",actionRef:a,onChange:O,editable:(0,P.Z)((0,P.Z)({},E),{},{formProps:(0,P.Z)({formRef:Z},E.formProps)}),dataSource:c,onDataSourceChange:function(r){if(Re(r),t.name&&J==="top"){var i,n=(0,y.Z)({},[t.name].flat(1).filter(Boolean),r);(i=Z.current)===null||i===void 0||i.setFieldsValue(n)}}}))),t.name?u.createElement(U.Z,{name:[t.name]},function(d){var r,i,n=(0,q.Z)(d,[t.name].flat(1)),l=n==null?void 0:n.find(function(o,s){return!(0,_.Z)(o,V==null?void 0:V[s])});return l&&(t==null||(r=t.editable)===null||r===void 0||(i=r.onValuesChange)===null||i===void 0||i.call(r,l,n)),null}):null)}function fe(t){return t.name?u.createElement(Q.Z.Item,(0,p.Z)({style:{maxWidth:"100%"}},t==null?void 0:t.formItemProps,{name:t.name}),u.createElement(ue.Field,{shouldUpdate:!0,name:t.name,isList:!0},function(B,G,O){return u.createElement(Ce,(0,p.Z)({},t,{editable:(0,P.Z)((0,P.Z)({},t.editable),{},{form:O}),value:B.value||[],onChange:B.onChange}))})):u.createElement(Ce,t)}fe.RecordCreator=ge,re.Z=fe},94593:function(pe,re,e){"use strict";e.r(re),e.d(re,{default:function(){return Re}});var Ee=e(13062),Q=e(71230),Pe=e(57663),S=e(71577),p=e(3182),se=e(89032),X=e(15746),ve=e(59250),ce=e(13013),me=e(30887),Y=e(28682),P=e(34792),u=e(48086),ae=e(47673),m=e(4107),le=e(71194),b=e(50146),oe=e(49111),_=e(19650),ue=e(71153),k=e(60331),U=e(94657),q=e(94043),y=e.n(q),M=e(36602),ee=e(57254),N=e(49101),ge=e(70844),Ce=e(16894),fe=e(77613),t=e(67294),B=e(43358),G=e(34041),O=e(11849),ie=e(62999),ye=e(54680),D=e(952),L=e(71975),W=e(5966),z=e(64317),De=e(86468),te=e(60780),H=e.n(te),V=e(50727),a=e(85893),Z=(0,fe.P)(function(h){var A,v=h.user,g=h.readonly,J=h.onClose,w=h.onOk,x=(0,M.m2)(),he=(0,t.useRef)(),de=v==null||(A=v.roles)===null||A===void 0?void 0:A.map(function(n){return n.id}),I=!!(v!=null&&v.id),ne=x.depts,K=x.positions,F=(0,t.useState)(function(){var n;return(v==null||(n=v.userPositions)===null||n===void 0?void 0:n.map(function(l){return l.id}))||[]}),E=(0,U.Z)(F,2),R=E[0],d=E[1],r=(0,t.useMemo)(function(){return H()(ne.map(function(n){return{value:n.id,title:n.name,key:n.id,parentId:n.parentId}}),{parentProperty:"parentId",customID:"value"})},[ne]);(0,t.useEffect)(function(){K.length===0&&x.loadPositions({pageSize:1024})},[]);var i=[{title:"\u673A\u6784\u540D\u79F0",dataIndex:"deptId",width:"30%",renderFormItem:function(l,o,s){var f=o.type,C=o.defaultRender,$=o.fieldProps;return f==="form"?(0,a.jsx)(ye.Z,(0,O.Z)((0,O.Z)({allowClear:!0,treeData:r},$),{},{placeholder:"\u8BF7\u9009\u62E9\u673A\u6784"})):C(l)}},{title:"\u5C97\u4F4D\u540D\u79F0",dataIndex:"positionId",width:"50%",renderFormItem:function(l,o,s){var f=o.type,C=o.defaultRender;return f==="form"?(0,a.jsx)(G.Z,{options:K.map(function($){return{label:$.name,value:$.id}}),placeholder:"\u8BF7\u9009\u62E9\u5C97\u4F4D"}):C(l)}},{title:"\u64CD\u4F5C",valueType:"option",width:200}];return(0,a.jsxs)(L.a,{title:g?"\u7CFB\u7EDF\u7528\u6237\u8BE6\u60C5":I?"\u4FEE\u6539\u7528\u6237":"\u65B0\u5EFA\u7528\u6237",formRef:he,visible:!0,initialValues:(0,O.Z)((0,O.Z)({},v),{},{roles:de}),submitter:{submitButtonProps:{style:{display:g?"none":"block"}}},drawerProps:{forceRender:!0,destroyOnClose:!0,onClose:function(){J()}},onFinish:function(){var n=(0,p.Z)(y().mark(function l(o){var s;return y().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,x.saveOrUpdateUser((0,O.Z)((0,O.Z)({},v),o));case 2:s=C.sent,s.success&&w();case 4:case"end":return C.stop()}},l)}));return function(l){return n.apply(this,arguments)}}(),children:[(0,a.jsxs)(D.ZP.Group,{children:[(0,a.jsx)(W.Z,{name:"name",width:"md",label:"\u7528\u6237\u540D",tooltip:"\u6700\u957F\u4E3A 24 \u4F4D",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",readonly:g,required:!0,rules:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,a.jsx)(W.Z,{width:"md",readonly:g,name:"username",label:"\u767B\u5F55\u540D",placeholder:"\u8BF7\u8F93\u5165\u767B\u5F55\u8D26\u6237\u540D\u79F0",rules:[{required:!0,message:"\u767B\u5F55\u540D\u4E0D\u80FD\u4E3A\u7A7A"},{validator:function(){var n=(0,p.Z)(y().mark(function o(s,f){var C;return y().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(f!==(v==null?void 0:v.username)){j.next=2;break}return j.abrupt("return");case 2:return j.next=4,M.hi.checkUsernameExist(f);case 4:if(C=j.sent,!C){j.next=7;break}throw new Error("\u767B\u5F55\u540D\u5DF2\u5B58\u5728!");case 7:case"end":return j.stop()}},o)}));function l(o,s){return n.apply(this,arguments)}return l}()}],required:!0})]}),!I&&(0,a.jsxs)(D.ZP.Group,{children:[(0,a.jsx)(W.Z.Password,{width:"md",readonly:g,name:"password",label:"\u8F93\u5165\u5BC6\u7801",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",rules:[{required:!I,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],required:!I}),(0,a.jsx)(W.Z.Password,{width:"md",readonly:g,name:"rePassword",label:"\u786E\u8BA4\u5BC6\u7801",placeholder:"\u518D\u6B21\u8F93\u5165\u5BC6\u7801",rules:[{required:!I,message:"\u786E\u8BA4\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A!"},function(n){var l=n.getFieldValue;return{validator:function(s,f){return!f||l("password")===f?Promise.resolve():Promise.reject(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4!"))}}}],required:!I})]}),(0,a.jsxs)(D.ZP.Group,{children:[(0,a.jsx)(z.Z,{readonly:g,options:[{value:"M",label:"\u7537"},{value:"F",label:"\u5973"}],width:"md",name:"gender",label:"\u6027\u522B"}),(0,a.jsx)(z.Z,{readonly:g,required:!0,options:[{value:1,label:"\u6FC0\u6D3B"},{value:0,label:"\u5931\u6D3B"}],width:"md",name:"status",label:"\u72B6\u6001"})]}),(0,a.jsxs)(D.ZP.Group,{children:[(0,a.jsx)(W.Z,{name:"phone",readonly:g,width:"md",label:"\u624B\u673A",placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"}),(0,a.jsx)(W.Z,{width:"md",name:"email",readonly:g,label:"\u90AE\u7BB1",placeholder:"\u8BF7\u8F93\u5165\u90AE\u7BB1",rules:[{type:"email",message:"\u8BF7\u8F93\u5165\u90AE\u7BB1!"}]}),(0,a.jsx)(De.FQ,{name:"deptId",width:"md",treeData:r,label:"\u6240\u5C5E\u90E8\u95E8",placeholder:"\u8BF7\u9009\u62E9\u90E8\u95E8",readonly:g,value:v==null?void 0:v.deptId}),(0,a.jsx)(z.Z,{mode:"tags",readonly:g,request:(0,p.Z)(y().mark(function n(){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",M.hi.loadRoles({current:1,pageSize:1024}).then(function(s){return s.list.map(function(f){return{label:f.name,value:f.id}})}));case 1:case"end":return o.stop()}},n)})),width:"md",name:"roles",label:"\u89D2\u8272\u5217\u8868"})]}),(0,a.jsx)(D.ZP.Group,{children:(0,a.jsx)(D.ZP.Item,{label:"\u9009\u62E9\u5C97\u4F4D",name:"userPositions",trigger:"onValuesChange",children:(0,a.jsx)(V.Z,{rowKey:"id",toolBarRender:!1,columns:i,recordCreatorProps:{newRecordType:"dataSource",position:"top",record:function(){return{id:"".concat(Date.now())}}},editable:{type:"multiple",editableKeys:R,onChange:d,actionRender:function(l,o,s){return[s.delete]}}})})})]})}),T=e(40017),Ze=["magenta","volcano","cyan","blue","geekblue","purple"],c=(0,fe.P)(function(){var h=(0,M.m2)(),A=(0,t.useRef)(),v=(0,t.useRef)(),g=(0,t.useState)(),J=(0,U.Z)(g,2),w=J[0],x=J[1],he=(0,t.useState)(),de=(0,U.Z)(he,2),I=de[0],ne=de[1];(0,t.useEffect)(function(){h.loadUsers({deptId:I})},[I,h]),(0,t.useEffect)(function(){h.loadPermissions()},[h]);var K=[{title:"\u7EC4\u7EC7\u673A\u6784",dataIndex:"deptName",hideInSearch:!0,width:150},{title:"\u59D3\u540D",dataIndex:"name",ellipsis:!0,width:120},{title:"\u89D2\u8272",dataIndex:"role",hideInSearch:!0,width:150,renderFormItem:function(E,R){var d=R.defaultRender;return d(E)},render:function(E,R){var d;return(0,a.jsx)(_.Z,{children:(d=R.roles)===null||d===void 0?void 0:d.map(function(r,i){return(0,a.jsx)(k.Z,{color:Ze[i],children:r.name},r.id)})})}},{title:"\u624B\u673A",dataIndex:"phone",width:150,search:!1},{title:"\u72B6\u6001",dataIndex:"status",search:!1,width:100,valueEnum:{0:{text:"\u5931\u6D3B",status:"Default"},1:{text:"\u6FC0\u6D3B",status:"Processing"}}},{title:"\u521B\u5EFA\u65F6\u95F4",key:"showTime",dataIndex:"createAt",width:150,valueType:"dateTime",hideInSearch:!0},{title:"\u64CD\u4F5C",valueType:"option",render:function(E,R){return[(0,a.jsx)("a",{onClick:function(){x({visible:!0,current:R})},children:"\u7F16\u8F91"},"editable"),(0,a.jsx)(ce.Z,{overlay:(0,a.jsxs)(Y.Z,{onClick:function(r){var i=r.key;i==="resetPwd"?b.Z.confirm({title:"\u91CD\u7F6E\u5BC6\u7801",content:(0,a.jsx)(m.Z.Password,{placeholder:"\u8F93\u5165\u5BC6\u7801",onChange:function(l){return v.current=l.target.value}}),okType:"primary",okText:"\u4FEE\u6539",onOk:function(l){return v.current?(M.hi.updateUser({id:R.id,password:v.current}).then(function(o){o.success&&(u.default.success("\u4FEE\u6539\u6210\u529F"),v.current=void 0,l())}),!1):(u.default.error("\u8BF7\u8F93\u5165\u5BC6\u7801"),!1)}}):i==="delete"&&b.Z.confirm({title:"\u5220\u9664\u7528\u6237",content:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u7528\u6237\u5417\uFF1F",okType:"danger",okText:"\u5220\u9664",onOk:function(){h.deleteUser(R.id).then(function(l){if(l.success){var o;u.default.success("\u5220\u9664\u6210\u529F"),(o=A.current)===null||o===void 0||o.reload()}})}})},children:[(0,a.jsx)(Y.Z.Item,{children:"\u91CD\u7F6E\u5BC6\u7801"},"resetPwd"),(0,a.jsx)(Y.Z.Item,{children:"\u5220\u9664\u7528\u6237"},"delete")]}),children:(0,a.jsxs)("a",{className:"ant-dropdown-link",onClick:function(r){return r.preventDefault()},children:["\u66F4\u591A",(0,a.jsx)(ee.Z,{})]})},"action")]}}];return(0,a.jsx)(ge.ZP,{title:!1,children:(0,a.jsxs)(Q.Z,{gutter:20,children:[(0,a.jsx)(X.Z,{xs:0,md:8,children:(0,a.jsx)(T.A,{onSelect:function(E){return ne(E)}})}),(0,a.jsxs)(X.Z,{xs:24,md:16,children:[(0,a.jsx)(Ce.ZP,{columns:K,actionRef:A,dataSource:h.users,request:function(){var F=(0,p.Z)(y().mark(function E(R){return y().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",h.loadUsers(R));case 1:case"end":return r.stop()}},E)}));return function(E){return F.apply(this,arguments)}}(),columnsState:{persistenceKey:"pro-table-singe-demos",persistenceType:"localStorage"},rowKey:"id",search:{labelWidth:"auto"},pagination:{pageSize:5},scroll:{x:900},dateFormatter:"string",headerTitle:"\u7CFB\u7EDF\u7528\u6237\u5217\u8868",toolBarRender:function(){return[(0,a.jsx)(S.Z,{icon:(0,a.jsx)(N.Z,{}),type:"primary",onClick:function(){x({visible:!0})},children:"\u65B0\u5EFA"},"button")]}}),(w==null?void 0:w.visible)&&(0,a.jsx)(Z,{onClose:function(){x(void 0)},readonly:w.readonly,onOk:function(){var E;x(void 0),(E=A.current)===null||E===void 0||E.reload()},user:w.current})]})]})})}),Re=c}}]);
