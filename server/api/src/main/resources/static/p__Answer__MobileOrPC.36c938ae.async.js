(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835],{22824:function(Ge,G,s){"use strict";s.r(G),s.d(G,{MobileOrPC:function(){return re},default:function(){return $e}});var b=s(11849),M=s(3182),Xe=s(71194),ce=s(50146),Ke=s(57663),D=s(71577),Ye=s(9715),X=s(86835),qe=s(47673),fe=s(4107),z=s(94657),he=s(94043),y=s.n(he),me=s(68068),E=s(28991),p=s(67294),ge={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},pe=ge,K=s(27029),Y=function(a,e){return p.createElement(K.Z,(0,E.Z)((0,E.Z)({},a),{},{ref:e,icon:pe}))};Y.displayName="LockFilled";var we=p.forwardRef(Y),ye={icon:function(a,e){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:e}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:e}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:a}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:a}}]}},name:"eye",theme:"twotone"},je=ye,q=function(a,e){return p.createElement(K.Z,(0,E.Z)((0,E.Z)({},a),{},{ref:e,icon:je}))};q.displayName="EyeTwoTone";var Se=p.forwardRef(q),xe=s(88633),_=s(80937),ee=s(51615),Ie=s(92725),U=s(12997),_e=s(49111),Ce=s(19650),A=s(3980),Te=s(27400),Oe=s(73727),be=s(49914),x=s(87998),r=s(85893),Ae=(0,_.Pi)(function(){var w,a,e=(0,be.H)(),l=(0,Te.a)(),i=e.success,u=(w=e.setting)===null||w===void 0?void 0:w.submittedSetting,v=(a=e.setting)===null||a===void 0?void 0:a.answerSetting.loginRequired,o=e.survey,c=e.id,g=(0,p.useMemo)(function(){return o?(0,x.R6)(o):{}},[o]),t=u||{},Z=t.contentHtml,j=t.redirectUrl,L=t.answerAnalysis,S=t.rankVisible,k=t.transcriptVisible,f=e.answerId,F=e.answerQrCodeUrl,R=e.answerView,C=e.values;(0,p.useEffect)(function(){if(j&&C){if(!j.includes("(")){window.location.href=j;return}var P=(0,x.vW)(j,function(I){var N=(0,x.Op)(I),B=(0,z.Z)(N,2),J=B[0],se=B[1],$=C[J];return(0,x.d0)(g,$,I)});P.success&&(window.location.href=P.result)}},[j,C]),(0,p.useEffect)(function(){i&&o&&C&&R&&(0,x.MA)(o,Z,C,R.examScore)},[Z,i,o,C,R]);var H=function(){var I="";return L&&S?I="\u67E5\u770B\u6392\u540D\u53CA\u89E3\u6790":S?I="\u67E5\u770B\u8003\u8BD5\u6392\u540D":L&&(I="\u67E5\u770B\u7B54\u6848\u89E3\u6790"),I?(0,r.jsx)("div",{children:(0,r.jsx)(D.Z,{onClick:function(){return window.open("/s/".concat(c,"/exam-result/").concat(f))},children:I})}):(0,r.jsx)(r.Fragment,{})};return i?(0,r.jsx)("div",{className:"survey-end animated",children:(0,r.jsx)("div",{className:"survey-end-content",children:(0,r.jsx)("h3",{className:"survey-end-title ",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{id:"result-message"}),H(),(0,r.jsx)("div",{children:v&&(0,r.jsxs)(Ce.Z,{children:[(0,r.jsx)(Oe.rU,{to:"/",children:(0,r.jsx)(D.Z,{type:"link",onClick:function(){},children:"\u8FD4\u56DE\u9996\u9875"})}),(0,r.jsx)(D.Z,{type:"link",onClick:function(){l.logout(),(0,A.on)()},children:"\u9000\u51FA\u5173\u95ED"})]})})]})})})}):(0,r.jsx)(r.Fragment,{})}),Ze=Ae,er=s(34792),Q=s(48086),Le=s(69610),Re=s(54941),n=s(54531),Pe=s(42238),Me=s.n(Pe),Ve=function(){function w(a){var e;(0,Le.Z)(this,w),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.confirmTempAnswerType=0,this.statistics=void 0,this.answerUrl=void 0,this.answerQrCodeUrl=void 0,this.loginRequired=void 0,this.whitelistName=void 0,this.success=void 0,this.answerId=void 0,this.answerView=void 0,this.values=void 0,this.surveyRef=void 0,this.id=a.id,this.answerId=a.answerId,this.surveyRef=a.surveyRef,this.makeObservable(),this.loadProject(),this.confirmTempAnswerType=(e=this.savedAnswer)!==null&&e!==void 0&&e.progress?1:0}return(0,Re.Z)(w,[{key:"makeObservable",value:function(){(0,n.Ou)(this,{id:n.LO.ref,answerId:n.LO.ref,survey:n.LO.ref,loading:n.LO.ref,saving:n.LO.ref,verifying:n.LO.ref,project:n.LO.ref,errorCode:n.LO.ref,errorMessage:n.LO.ref,progress:n.LO.ref,confirmTempAnswerType:n.LO.ref,statistics:n.LO.ref,answerUrl:n.LO.ref,answerQrCodeUrl:n.LO.ref,success:n.LO.ref,answerView:n.LO.ref,values:n.LO.ref,loginRequired:n.LO.ref,whitelistName:n.LO.ref,passwordRequired:n.LO.computed,mode:n.LO.computed,tempSaveId:n.LO.computed,status:n.LO.computed,setting:n.LO.computed,tempSave:n.aD,saveData:n.aD,loadProject:n.aD,changeProgress:n.aD,validate:n.aD})}},{key:"setting",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.setting}},{key:"status",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.status}},{key:"passwordRequired",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.passwordRequired}},{key:"mode",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.mode}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var e=localStorage.getItem(this.tempSaveId);return e&&JSON.parse(e)}},{key:"startTime",get:function(){var e,l,i;return((e=this.savedAnswer)===null||e===void 0||(l=e.metaInfo)===null||l===void 0||(i=l.answerInfo)===null||i===void 0?void 0:i.startTime)||new Date().getTime()}},{key:"tempSave",value:function(e){var l=localStorage.getItem(this.tempSaveId),i;l?(i=JSON.parse(l),i.answer=e,i.progress=this.progress):i={answer:e,metaInfo:{answerInfo:{startTime:new Date().getTime()}},progress:this.progress},localStorage.setItem(this.tempSaveId,JSON.stringify(i))}},{key:"saveData",value:function(){var a=(0,M.Z)(y().mark(function l(i,u){var v,o,c=this,g,t,Z,j,L,S;return y().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.saving=!0,g=new(Me())().getResult(),t={answer:i,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()},clientInfo:{browser:g.browser.name||"",browserVersion:g.browser.version||"",deviceType:g.device.type||"",platform:g.os.name||"",platformVersion:g.os.version||""}},id:u||this.answerId,whitelistName:this.whitelistName},Z=this.startTime,j=((v=this.project)===null||v===void 0||(o=v.setting.examSetting)===null||o===void 0?void 0:o.minSubmitMinutes)||0,L=Z+j*60*1e3,!(j>0&&new Date().getTime()<L)){f.next=10;break}return Q.default.error("\u672A\u5230\u4EA4\u5377\u65F6\u95F4"),this.saving=!1,f.abrupt("return");case 10:return f.next=12,A.hi.post("/api/public/saveAnswer",t);case 12:S=f.sent,(0,n.aD)(function(){S.success?(S.data.answerId?c.answerId=S.data.answerId:S.data.examScore!==void 0,c.answerView=S.data,c.values=i,c.success=!0,localStorage.removeItem(c.tempSaveId)):Q.default.error(S.message),c.saving=!1});case 14:case"end":return f.stop()}},l,this)}));function e(l,i){return a.apply(this,arguments)}return e}()},{key:"loadStatistics",value:function(){var a=(0,M.Z)(y().mark(function l(){var i=this,u;return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.loading){o.next=2;break}return o.abrupt("return");case 2:return this.loading=!0,o.next=5,A.hi.post("/api/public/statistics",{id:this.id});case 5:u=o.sent,(0,n.aD)(function(){u.success&&(i.statistics=u.data),i.loading=!1});case 7:case"end":return o.stop()}},l,this)}));function e(){return a.apply(this,arguments)}return e}()},{key:"loadProject",value:function(){var a=(0,M.Z)(y().mark(function l(){var i=this,u;return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.loading=!0,o.next=3,A.hi.post("/api/public/loadProject",{id:this.id});case 3:u=o.sent,(0,n.aD)(function(){u.success?(i.project=u.data,i.loginRequired=u.data.loginRequired,i.survey=u.data.survey,i.values=u.data.answer,u.data.answerId&&(i.answerId=u.data.answerId)):i.errorMessage=u.message,i.errorCode=u.code,i.loading=!1});case 5:case"end":return o.stop()}},l,this)}));function e(){return a.apply(this,arguments)}return e}()},{key:"validate",value:function(){var a=(0,M.Z)(y().mark(function l(i){var u=this,v;return y().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.verifying=!0,c.next=3,A.hi.post("/api/public/validateProject",{id:this.id,answer:i});case 3:v=c.sent,(0,n.aD)(function(){if(v.success){var g;u.project=v.data,u.loginRequired=!1,u.survey=v.data.survey,u.whitelistName=(g=i.whitelistName)===null||g===void 0?void 0:g.whitelistName}else Q.default.error(v.message);u.verifying=!1});case 5:case"end":return c.stop()}},l,this)}));function e(l){return a.apply(this,arguments)}return e}()},{key:"upload",value:function(){var a=(0,M.Z)(y().mark(function l(i,u){return y().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",A.hi.upload("/api/public/upload",(0,b.Z)({fileType:4,basePath:this.id},i),u));case 1:case"end":return o.stop()}},l,this)}));function e(l,i){return a.apply(this,arguments)}return e}()},{key:"changeProgress",value:function(e){this.progress=e}}]),w}(),re=(0,_.Pi)(function(){var w,a,e=(0,ee.UO)(),l=e.id,i=e.answerId,u=(0,ee.TH)(),v=u.query.preview==="1",o=u.query.openid,c=(0,p.useMemo)(function(){return(0,x.SB)()},[]),g=(0,p.useRef)(null),t=(0,p.useMemo)(function(){return new Ve({id:l,answerId:i,surveyRef:g})},[l,i]),Z=t.saving,j=t.loading,L=(w=t.setting)===null||w===void 0?void 0:w.answerSetting,S=t.loginRequired,k=t.verifying,f=L||{},F=f.autoSave,R=f.progressBar,C=f.initialValues,H=f.questionNumber,P=f.wechatOnly,I=f.onePageOneQuestion,N=f.answerSheetVisible,B=((a=t.setting)===null||a===void 0?void 0:a.examSetting)||{},J=B.exerciseMode,se=t.errorMessage,$=t.savedAnswer,te=t.confirmTempAnswerType,De=t.statistics,V=t.survey,Ee=t.answerId,ae=t.mode,ie=t.success,ne=(0,x.XO)(V,u),ke=(0,p.useState)(),oe=(0,z.Z)(ke,2),ue=oe[0],Fe=oe[1],Ne=(0,p.useState)({}),le=(0,z.Z)(Ne,2),de=le[0],Be=le[1];(0,p.useEffect)(function(){V&&(0,x.iq)(V,"statEnabled")&&t.loadStatistics()},[V,t]);var ze=(0,p.useCallback)(function(T,h){R&&t.changeProgress(h),F&&T&&t.tempSave(T)},[R]),Ue=function(){var h;return(0,r.jsxs)("div",{className:"password-confirm",children:[(0,r.jsx)("h3",{children:(h=t.project)===null||h===void 0?void 0:h.name}),(0,r.jsx)(ce.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,r.jsxs)(X.Z,{style:{margin:"10px 0"},children:[(0,r.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,r.jsx)(X.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:de.validateStatus,help:de.help,children:(0,r.jsx)(fe.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,r.jsx)(we,{}),onChange:function(m){return Fe(m.target.value)},iconRender:function(m){return m?(0,r.jsx)(Se,{}):(0,r.jsx)(xe.Z,{})}})}),(0,r.jsx)(D.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:k,onClick:function(){ue&&t.verifyPassword(ue).then(function(m){m||Be({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},Qe=function(){return(0,r.jsx)(U.BW,{})},ve=function(h){var d,m;return(0,r.jsxs)("div",{className:"render-failure ".concat(c?"mobile":"phone"),children:[((d=t.project)===null||d===void 0?void 0:d.name)&&(0,r.jsx)("div",{className:"title",children:(m=t.project)===null||m===void 0?void 0:m.name}),(0,r.jsxs)("div",{className:"content",children:[(0,r.jsx)("div",{children:(0,r.jsx)(U.AT,{})}),(0,r.jsx)("h2",{children:se||h}),(0,r.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},He=function(){if(ie)return(0,r.jsx)(r.Fragment,{});if(j)return(0,r.jsx)(Ie.Z,{});if(t.errorCode!==200)return ve();if(P&&!(0,x.CL)())return ve("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(S)return(0,r.jsx)("div",{children:Qe()});if(V&&!ie&&!k)return te===1&&F&&ae==="survey"?(0,r.jsx)(U.oq,{}):(0,r.jsx)(me.Z,{ref:g,mode:ae,loading:Z||j,progressBar:R,questionNumber:H,theme:c?"antdMobile":"antd",schema:V,onChange:ze,onePageOneQuestion:I,answerSheetVisible:N,exerciseMode:J,onInit:function(d){t.tempSave(d.values)},onDictSearch:function(){var h=(0,M.Z)(y().mark(function d(m){var W;return y().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,A.hi.loadDict(m);case 2:if(W=O.sent,!W.success){O.next=5;break}return O.abrupt("return",W.data);case 5:return O.abrupt("return",[]);case 6:case"end":return O.stop()}},d)}));return function(d){return h.apply(this,arguments)}}(),initialValues:te===3?ne:(0,b.Z)((0,b.Z)((0,b.Z)((0,b.Z)({},C),F?$==null?void 0:$.answer:{}),ne),t.values),statistics:De,onUpload:function(d,m){return t.upload(d,m)},footerVisible:!v,headerVisible:!v,isPreview:v,onSubmit:function(d){t.saveData((0,b.Z)((0,b.Z)({},d),{},{openid:o}),Ee)}});if(t.passwordRequired)return(0,r.jsx)("div",{children:Ue()})},Je=function(){return(0,r.jsx)(Ze,{})},We=function(){var h,d,m=(h=t.survey)===null||h===void 0||(d=h.attribute)===null||d===void 0?void 0:d.backgroundImage;if(m)return{backgroundImage:"url(/api/public/preview/".concat(m,")")}};return(0,r.jsx)(x.ff.Provider,{value:t,children:(0,r.jsxs)("div",{className:"survey ".concat(c?"mobile":"pc"),style:We(),children:[He(),Je()]})})}),$e=re}}]);
