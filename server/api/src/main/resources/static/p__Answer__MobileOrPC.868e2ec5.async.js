(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835],{36432:function(Be,V,r){"use strict";r.r(V),r.d(V,{MobileOrPC:function(){return Q},default:function(){return ye}});var T=r(11849),ke=r(71194),ee=r(50146),ze=r(57663),re=r(71577),Ue=r(9715),F=r(86835),Qe=r(47673),se=r(4107),N=r(94657),B=r(51615),p=r(67294),b=r(28991),te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},ae=te,k=r(27029),z=function(t,e){return p.createElement(k.Z,(0,b.Z)((0,b.Z)({},t),{},{ref:e,icon:ae}))};z.displayName="LockFilled";var ie=p.forwardRef(z),ne={icon:function(t,e){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:e}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:e}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:t}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:t}}]}},name:"eye",theme:"twotone"},oe=ne,U=function(t,e){return p.createElement(k.Z,(0,b.Z)((0,b.Z)({},t),{},{ref:e,icon:oe}))};U.displayName="EyeTwoTone";var le=p.forwardRef(U),ue=r(88633),de=r(80937),C=r(87998),ve=r(92725),P=r(54781),ce=r(19357),He=r(34792),M=r(48086),L=r(3182),fe=r(69610),he=r(54941),me=r(94043),w=r.n(me),x=r(3980),s=r(54531),ge=r(42238),pe=r.n(ge),we=function(){function y(t){var e;(0,fe.Z)(this,y),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.confirmTempAnswerType=0,this.statistics=void 0,this.answerUrl=void 0,this.answerQrCodeUrl=void 0,this.loginRequired=void 0,this.whitelistName=void 0,this.success=void 0,this.answerId=void 0,this.answerView=void 0,this.values=void 0,this.surveyRef=void 0,this.id=t.id,this.answerId=t.answerId,this.surveyRef=t.surveyRef,this.makeObservable(),this.loadProject(),this.confirmTempAnswerType=(e=this.savedAnswer)!==null&&e!==void 0&&e.progress?1:0,console.log(this.confirmTempAnswerType,this.savedAnswer)}return(0,he.Z)(y,[{key:"makeObservable",value:function(){(0,s.Ou)(this,{id:s.LO.ref,answerId:s.LO.ref,survey:s.LO.ref,loading:s.LO.ref,saving:s.LO.ref,verifying:s.LO.ref,project:s.LO.ref,errorCode:s.LO.ref,errorMessage:s.LO.ref,progress:s.LO.ref,confirmTempAnswerType:s.LO.ref,statistics:s.LO.ref,answerUrl:s.LO.ref,answerQrCodeUrl:s.LO.ref,success:s.LO.ref,answerView:s.LO.ref,values:s.LO.ref,loginRequired:s.LO.ref,whitelistName:s.LO.ref,passwordRequired:s.LO.computed,mode:s.LO.computed,tempSaveId:s.LO.computed,status:s.LO.computed,setting:s.LO.computed,tempSave:s.aD,saveData:s.aD,loadProject:s.aD,changeProgress:s.aD,validate:s.aD})}},{key:"setting",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.setting}},{key:"status",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.status}},{key:"passwordRequired",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.passwordRequired}},{key:"mode",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.mode}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var e=localStorage.getItem(this.tempSaveId);return e&&JSON.parse(e)}},{key:"startTime",get:function(){var e,u,a;return((e=this.savedAnswer)===null||e===void 0||(u=e.metaInfo)===null||u===void 0||(a=u.answerInfo)===null||a===void 0?void 0:a.startTime)||new Date().getTime()}},{key:"tempSave",value:function(e){var u=localStorage.getItem(this.tempSaveId),a;u?(a=JSON.parse(u),a.answer=e,a.progress=this.progress):a={answer:e,metaInfo:{answerInfo:{startTime:new Date().getTime()}},progress:this.progress},localStorage.setItem(this.tempSaveId,JSON.stringify(a))}},{key:"saveData",value:function(){var t=(0,L.Z)(w().mark(function u(a,o){var d,l,c=this,g,i,Z,O,A,j;return w().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.saving=!0,g=new(pe())().getResult(),i={answer:a,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()},clientInfo:{browser:g.browser.name||"",browserVersion:g.browser.version||"",deviceType:g.device.type||"",platform:g.os.name||"",platformVersion:g.os.version||""}},id:o||this.answerId,whitelistName:this.whitelistName},Z=this.startTime,O=((d=this.project)===null||d===void 0||(l=d.setting.examSetting)===null||l===void 0?void 0:l.minSubmitMinutes)||0,A=Z+O*60*1e3,!(O>0&&new Date().getTime()<A)){f.next=10;break}return M.default.error("\u672A\u5230\u4EA4\u5377\u65F6\u95F4"),this.saving=!1,f.abrupt("return");case 10:return f.next=12,x.hi.post("/api/public/saveAnswer",i);case 12:j=f.sent,(0,s.aD)(function(){j.success?(j.data.answerId||j.data.examScore!==void 0,c.answerView=j.data,c.values=a,c.success=!0,localStorage.removeItem(c.tempSaveId)):M.default.error(j.message),c.saving=!1});case 14:case"end":return f.stop()}},u,this)}));function e(u,a){return t.apply(this,arguments)}return e}()},{key:"loadStatistics",value:function(){var t=(0,L.Z)(w().mark(function u(){var a=this,o;return w().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.loading){l.next=2;break}return l.abrupt("return");case 2:return this.loading=!0,l.next=5,x.hi.post("/api/public/statistics",{id:this.id});case 5:o=l.sent,(0,s.aD)(function(){o.success&&(a.statistics=o.data),a.loading=!1});case 7:case"end":return l.stop()}},u,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"loadProject",value:function(){var t=(0,L.Z)(w().mark(function u(){var a=this,o;return w().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loading=!0,l.next=3,x.hi.post("/api/public/loadProject",{id:this.id});case 3:o=l.sent,(0,s.aD)(function(){o.success?(a.project=o.data,a.loginRequired=o.data.loginRequired,a.survey=o.data.survey,a.values=o.data.answer,o.data.answerId&&(a.answerId=o.data.answerId)):a.errorMessage=o.message,a.errorCode=o.code,a.loading=!1});case 5:case"end":return l.stop()}},u,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"validate",value:function(){var t=(0,L.Z)(w().mark(function u(a){var o=this,d;return w().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.verifying=!0,c.next=3,x.hi.post("/api/public/validateProject",{id:this.id,answer:a});case 3:d=c.sent,(0,s.aD)(function(){if(d.success){var g;o.project=d.data,o.loginRequired=!1,o.survey=d.data.survey,o.whitelistName=(g=a.whitelistName)===null||g===void 0?void 0:g.whitelistName}else M.default.error(d.message);o.verifying=!1});case 5:case"end":return c.stop()}},u,this)}));function e(u){return t.apply(this,arguments)}return e}()},{key:"upload",value:function(){var t=(0,L.Z)(w().mark(function u(a,o){return w().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",x.hi.upload("/api/public/upload",(0,T.Z)({fileType:4,basePath:this.id},a),o));case 1:case"end":return l.stop()}},u,this)}));function e(u,a){return t.apply(this,arguments)}return e}()},{key:"changeProgress",value:function(e){this.progress=e}}]),y}(),n=r(85893),Q=(0,de.Pi)(function(){var y,t,e=(0,B.UO)(),u=e.id,a=e.answerId,o=(0,B.TH)(),d=o.query.preview==="1",l=o.query.openid,c=(0,p.useMemo)(function(){return(0,C.SB)()},[]),g=(0,p.useRef)(null),i=(0,p.useMemo)(function(){return new we({id:u,answerId:a,surveyRef:g})},[u,a]),Z=i.saving,O=i.loading,A=(y=i.setting)===null||y===void 0?void 0:y.answerSetting,j=i.loginRequired,R=i.verifying,f=A||{},$=f.autoSave,D=f.progressBar,je=f.initialValues,Se=f.questionNumber,Te=f.wechatOnly,Oe=f.onePageOneQuestion,Ie=f.answerSheetVisible,Ce=((t=i.setting)===null||t===void 0?void 0:t.examSetting)||{},Le=Ce.exerciseMode,xe=i.errorMessage,E=i.savedAnswer,H=i.confirmTempAnswerType,be=i.statistics,I=i.survey,Pe=i.answerId,J=i.mode,G=i.success,W=(0,C.XO)(I,o),Ze=(0,p.useState)(),X=(0,N.Z)(Ze,2),K=X[0],Ae=X[1],Me=(0,p.useState)({}),Y=(0,N.Z)(Me,2),q=Y[0],Re=Y[1];(0,p.useEffect)(function(){I&&(0,C.iq)(I,"statEnabled")&&i.loadStatistics()},[I,i]);var $e=(0,p.useCallback)(function(S,h){D&&i.changeProgress(h),$&&S&&i.tempSave(S)},[D]),De=function(){var h;return(0,n.jsxs)("div",{className:"password-confirm",children:[(0,n.jsx)("h3",{children:(h=i.project)===null||h===void 0?void 0:h.name}),(0,n.jsx)(ee.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,n.jsxs)(F.Z,{style:{margin:"10px 0"},children:[(0,n.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,n.jsx)(F.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:q.validateStatus,help:q.help,children:(0,n.jsx)(se.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,n.jsx)(ie,{}),onChange:function(m){return Ae(m.target.value)},iconRender:function(m){return m?(0,n.jsx)(le,{}):(0,n.jsx)(ue.Z,{})}})}),(0,n.jsx)(re.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:R,onClick:function(){K&&i.verifyPassword(K).then(function(m){m||Re({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},Ee=function(){return(0,n.jsx)(P.BW,{})},_=function(h){var v,m;return(0,n.jsxs)("div",{className:"render-failure ".concat(c?"mobile":"phone"),children:[((v=i.project)===null||v===void 0?void 0:v.name)&&(0,n.jsx)("div",{className:"title",children:(m=i.project)===null||m===void 0?void 0:m.name}),(0,n.jsxs)("div",{className:"content",children:[(0,n.jsx)("div",{children:(0,n.jsx)(P.AT,{})}),(0,n.jsx)("h2",{children:xe||h}),(0,n.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Ve=function(){if(G)return(0,n.jsx)(n.Fragment,{});if(O)return(0,n.jsx)(ve.Z,{});if(i.errorCode!==200)return _();if(Te&&!(0,C.CL)())return _("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(j)return(0,n.jsx)("div",{children:Ee()});if(I&&!G&&!R)return H===1&&$&&J==="survey"?(0,n.jsx)(P.oq,{}):(0,n.jsx)(ce.O,{ref:g,mode:J,loading:Z||O,progressBar:D,questionNumber:Se,theme:c?"antdMobile":"antd",schema:I,onChange:$e,onePageOneQuestion:Oe,answerSheetVisible:Ie,exerciseMode:Le,onInit:function(v){i.tempSave(v.values)},initialValues:H===3?W:(0,T.Z)((0,T.Z)((0,T.Z)((0,T.Z)({},je),$?E==null?void 0:E.answer:{}),W),i.values),statistics:be,onUpload:function(v,m){return i.upload(v,m)},footerVisible:!d,headerVisible:!d,isPreview:d,onSubmit:function(v){i.saveData((0,T.Z)((0,T.Z)({},v),{},{openid:l}),Pe)}});if(i.passwordRequired)return(0,n.jsx)("div",{children:De()})},Fe=function(){return(0,n.jsx)(P.x4,{})},Ne=function(){var h,v,m=(h=i.survey)===null||h===void 0||(v=h.attribute)===null||v===void 0?void 0:v.backgroundImage;if(m)return{backgroundImage:"url(/api/public/preview/".concat(m,")")}};return(0,n.jsx)(C.ff.Provider,{value:i,children:(0,n.jsxs)("div",{className:"survey ".concat(c?"mobile":"pc"),style:Ne(),children:[Ve(),Fe()]})})}),ye=Q}}]);
