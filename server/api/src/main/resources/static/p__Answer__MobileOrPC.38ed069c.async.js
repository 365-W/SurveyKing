(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835,9531],{36432:function(b,c,e){"use strict";e.r(c),e.d(c,{MobileOrPC:function(){return oe},default:function(){return Ee}});var v=e(57338),f=e(25084),C=e(71194),B=e(50146),J=e(57663),j=e(71577),h=e(9715),O=e(93766),P=e(47673),g=e(4107),y=e(2824),n=e(51615),a=e(67294),I=e(28991),z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},E=z,x=e(27029),F=function(s,r){return a.createElement(x.Z,(0,I.Z)((0,I.Z)({},s),{},{ref:r,icon:E}))};F.displayName="LockFilled";var R=a.forwardRef(F),k={icon:function(s,r){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:r}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:r}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:s}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:s}}]}},name:"eye",theme:"twotone"},X=k,N=function(s,r){return a.createElement(x.Z,(0,I.Z)((0,I.Z)({},s),{},{ref:r,icon:X}))};N.displayName="EyeTwoTone";var Y=a.forwardRef(N),q=e(88633),ee=e(2299),w=e(87998),te=e(92725),K=e(45290),Q=e(40520),re=e(83854),A=e(3182),ae=e(69610),ge=e(54941),me=e(94043),D=e.n(me),W=e(68489),pe=e(92592),o=e(54531),ye=function(){function L(s,r){var u;(0,ae.Z)(this,L),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.startTime=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.confirmTempAnswerType=0,this.statistics=void 0,this.answerUrl=void 0,this.answerQrCodeUrl=void 0,this.success=void 0,this.answerId=void 0,this.id=s,this.answerId=r,this.makeObservable(),this.loadProject(),this.startTime=new Date().getTime(),this.confirmTempAnswerType=(u=this.savedAnswer)!==null&&u!==void 0&&u.progress?1:0}return(0,ge.Z)(L,[{key:"makeObservable",value:function(){(0,o.Ou)(this,{id:o.LO.ref,answerId:o.LO.ref,survey:o.LO.ref,loading:o.LO.ref,saving:o.LO.ref,verifying:o.LO.ref,project:o.LO.ref,errorCode:o.LO.ref,errorMessage:o.LO.ref,progress:o.LO.ref,confirmTempAnswerType:o.LO.ref,statistics:o.LO.ref,answerUrl:o.LO.ref,answerQrCodeUrl:o.LO.ref,success:o.LO.ref,passwordRequired:o.LO.computed,loginRequired:o.LO.computed,tempSaveId:o.LO.computed,savedAnswer:o.LO.computed,status:o.LO.computed,setting:o.LO.computed,tempSave:o.aD,saveData:o.aD,loadProject:o.aD,verifyPassword:o.aD,changeProgress:o.aD})}},{key:"setting",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.setting}},{key:"status",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.status}},{key:"passwordRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.passwordRequired}},{key:"loginRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.loginRequired}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var r=localStorage.getItem(this.tempSaveId);return r&&JSON.parse(r)}},{key:"tempSave",value:function(r){var u=localStorage.getItem(this.tempSaveId),t;u?(t=JSON.parse(u),t.answer=r,t.progress=this.progress):t={answer:r,metaInfo:{answerInfo:{startTime:new Date().getTime()}},progress:this.progress},localStorage.setItem(this.tempSaveId,JSON.stringify(t))}},{key:"saveData",value:function(){var s=(0,A.Z)(D().mark(function u(t,m){var d=this,l,$,Z;return D().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.saving=!0,l={answer:t,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()}},id:m},_.next=4,W.hi.post("/api/public/saveAnswer",l);case 4:$=_.sent,$.success&&$.data&&(Z="".concat(window.location.origin,"/s/").concat(this.id,"/").concat($.data),this.answerUrl=Z,pe.toDataURL(Z,{errorCorrectionLevel:"H",type:"image/jpeg",quality:.3,margin:5}).then(function(V){d.answerQrCodeUrl=V}).catch(function(V){console.error(V)})),localStorage.removeItem(this.tempSaveId),this.saving=!1,this.success=!0;case 9:case"end":return _.stop()}},u,this)}));function r(u,t){return s.apply(this,arguments)}return r}()},{key:"loadStatistics",value:function(){var s=(0,A.Z)(D().mark(function u(){var t;return D().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!this.loading){d.next=2;break}return d.abrupt("return");case 2:return this.loading=!0,d.next=5,W.hi.post("/api/public/statistics",{id:this.id});case 5:t=d.sent,t.success&&(this.statistics=t.data),this.loading=!1;case 8:case"end":return d.stop()}},u,this)}));function r(){return s.apply(this,arguments)}return r}()},{key:"loadProject",value:function(){var s=(0,A.Z)(D().mark(function u(){var t;return D().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.loading=!0,d.next=3,W.hi.post("/api/public/loadProject",{id:this.id});case 3:t=d.sent,t.success?(this.project=t.data,this.survey=t.data.survey,t.data.answerId&&(this.answerId=t.data.answerId)):this.errorMessage=t.message,this.errorCode=t.code,this.loading=!1;case 7:case"end":return d.stop()}},u,this)}));function r(){return s.apply(this,arguments)}return r}()},{key:"loadAnswer",value:function(){var s=(0,A.Z)(D().mark(function u(t){var m;return D().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,W.hi.post("/api/public/loadAnswer",{id:t,projectId:this.id});case 2:if(m=l.sent,!m.success){l.next=7;break}return l.abrupt("return",m.data);case 7:this.errorCode=m.code,this.errorMessage=m.message;case 9:case"end":return l.stop()}},u,this)}));function r(u){return s.apply(this,arguments)}return r}()},{key:"verifyPassword",value:function(){var s=(0,A.Z)(D().mark(function u(t){var m;return D().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.verifying=!0,l.next=3,W.hi.post("/api/public/verifyPassword",{id:this.id,password:t});case 3:if(m=l.sent,this.verifying=!1,m.code!==200){l.next=8;break}return this.survey=m.data.survey,l.abrupt("return",!0);case 8:return l.abrupt("return",!1);case 9:case"end":return l.stop()}},u,this)}));function r(u){return s.apply(this,arguments)}return r}()},{key:"upload",value:function(){var s=(0,A.Z)(D().mark(function u(t,m){return D().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",W.hi.upload("/api/public/upload",{file:t},m));case 1:case"end":return l.stop()}},u)}));function r(u,t){return s.apply(this,arguments)}return r}()},{key:"changeProgress",value:function(r){this.progress=r}}]),L}(),we=e(19319),i=e(85893),oe=(0,ee.Pi)(function(){var L,s=(0,n.UO)(),r=s.id,u=s.answerId,t=(0,a.useMemo)(function(){return new ye(r,u)},[r,u]),m=(0,a.useState)(!1),d=(0,y.Z)(m,2),l=d[0],$=d[1],Z=(0,a.useMemo)(function(){return(0,w.SB)()},[]),se=(0,a.useRef)(null),_=t.saving,V=t.loading,Ce=(L=t.setting)===null||L===void 0?void 0:L.answerSetting,H=Ce||{},le=H.autoSave,ne=H.progressBar,Oe=H.initialValues,Pe=H.questionNumber,De=H.wechatOnly,Me=t.errorMessage,ie=t.savedAnswer,ue=t.confirmTempAnswerType,Se=t.statistics,U=t.survey,G=t.answerId,je=(0,a.useState)(),ce=(0,y.Z)(je,2),de=ce[0],Te=ce[1],be=(0,a.useState)({}),ve=(0,y.Z)(be,2),fe=ve[0],Ie=ve[1];(0,a.useEffect)(function(){U&&(0,w.iq)(U,"statEnabled")&&t.loadStatistics()},[U,t]),(0,a.useEffect)(function(){U&&G&&t.loadAnswer(G).then(function(T){if(T){var p;(p=se.current)===null||p===void 0||p.setValues(T.answer)}})},[G,t,U]);var Le=(0,a.useCallback)(function(T,p){ne&&t.changeProgress(p),le&&T&&t.tempSave(T)},[ne]),xe=function(){var p;return(0,i.jsxs)("div",{className:"password-confirm",children:[(0,i.jsx)("h3",{children:(p=t.project)===null||p===void 0?void 0:p.name}),(0,i.jsx)(B.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,i.jsxs)(O.Z,{style:{margin:"10px 0"},children:[(0,i.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,i.jsx)(O.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:fe.validateStatus,help:fe.help,children:(0,i.jsx)(g.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,i.jsx)(R,{}),onChange:function(S){return Te(S.target.value)},iconRender:function(S){return S?(0,i.jsx)(Y,{}):(0,i.jsx)(q.Z,{})}})}),(0,i.jsx)(j.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:t.verifying,onClick:function(){de&&t.verifyPassword(de).then(function(S){S||Ie({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},Ae=function(){return(0,i.jsx)(f.Z,{visible:!0,width:"100%",closable:!1,bodyStyle:{padding:0},children:(0,i.jsx)(we.default,{onOk:function(){t.loadProject()}})})},he=function(p){var M,S;return(0,i.jsxs)("div",{className:"render-failure ".concat(Z?"mobile":"phone"),children:[((M=t.project)===null||M===void 0?void 0:M.name)&&(0,i.jsx)("div",{className:"title",children:(S=t.project)===null||S===void 0?void 0:S.name}),(0,i.jsxs)("div",{className:"content",children:[(0,i.jsx)("div",{children:(0,i.jsx)(K.AT,{})}),(0,i.jsx)("h2",{children:Me||p}),(0,i.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Re=function(){if(t.loading)return(0,i.jsx)(te.Z,{});if(t.errorCode!==200)return he();if(De&&!(0,w.CL)())return he("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(U&&!l)return ue===1&&le?(0,i.jsx)(K.oq,{}):(0,i.jsx)(Q.O,{ref:se,loading:_||V,progressBar:ne,questionNumber:Pe,theme:Z?"antdmobile":"antd",schema:U,onChange:Le,initialValues:ue===3?void 0:(ie==null?void 0:ie.answer)||Oe,statistics:Se,onUpload:t.upload,onSubmit:function(M){t.saveData(M,G).then(function(){return $(!0)})}});if(t.loginRequired)return(0,i.jsx)("div",{children:Ae()});if(t.passwordRequired)return(0,i.jsx)("div",{children:xe()})},Ze=function(){return(0,i.jsx)(K.x4,{})},_e=function(){var p,M,S=(p=t.survey)===null||p===void 0||(M=p.attribute)===null||M===void 0?void 0:M.backgroundImage;if(S)return{backgroundImage:"url(/api/public/preview/".concat(S,")")}};return(0,i.jsx)(w.ff.Provider,{value:t,children:(0,i.jsxs)("div",{className:"survey ".concat(Z?"mobile":"pc"),style:_e(),children:[Re(),Ze()]})})}),Ee=oe},15746:function(b,c,e){"use strict";var v=e(21584);c.Z=v.Z},89032:function(b,c,e){"use strict";var v=e(38842),f=e.n(v),C=e(6999)},27049:function(b,c,e){"use strict";var v=e(22122),f=e(96156),C=e(67294),B=e(94184),J=e.n(B),j=e(65632),h=function(P,g){var y={};for(var n in P)Object.prototype.hasOwnProperty.call(P,n)&&g.indexOf(n)<0&&(y[n]=P[n]);if(P!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(P);a<n.length;a++)g.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(P,n[a])&&(y[n[a]]=P[n[a]]);return y},O=function(g){return C.createElement(j.C,null,function(y){var n,a=y.getPrefixCls,I=y.direction,z=g.prefixCls,E=g.type,x=E===void 0?"horizontal":E,F=g.orientation,R=F===void 0?"center":F,k=g.orientationMargin,X=g.className,N=g.children,Y=g.dashed,q=g.plain,ee=h(g,["prefixCls","type","orientation","orientationMargin","className","children","dashed","plain"]),w=a("divider",z),te=R.length>0?"-".concat(R):R,K=!!N,Q=R==="left"&&k!=null,re=R==="right"&&k!=null,A=J()(w,"".concat(w,"-").concat(x),(n={},(0,f.Z)(n,"".concat(w,"-with-text"),K),(0,f.Z)(n,"".concat(w,"-with-text").concat(te),K),(0,f.Z)(n,"".concat(w,"-dashed"),!!Y),(0,f.Z)(n,"".concat(w,"-plain"),!!q),(0,f.Z)(n,"".concat(w,"-rtl"),I==="rtl"),(0,f.Z)(n,"".concat(w,"-no-default-orientation-margin-left"),Q),(0,f.Z)(n,"".concat(w,"-no-default-orientation-margin-right"),re),n),X),ae=(0,v.Z)((0,v.Z)({},Q&&{marginLeft:k}),re&&{marginRight:k});return C.createElement("div",(0,v.Z)({className:A},ee,{role:"separator"}),N&&C.createElement("span",{className:"".concat(w,"-inner-text"),style:ae},N))})};c.Z=O},48736:function(b,c,e){"use strict";var v=e(38842),f=e.n(v),C=e(62563),B=e.n(C)},71230:function(b,c,e){"use strict";var v=e(92820);c.Z=v.Z},13062:function(b,c,e){"use strict";var v=e(38842),f=e.n(v),C=e(6999)},20640:function(b,c,e){"use strict";var v=e(11742),f={"text/plain":"Text","text/html":"Url",default:"Text"},C="Copy to clipboard: #{key}, Enter";function B(j){var h=(/mac os x/i.test(navigator.userAgent)?"\u2318":"Ctrl")+"+C";return j.replace(/#{\s*key\s*}/g,h)}function J(j,h){var O,P,g,y,n,a,I=!1;h||(h={}),O=h.debug||!1;try{g=v(),y=document.createRange(),n=document.getSelection(),a=document.createElement("span"),a.textContent=j,a.style.all="unset",a.style.position="fixed",a.style.top=0,a.style.clip="rect(0, 0, 0, 0)",a.style.whiteSpace="pre",a.style.webkitUserSelect="text",a.style.MozUserSelect="text",a.style.msUserSelect="text",a.style.userSelect="text",a.addEventListener("copy",function(E){if(E.stopPropagation(),h.format)if(E.preventDefault(),typeof E.clipboardData=="undefined"){O&&console.warn("unable to use e.clipboardData"),O&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var x=f[h.format]||f.default;window.clipboardData.setData(x,j)}else E.clipboardData.clearData(),E.clipboardData.setData(h.format,j);h.onCopy&&(E.preventDefault(),h.onCopy(E.clipboardData))}),document.body.appendChild(a),y.selectNodeContents(a),n.addRange(y);var z=document.execCommand("copy");if(!z)throw new Error("copy command was unsuccessful");I=!0}catch(E){O&&console.error("unable to copy using execCommand: ",E),O&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(h.format||"text",j),h.onCopy&&h.onCopy(window.clipboardData),I=!0}catch(x){O&&console.error("unable to copy using clipboardData: ",x),O&&console.error("falling back to prompt"),P=B("message"in h?h.message:C),window.prompt(P,j)}}finally{n&&(typeof n.removeRange=="function"?n.removeRange(y):n.removeAllRanges()),a&&document.body.removeChild(a),g()}return I}b.exports=J},11742:function(b){b.exports=function(){var c=document.getSelection();if(!c.rangeCount)return function(){};for(var e=document.activeElement,v=[],f=0;f<c.rangeCount;f++)v.push(c.getRangeAt(f));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return c.removeAllRanges(),function(){c.type==="Caret"&&c.removeAllRanges(),c.rangeCount||v.forEach(function(C){c.addRange(C)}),e&&e.focus()}}},62563:function(){}}]);
