(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835],{36432:function(Ae,Z,t){"use strict";t.r(Z),t.d(Z,{MobileOrPC:function(){return E},default:function(){return le}});var De=t(57106),V=t(99683),Me=t(57338),H=t(25084),Ee=t(71194),J=t(50146),be=t(57663),S=t(71577),Be=t(9715),I=t(93766),Fe=t(47673),U=t(4107),C=t(2824),G=t(51615),v=t(67294),y=t(28991),K={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},Q=K,A=t(27029),D=function(a,r){return v.createElement(A.Z,(0,y.Z)((0,y.Z)({},a),{},{ref:r,icon:Q}))};D.displayName="LockFilled";var W=v.forwardRef(D),X={icon:function(a,r){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:r}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:r}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:a}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:a}}]}},name:"eye",theme:"twotone"},Y=X,M=function(a,r){return v.createElement(A.Z,(0,y.Z)((0,y.Z)({},a),{},{ref:r,icon:Y}))};M.displayName="EyeTwoTone";var q=v.forwardRef(M),_=t(88633),ee=t(2299),T=t(87998),re=t(92725),x=t(30931),te=t(40208),$e=t(71631),j=t(3182),se=t(69610),ae=t(54941),ne=t(94043),g=t.n(ne),w=t(68489),n=t(54531),ie=function(){function h(a){var r;(0,se.Z)(this,h),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.startTime=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.confirmTempAnswerType=0,this.id=a,this.makeObservable(),this.loadProject(),this.startTime=new Date().getTime(),this.confirmTempAnswerType=(r=this.savedAnswer)!==null&&r!==void 0&&r.progress?1:0}return(0,ae.Z)(h,[{key:"makeObservable",value:function(){(0,n.Ou)(this,{id:n.LO.ref,survey:n.LO.ref,loading:n.LO.ref,saving:n.LO.ref,verifying:n.LO.ref,project:n.LO.ref,errorCode:n.LO.ref,errorMessage:n.LO.ref,progress:n.LO.ref,confirmTempAnswerType:n.LO.ref,passwordRequired:n.LO.computed,loginRequired:n.LO.computed,tempSaveId:n.LO.computed,savedAnswer:n.LO.computed,status:n.LO.computed,setting:n.LO.computed,tempSave:n.aD,saveData:n.aD,loadProject:n.aD,verifyPassword:n.aD,changeProgress:n.aD})}},{key:"setting",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.setting}},{key:"status",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.status}},{key:"passwordRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.passwordRequired}},{key:"loginRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.loginRequired}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var r=localStorage.getItem(this.tempSaveId);return r&&JSON.parse(r)}},{key:"tempSave",value:function(r){var o=localStorage.getItem(this.tempSaveId),e;o?(e=JSON.parse(o),e.answer=r,e.progress=this.progress):e={answer:r,metaInfo:{answerInfo:{startTime:new Date().getTime()}},progress:this.progress},localStorage.setItem(this.tempSaveId,JSON.stringify(e))}},{key:"saveData",value:function(){var a=(0,j.Z)(g().mark(function o(e){var c;return g().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.saving=!0,c={answer:e,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()}}},i.next=4,w.hi.post("/api/public/saveAnswer",c);case 4:localStorage.removeItem(this.tempSaveId),this.saving=!1;case 6:case"end":return i.stop()}},o,this)}));function r(o){return a.apply(this,arguments)}return r}()},{key:"loadProject",value:function(){var a=(0,j.Z)(g().mark(function o(){var e;return g().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.loading=!0,f.next=3,w.hi.post("/api/public/loadProject",{id:this.id});case 3:e=f.sent,e.success?(this.project=e.data,this.survey=e.data.survey):this.errorMessage=e.message,this.errorCode=e.code,this.loading=!1;case 7:case"end":return f.stop()}},o,this)}));function r(){return a.apply(this,arguments)}return r}()},{key:"verifyPassword",value:function(){var a=(0,j.Z)(g().mark(function o(e){var c;return g().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return this.verifying=!0,i.next=3,w.hi.post("/api/public/verifyPassword",{id:this.id,password:e});case 3:if(c=i.sent,this.verifying=!1,c.code!==200){i.next=8;break}return this.survey=c.data.survey,i.abrupt("return",!0);case 8:return i.abrupt("return",!1);case 9:case"end":return i.stop()}},o,this)}));function r(o){return a.apply(this,arguments)}return r}()},{key:"upload",value:function(){var a=(0,j.Z)(g().mark(function o(e,c){return g().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",w.hi.upload("/api/public/upload",{file:e},c));case 1:case"end":return i.stop()}},o)}));function r(o,e){return a.apply(this,arguments)}return r}()},{key:"changeProgress",value:function(r){this.progress=r}}]),h}(),oe=t(19319),s=t(85893),E=(0,ee.Pi)(function(){var h,a,r=(0,G.UO)(),o=r.id,e=(0,v.useMemo)(function(){return new ie(o)},[o]),c=(0,v.useState)(!1),f=(0,C.Z)(c,2),i=f[0],ue=f[1],O=(0,v.useMemo)(function(){return(0,T.SB)()},[]),de=(0,v.useRef)(null),ve=e.saving,ce=e.loading,fe=(h=e.setting)===null||h===void 0?void 0:h.answerSetting,p=fe||{},b=p.autoSave,P=p.progressBar,he=p.initialValues,ge=p.questionNumber,me=p.wechatOnly,pe=(a=e.setting)===null||a===void 0?void 0:a.submittedSetting,ye=pe||{},B=ye.contentHtml,je=e.errorMessage,L=e.savedAnswer,F=e.confirmTempAnswerType,we=(0,v.useState)(),$=(0,C.Z)(we,2),k=$[0],Se=$[1],Ce=(0,v.useState)({}),R=(0,C.Z)(Ce,2),N=R[0],Te=R[1],xe=(0,v.useCallback)(function(m,l){P&&e.changeProgress(l),b&&m&&e.tempSave(m)},[P]),Oe=function(){var l;return(0,s.jsxs)("div",{className:"password-confirm",children:[(0,s.jsx)("h3",{children:(l=e.project)===null||l===void 0?void 0:l.name}),(0,s.jsx)(J.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,s.jsxs)(I.Z,{style:{margin:"10px 0"},children:[(0,s.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,s.jsx)(I.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:N.validateStatus,help:N.help,children:(0,s.jsx)(U.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,s.jsx)(W,{}),onChange:function(d){return Se(d.target.value)},iconRender:function(d){return d?(0,s.jsx)(q,{}):(0,s.jsx)(_.Z,{})}})}),(0,s.jsx)(S.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:e.verifying,onClick:function(){k&&e.verifyPassword(k).then(function(d){d||Te({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},Pe=function(){return(0,s.jsx)(H.Z,{visible:!0,width:"100%",closable:!1,bodyStyle:{padding:0},children:(0,s.jsx)(oe.default,{onOk:function(){e.loadProject()}})})},z=function(l){var u,d;return(0,s.jsxs)("div",{className:"render-failure ".concat(O?"mobile":"phone"),children:[((u=e.project)===null||u===void 0?void 0:u.name)&&(0,s.jsx)("div",{className:"title",children:(d=e.project)===null||d===void 0?void 0:d.name}),(0,s.jsxs)("div",{className:"content",children:[(0,s.jsx)("div",{children:(0,s.jsx)(x.AT,{})}),(0,s.jsx)("h2",{children:je||l}),(0,s.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Le=function(){if(e.loading)return(0,s.jsx)(re.Z,{});if(e.errorCode!==200)return z();if(me&&!(0,T.CL)())return z("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(e.survey&&!i)return F===1&&b?(0,s.jsx)(x.oq,{}):(0,s.jsx)(te.O,{ref:de,loading:ve||ce,progressBar:P,questionNumber:ge,theme:O?"antdmobile":"antd",schema:e.survey,onChange:xe,initialValues:F===3?void 0:(L==null?void 0:L.answer)||he,onUpload:e.upload,onSubmit:function(u){e.saveData(u).then(function(){return ue(!0)})}});if(e.loginRequired)return(0,s.jsx)("div",{children:Pe()});if(e.passwordRequired)return(0,s.jsx)("div",{children:Oe()})},Ze=function(){return i?B?(0,s.jsxs)("div",{className:"success-content",children:[(0,s.jsx)(x.hl,{html:B}),(0,s.jsx)("div",{style:{textAlign:"center"},children:(0,s.jsx)(S.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")})]}):(0,s.jsx)(V.ZP,{status:"success",title:"\u7B54\u6848\u5DF2\u4FDD\u5B58!",extra:[(0,s.jsx)(S.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")]}):(0,s.jsx)(s.Fragment,{})},Ie=function(){var l,u,d=(l=e.survey)===null||l===void 0||(u=l.attribute)===null||u===void 0?void 0:u.backgroundImage;if(d)return{backgroundImage:"url(/api/public/preview/".concat(d,")")}};return(0,s.jsx)(T.ff.Provider,{value:e,children:(0,s.jsxs)("div",{className:"survey ".concat(O?"mobile":"pc"),style:Ie(),children:[Le(),Ze()]})})}),le=E}}]);
