(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[250],{49101:function(K,I,e){"use strict";e.d(I,{Z:function(){return b}});var y=e(28991),m=e(67294),O={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"},c=O,V=e(27029),P=function(Q,B){return m.createElement(V.Z,(0,y.Z)((0,y.Z)({},Q),{},{ref:B,icon:c}))};P.displayName="PlusOutlined";var b=m.forwardRef(P)},13277:function(){},75952:function(K,I,e){"use strict";e.r(I),e.d(I,{default:function(){return Y}});var y=e(80937),m=e(67294),O=e(51615),c=e(11849),V=e(34792),P=e(48086),b=e(3182),U=e(69610),Q=e(54941),B=e(94043),p=e.n(B),F=e(3980),C=e(54531),q=function(){function i(t){(0,U.Z)(this,i),this.id=void 0,this.resultId=void 0,this.query=void 0,this.queryErrorMsg=void 0,this.queryForm=void 0,this.queryResult=void 0,this.queryFormValue={},this.id=t.id,this.resultId=t.resultId,this.query=t.query,this.makeObservable()}return(0,Q.Z)(i,[{key:"makeObservable",value:function(){(0,C.Ou)(this,{id:C.LO.ref,resultId:C.LO.ref,query:C.LO.ref,queryForm:C.LO.ref,queryResult:C.LO.ref,queryFormValue:C.LO.ref,queryErrorMsg:C.LO.ref,loadQuery:C.aD,getQueryResult:C.aD})}},{key:"loadQuery",value:function(){var t=(0,b.Z)(p().mark(function o(){var s;return p().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,F.hi.loadQuery({id:this.id,resultId:this.resultId});case 2:s=h.sent,s.success?this.queryForm=s.data.schema:this.queryErrorMsg=s.message;case 4:case"end":return h.stop()}},o,this)}));function f(){return t.apply(this,arguments)}return f}()},{key:"getQueryResult",value:function(){var t=(0,b.Z)(p().mark(function o(s){var u;return p().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,F.hi.getQueryResult({id:this.id,resultId:this.resultId,answer:s,query:this.query});case 2:u=a.sent,this.queryFormValue=s,u.code!==200?P.default.error(u.message):this.queryResult=u.data;case 5:case"end":return a.stop()}},o,this)}));function f(o){return t.apply(this,arguments)}return f}()},{key:"updateAnswer",value:function(){var t=(0,b.Z)(p().mark(function o(s,u){return p().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,F.hi.post("/api/public/saveAnswer",{id:u,queryId:this.resultId,answer:s,projectId:this.id});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},o,this)}));function f(o,s){return t.apply(this,arguments)}return f}()},{key:"upload",value:function(){var t=(0,b.Z)(p().mark(function o(s,u){return p().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",F.hi.upload("/api/public/upload",(0,c.Z)((0,c.Z)({},s),{},{fileType:4,basePath:this.id}),u));case 1:case"end":return a.stop()}},o,this)}));function f(o,s){return t.apply(this,arguments)}return f}()}]),i}(),W=m.createContext(new q({id:"123456",resultId:"123456"}));function D(){return(0,m.useContext)(W)}var z=e(68068),H=e(8373),r=e(85893),G=(0,y.Pi)(function(){var i=D(),t=i.queryForm,f=i.queryResult,o=i.query;return(0,m.useEffect)(function(){i.loadQuery()},[]),(0,m.useEffect)(function(){var s;t&&((s=t.children)===null||s===void 0?void 0:s.filter(function(u){var h;return!((h=u.children)!==null&&h!==void 0&&h.find(function(a){return!!o[a.id]}))}).length)===0&&i.getQueryResult({})},[t,o]),f?(0,r.jsx)(r.Fragment,{}):t?(0,r.jsx)("div",{className:"public-query",children:(0,r.jsx)("div",{className:"query-form",children:!f&&(0,r.jsx)(z.Z,{theme:"antdForm",schema:t,questionNumber:!1,onSubmit:function(u){i.getQueryResult(u)}})})}):(0,r.jsx)(H.gb,{})}),d=e(57663),l=e(71577),g=e(49111),n=e(19650),v=e(71153),T=e(60331),R=e(83279),j=e(18106),M=e(51752),x=e(94184),N=e.n(x),A=e(87998),Z=M.Z.TabPane,L=(0,y.Pi)(function(){var i=D(),t=i.queryResult,f=i.queryFormValue,o=(0,m.useMemo)(function(){return(0,A.SB)()},[]);return(0,m.useEffect)(function(){},[]),t?(0,r.jsxs)("div",{className:N()("query-result",o?"mobile":"pc"),children:[(0,r.jsxs)("div",{className:"query-result-criteria",children:[(0,r.jsx)("h3",{children:"\u67E5\u8BE2\u6761\u4EF6"}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",margin:"12px 0"},children:[(0,r.jsxs)("div",{children:["\u67E5\u8BE2\u6761\u4EF6\uFF1A",(0,r.jsx)(n.Z,{children:Object.values(f).reduce(function(s,u){return s.push.apply(s,(0,R.Z)(Object.values(u))),s},[]).map(function(s){return(0,r.jsx)(T.Z,{color:"blue",children:s},s)})})]}),(0,r.jsx)(l.Z,{type:"primary",onClick:function(){i.queryResult=void 0},children:"\u91CD\u65B0\u67E5\u8BE2"})]})]}),(0,r.jsx)("div",{className:"query-result-container",children:(0,r.jsxs)("div",{className:"query-result-data",children:[(0,r.jsxs)("div",{className:"query-result-data-total",children:["\u67E5\u8BE2\u5230 ",t.answers.length," \u6761\u7B26\u5408\u6761\u4EF6\u7684\u6570\u636E"]}),(0,r.jsx)("div",{className:"query-result-data-content",children:(0,r.jsx)(M.Z,{type:"card",children:t.answers.map(function(s){return(0,r.jsx)(Z,{tab:s.createAt,children:(0,r.jsx)(z.Z,{theme:o?"antdMobile":"antd",schema:t==null?void 0:t.schema,initialValues:s.answer,headerVisible:!1,footerVisible:!!(t!=null&&t.schema.attribute),paginationVisible:!1,fieldPermission:t.fieldPermission,onUpload:function(h,a){return i.upload(h,a)},onSubmit:function(h){i.updateAnswer(h,s.answerId).then(function(a){a.success?P.default.success("\u7B54\u6848\u66F4\u65B0\u6210\u529F"):P.default.error(a.message)})}})},s.answerId)})})})]})})]}):(0,r.jsx)(r.Fragment,{})}),E=e(12997),$=(0,y.Pi)(function(){var i=D(),t=i.queryErrorMsg;return t?(0,r.jsx)("div",{className:"render-failure  phone",children:(0,r.jsxs)("div",{className:"content",children:[(0,r.jsx)("div",{children:(0,r.jsx)(E.AT,{})}),(0,r.jsx)("h2",{children:t})]})}):(0,r.jsx)(r.Fragment,{})}),Y=(0,y.Pi)(function(){var t=(0,O.UO)(),f=t.id,o=t.resultId,s=(0,O.TH)(),u=(0,m.useMemo)(function(){return new q({id:f,resultId:o,query:s.query})},[f,o]);return(0,r.jsxs)(W.Provider,{value:u,children:[(0,r.jsx)($,{}),(0,r.jsx)(G,{}),(0,r.jsx)(L,{})]})})},60331:function(K,I,e){"use strict";e.d(I,{Z:function(){return G}});var y=e(96156),m=e(22122),O=e(28481),c=e(67294),V=e(94184),P=e.n(V),b=e(98423),U=e(54549),Q=e(53124),B=function(d,l){var g={};for(var n in d)Object.prototype.hasOwnProperty.call(d,n)&&l.indexOf(n)<0&&(g[n]=d[n]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,n=Object.getOwnPropertySymbols(d);v<n.length;v++)l.indexOf(n[v])<0&&Object.prototype.propertyIsEnumerable.call(d,n[v])&&(g[n[v]]=d[n[v]]);return g},p=function(l){var g,n=l.prefixCls,v=l.className,T=l.checked,R=l.onChange,j=l.onClick,M=B(l,["prefixCls","className","checked","onChange","onClick"]),x=c.useContext(Q.E_),N=x.getPrefixCls,A=function($){R==null||R(!T),j==null||j($)},Z=N("tag",n),L=P()(Z,(g={},(0,y.Z)(g,"".concat(Z,"-checkable"),!0),(0,y.Z)(g,"".concat(Z,"-checkable-checked"),T),g),v);return c.createElement("span",(0,m.Z)({},M,{className:L,onClick:A}))},F=p,C=e(98787),q=e(21790),W=function(d,l){var g={};for(var n in d)Object.prototype.hasOwnProperty.call(d,n)&&l.indexOf(n)<0&&(g[n]=d[n]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,n=Object.getOwnPropertySymbols(d);v<n.length;v++)l.indexOf(n[v])<0&&Object.prototype.propertyIsEnumerable.call(d,n[v])&&(g[n[v]]=d[n[v]]);return g},D=new RegExp("^(".concat(C.Y.join("|"),")(-inverse)?$")),z=new RegExp("^(".concat(C.E.join("|"),")$")),H=function(l,g){var n,v=l.prefixCls,T=l.className,R=l.style,j=l.children,M=l.icon,x=l.color,N=l.onClose,A=l.closeIcon,Z=l.closable,L=Z===void 0?!1:Z,E=W(l,["prefixCls","className","style","children","icon","color","onClose","closeIcon","closable"]),$=c.useContext(Q.E_),Y=$.getPrefixCls,i=$.direction,t=c.useState(!0),f=(0,O.Z)(t,2),o=f[0],s=f[1];c.useEffect(function(){"visible"in E&&s(E.visible)},[E.visible]);var u=function(){return x?D.test(x)||z.test(x):!1},h=(0,m.Z)({backgroundColor:x&&!u()?x:void 0},R),a=u(),S=Y("tag",v),ee=P()(S,(n={},(0,y.Z)(n,"".concat(S,"-").concat(x),a),(0,y.Z)(n,"".concat(S,"-has-color"),x&&!a),(0,y.Z)(n,"".concat(S,"-hidden"),!o),(0,y.Z)(n,"".concat(S,"-rtl"),i==="rtl"),n),T),J=function(k){k.stopPropagation(),N==null||N(k),!k.defaultPrevented&&("visible"in E||s(!1))},re=function(){return L?A?c.createElement("span",{className:"".concat(S,"-close-icon"),onClick:J},A):c.createElement(U.Z,{className:"".concat(S,"-close-icon"),onClick:J}):null},te="onClick"in E||j&&j.type==="a",se=(0,b.Z)(E,["visible"]),X=M||null,ne=X?c.createElement(c.Fragment,null,X,c.createElement("span",null,j)):j,w=c.createElement("span",(0,m.Z)({},se,{ref:g,className:ee,style:h}),ne,re());return te?c.createElement(q.Z,null,w):w},r=c.forwardRef(H);r.displayName="Tag",r.CheckableTag=F;var G=r},71153:function(K,I,e){"use strict";var y=e(38663),m=e.n(y),O=e(13277),c=e.n(O)}}]);
