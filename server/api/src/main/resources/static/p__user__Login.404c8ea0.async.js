(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[9531],{34687:function(M){M.exports={container:"container___1sYa-",lang:"lang___l6cji",content:"content___2zk1-",top:"top___1C1Zi",header:"header___5xZ3f",logo:"logo___2hXsy",title:"title___1-xuF",desc:"desc___-njyT",main:"main___x4OjT",icon:"icon___rzGKO",other:"other___lLyaU",register:"register___11Twg",prefixIcon:"prefixIcon___23Xrx"}},29791:function(M,N,e){"use strict";var ce=e(24557),H=e(78874),p=e(11013),E=e(87859),n=e(85893),le=void 0==="1";N.Z=function(){return le?(0,n.jsx)(E.qc,{copyright:!1,links:[{key:"Survey King",title:(0,n.jsx)(ce.Z,{}),href:"https://surveyking.cn",blankTarget:!0},{key:"github",title:(0,n.jsx)(H.Z,{}),href:"https://github.com/javahuang/SurveyKing",blankTarget:!0},{key:"gitee",title:(0,n.jsx)(p.Z,{}),href:"https://gitee.com/surveyking/surveyking",blankTarget:!0}]}):(0,n.jsx)(n.Fragment,{})}},88699:function(M,N,e){"use strict";e.r(N),e.d(N,{default:function(){return at}});var ce=e(34792),H=e(48086),p=e(39428),E=e(3182),n=e(94657),le=e(17462),ke=e(76772),Te=e(29791),Ne=e(89366),Pe=e(2603),ae=e(82837),s=e(67294),L=e(42285),We=e(73727),Oe=e(27400),ze=e(80582),pt=e(71194),De=e(50146),Ae=e(59879),Fe=e(8812),Ue=e(81354),O=e.n(Ue),de=function(i){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"XwKsGlMcdPMEhR1B",m=O().enc.Utf8.parse(j),l=O().enc.Utf8.parse(i),P=O().AES.encrypt(l,m,{mode:O().mode.ECB,padding:O().pad.Pkcs7});return P.toString()},fe=e(3980),He=e(9669),Ke=e.n(He),ge=Ke().create({timeout:4e4,headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json; charset=UTF-8"}});ge.interceptors.request.use(function(v){return v},function(v){Promise.reject(v)}),ge.interceptors.response.use(function(v){var i=v.data;return i});var Xe=function(i){return fe.hi.post("/captcha/get",i)};function $e(v){return se.apply(this,arguments)}function se(){return se=(0,E.Z)((0,p.Z)().mark(function v(i){return(0,p.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",fe.hi.post("/captcha/check",i));case 1:case"end":return m.stop()}},v)})),se.apply(this,arguments)}var Ve=e(79743),Ge=e.n(Ve),t=e(85893),z={mode:"fixed",vSpace:5,imgSize:{width:"310px",height:"200px"},barSize:{width:"310px",height:"40px"},setSize:{imgHeight:"200px",imgWidth:"310px",barHeight:"40px",barWidth:"310px"},blockSize:{width:"40px",height:"40px"}},Ye=function(i){var j=z.vSpace,m=z.blockSize,l=z.setSize,P=z.imgSize,b=z.barSize,ne=i.isShow,D=i.captchaType,K=D===void 0?"blockPuzzle":D,X=i.transitionLeft,$=X===void 0?"":X,d=i.transitionWidth,W=d===void 0?"":d,ie=i.verifyCaptcha,V=(0,s.useState)(""),G=(0,n.Z)(V,2),A=G[0],Y=G[1],J=(0,s.useState)(""),Q=(0,n.Z)(J,2),q=Q[0],C=Q[1],f=(0,s.useState)("#1890ff"),h=(0,n.Z)(f,2),u=h[0],Z=h[1],g=(0,s.useState)(!1),w=(0,n.Z)(g,2),I=w[0],y=w[1],ve=(0,s.useState)(!1),r=(0,n.Z)(ve,2),st=r[0],ue=r[1],rt=(0,s.useState)(""),he=(0,n.Z)(rt,2),pe=he[0],F=he[1],nt=(0,s.useState)("\u5411\u53F3\u6ED1\u52A8\u5B8C\u6210\u9A8C\u8BC1"),me=(0,n.Z)(nt,2),it=me[0],ye=me[1],U=(0,s.useRef)(!1),xe=(0,s.useRef)(0),R=(0,s.useRef)(0),ut=(0,s.useState)(0),Se=(0,n.Z)(ut,2),ot=Se[0],je=Se[1],ct=(0,s.useState)(0),Ce=(0,n.Z)(ct,2),lt=Ce[0],Ze=Ce[1],oe=(0,s.useRef)(0),Be=(0,s.useRef)(0),Le=(0,s.useRef)(""),we=(0,s.useRef)("");(0,s.useEffect)(function(){return dt(),Me(),ft(),gt},[]);var dt=function(){for(var a=[],o="0123456789abcdef",x=0;x<36;x++)a[x]=o.substring(Math.floor(Math.random()*16),1);a[14]="4",a[19]=o.substring(Number(a[19])&3|8,1),a[8]=a[13]=a[18]=a[23]="-";var c="slider-".concat(a.join(""));localStorage.getItem("slider")||localStorage.setItem("slider",c)},ft=function(){window.addEventListener("touchmove",_),window.addEventListener("mousemove",_),window.addEventListener("touchend",ee),window.addEventListener("mouseup",ee)},gt=function(){window.removeEventListener("touchmove",_),window.removeEventListener("mousemove",_),window.removeEventListener("touchend",ee),window.removeEventListener("mouseup",ee)},Me=function(){Xe({ts:Date.now(),captchaType:K,clientUid:localStorage.getItem("slider")}).then(function(a){if(a.success){var o=a.data||{},x=o.repCode,c=o.repData,k=o.repMsg,T=k===void 0?"":k;x==="0000"&&(Le.current=c.token,we.current=c.secretKey,Y(c.originalImageBase64),C(c.jigsawImageBase64)),x=="6201"&&(Y(""),C(""),ue(!1),F(T),setTimeout(function(){F("")},1e3))}})},Ee=function(a){a=a||window.event;var o=a.touches?a.touches[0].pageX:a.clientX;xe.current=Math.floor(o-oe.current),I==!1&&(ye(""),U.current=!0,Z("#1890ff"),a.stopPropagation())},_=function(a){if(a=a||window.event,U.current&&I==!1){var o=a.touches?a.touches[0].pageX:a.clientX,x=oe.current,c=o-x,k=parseInt(m.width),T=parseInt("".concat(k/2)),te=Be.current-T-2;c>=te&&(c=te),c<=24&&(c=T),R.current=c-xe.current,je(R.current),Ze(R.current)}},be=function(){Me(),R.current=0,je(R.current),Ze(R.current),ye("\u5411\u53F3\u6ED1\u52A8\u5B8C\u6210\u9A8C\u8BC1"),Z("#1890ff"),y(!1),U.current=!1},ee=function(){if(U.current&&I==!1){var a=Le.current,o=we.current,x=parseInt("".concat(R.current))*310/parseInt(l.imgWidth),c=JSON.stringify({x,y:5});$e({captchaType:K,ts:Date.now(),token:a,pointJson:o?de(c,o):c}).then(function(k){if(k.success){var T=k.data||{},te=T.repCode,ht=T.repMsg;if(te==="0000"){y(!0),ue(!0),F("\u9A8C\u8BC1\u6210\u529F");var Re="".concat(a,"---").concat(c);Ie(o?de(Re,o):Re)}else y(!0),ue(!1),Z("#d9534f"),F(ht||"\u9A8C\u8BC1\u5931\u8D25");setTimeout(function(){be(),F("")},1e3)}}),U.current=!1}},vt=function(a){var o=a&&a.getBoundingClientRect().left,x=a&&a.offsetWidth;oe.current=o,Be.current=x},Ie=function(a){ie(!1,a)};return(0,t.jsx)(De.Z,{title:"\u8BF7\u5B8C\u6210\u5B89\u5168\u9A8C\u8BC1",visible:ne,footer:!1,destroyOnClose:!0,keyboard:!1,maskClosable:!1,width:parseInt(P.width)+48,onCancel:function(){return Ie()},bodyStyle:{padding:"12px 24px"},children:(0,t.jsx)("div",{className:"verifybox",children:(0,t.jsxs)("div",{style:{position:"relative"},className:"stop-user-select",children:[(0,t.jsx)("div",{className:"verify-img-out",style:{height:parseInt(l.imgHeight)+j},children:(0,t.jsxs)("div",{className:"verify-img-panel",style:{width:l.imgWidth,height:l.imgHeight},children:[(0,t.jsx)("div",{onClick:be,style:{height:32,width:32,lineHeight:"32px",borderRadius:32,backgroundColor:"rgb(0, 0, 0, 0.2)",textAlign:"center",position:"absolute",top:4,right:4},children:(0,t.jsx)(Ae.Z,{style:{color:"#fff",fontSize:"16px",fontWeight:800}})}),(0,t.jsx)("img",{alt:"",src:A?"data:image/png;base64,".concat(A):Ge(),style:{width:"100%",height:"100%",display:"block"}}),!!pe&&(0,t.jsx)("div",{className:"tips",children:(0,t.jsx)("span",{className:"verify-tips ".concat(st?"suc-bg":"err-bg"),children:pe})})]})}),(0,t.jsxs)("div",{className:"verify-bar-area",style:{width:l.imgWidth,height:b.height,lineHeight:b.height},ref:function(a){return vt(a)},children:[(0,t.jsx)("span",{className:"verify-msg",children:it}),(0,t.jsx)("div",{className:"verify-left-bar",style:{width:"".concat(ot,"px")||0,height:b.height,transition:W},children:(0,t.jsxs)("div",{onMouseDown:Ee,onTouchStart:Ee,className:"verify-move-block",style:{width:m.height,height:m.height,backgroundColor:u,left:"".concat(lt,"px"),transition:$},children:[(0,t.jsx)(Fe.Z,{style:{color:"#fff"}}),(0,t.jsx)("div",{className:"verify-sub-block",style:{width:"".concat(Math.floor(parseInt(l.imgWidth)*48/310),"px"),height:l.imgHeight,top:"-".concat(parseInt(l.imgHeight)+j,"px"),backgroundSize:"".concat(l.imgWidth," ").concat(l.imgHeight)},children:(0,t.jsx)("img",{alt:"",src:"data:image/png;base64,".concat(q),style:{width:"100%",height:"100%",display:"block"}})})]})})]})]})})})},Je=Ye,Qe=e(5481),qe=e.n(Qe),_e=e(34687),S=e.n(_e),et=function(i){var j=i.content;return(0,t.jsx)(ke.Z,{style:{marginBottom:24},message:j,type:"error",showIcon:!0})},re=void 0==="1",mt=null,tt=function(i){var j,m=(0,s.useState)(!1),l=(0,n.Z)(m,2),P=l[0],b=l[1],ne=(0,s.useState)(),D=(0,n.Z)(ne,2),K=D[0],X=D[1],$=(0,Oe.a)(),d=$.system,W=(0,L.YB)(),ie=function(){var C=(0,E.Z)((0,p.Z)().mark(function f(){return(0,p.Z)().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:case"end":return u.stop()}},f)}));return function(){return C.apply(this,arguments)}}(),V=(0,s.useRef)(),G=(0,s.useState)(!1),A=(0,n.Z)(G,2),Y=A[0],J=A[1],Q=function(){var C=(0,E.Z)((0,p.Z)().mark(function f(h,u){var Z,g,w;return(0,p.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(J(h),Z=V.current.getFieldsValue(),g=Z.username,w=Z.password,!(g&&w&&u)){y.next=5;break}return y.next=5,q({username:g,password:w,captchaVerification:u});case 5:b(!1);case 6:case"end":return y.stop()}},f)}));return function(h,u){return C.apply(this,arguments)}}(),q=function(){var C=(0,E.Z)((0,p.Z)().mark(function f(h){var u,Z,g,w,I,y;return(0,p.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,$.login(h);case 3:if(u=r.sent,!u.success){r.next=18;break}if(Z=W.formatMessage({id:"pages.login.success",defaultMessage:"\u767B\u5F55\u6210\u529F\uFF01"}),H.default.success(Z),!i.onOk){r.next=10;break}return i.onOk(),r.abrupt("return");case 10:return r.next=12,ie();case 12:if(L.m8){r.next=14;break}return r.abrupt("return");case 14:return g=L.m8.location.query,w=g,I=w.redirect,L.m8.push(I||"/"),r.abrupt("return");case 18:X(u.message&&"error"),r.next=25;break;case 21:r.prev=21,r.t0=r.catch(0),y=W.formatMessage({id:"pages.login.failure",defaultMessage:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01"}),H.default.error(y);case 25:b(!1);case 26:case"end":return r.stop()}},f,null,[[0,21]])}));return function(h){return C.apply(this,arguments)}}();return(0,t.jsxs)("div",{className:S().container,children:[(0,t.jsx)("div",{className:S().lang,"data-lang":!0,children:L.pD&&(0,t.jsx)(L.pD,{})}),(0,t.jsxs)("div",{className:S().content,children:[(0,t.jsxs)("div",{className:S().top,children:[(0,t.jsxs)("div",{className:S().header,children:[(0,t.jsx)("img",{alt:"logo",className:S().logo,src:d.avatar?"/api/public/preview/".concat(d==null?void 0:d.avatar):qe()}),(0,t.jsx)("span",{className:S().title,children:d==null?void 0:d.name})]}),(0,t.jsx)("div",{className:S().desc,children:d==null?void 0:d.description})]}),(0,t.jsx)("div",{className:S().main,children:(0,t.jsxs)(ae.ZP,{formRef:V,initialValues:re?{autoLogin:!0,username:"admin",password:"123456"}:{autoLogin:!0},submitter:{searchConfig:{submitText:W.formatMessage({id:"pages.login.submit",defaultMessage:"\u767B\u5F55"})},render:function(f,h){return h.pop()},submitButtonProps:{loading:P,size:"large",style:{width:"100%"},htmlType:"submit"}},isKeyPressSubmit:!0,onFinish:function(){var C=(0,E.Z)((0,p.Z)().mark(function f(h){var u;return(0,p.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!P){g.next=2;break}return g.abrupt("return");case 2:(u=d.setting)!==null&&u!==void 0&&u.captchaEnabled?J(!0):q(h),b(!0);case 4:case"end":return g.stop()}},f)}));return function(f){return C.apply(this,arguments)}}(),children:[K==="error"&&(0,t.jsx)(et,{content:W.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"\u8D26\u6237\u6216\u5BC6\u7801\u9519\u8BEF"})}),(0,t.jsx)(ae.V,{name:"username",fieldProps:{size:"large",prefix:(0,t.jsx)(Ne.Z,{className:S().prefixIcon})},placeholder:re?"\u7528\u6237\u540D(admin)":"\u7528\u6237\u540D",rules:[{required:!0,message:(0,t.jsx)(L._H,{id:"pages.login.username.required",defaultMessage:"\u8BF7\u8F93\u5165\u7528\u6237\u540D!"})}]}),(0,t.jsx)(ae.V.Password,{name:"password",fieldProps:{size:"large",prefix:(0,t.jsx)(Pe.Z,{className:S().prefixIcon})},placeholder:re?"\u5BC6\u7801(123456)":"\u5BC6\u7801",rules:[{required:!0,message:(0,t.jsx)(L._H,{id:"pages.login.password.required",defaultMessage:"\u8BF7\u8F93\u5165\u5BC6\u7801\uFF01"})}]}),((j=d.registerInfo)===null||j===void 0?void 0:j.registerEnabled)&&(0,t.jsx)("div",{style:{marginBottom:24,display:"flex",justifyContent:"flex-end"},children:(0,t.jsx)(We.rU,{to:"/user/register",children:(0,t.jsx)(L._H,{id:"pages.login.registerAccount",defaultMessage:"\u6CE8\u518C"})})})]})})]}),(0,t.jsx)(Je,{isShow:Y,verifyCaptcha:Q}),(0,t.jsx)(Te.Z,{})]})},at=(0,ze.Pi)(tt)},5481:function(M,N,e){M.exports=e.p+"static/logo.eaa834e3.svg"},79743:function(M,N,e){M.exports=e.p+"static/default.aac93cd7.jpg"},42480:function(){}}]);
