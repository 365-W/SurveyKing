(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6420],{23538:function(se,W,n){"use strict";n.d(W,{Z:function(){return $}});var M=n(28991),C=n(67294),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M468 128H160c-17.7 0-32 14.3-32 32v308c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V136c0-4.4-3.6-8-8-8zm-56 284H192V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210H136c-4.4 0-8 3.6-8 8v308c0 17.7 14.3 32 32 32h308c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zm-56 284H192V612h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm590-630H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V160c0-17.7-14.3-32-32-32zm-32 284H612V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210h-48c-4.4 0-8 3.6-8 8v134h-78V556c0-4.4-3.6-8-8-8H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h78v102c0 4.4 3.6 8 8 8h190c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zM746 832h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm142 0h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"qrcode",theme:"outlined"},r=I,Y=n(27029),H=function(G,J){return C.createElement(Y.Z,(0,M.Z)((0,M.Z)({},G),{},{ref:J,icon:r}))};H.displayName="QrcodeOutlined";var $=C.forwardRef(H)},11075:function(se,W,n){"use strict";n.d(W,{Z:function(){return $}});var M=n(28991),C=n(67294),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},r=I,Y=n(27029),H=function(G,J){return C.createElement(Y.Z,(0,M.Z)((0,M.Z)({},G),{},{ref:J,icon:r}))};H.displayName="RollbackOutlined";var $=C.forwardRef(H)},24616:function(se,W,n){"use strict";n.d(W,{Z:function(){return $}});var M=n(28991),C=n(67294),I={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},r=I,Y=n(27029),H=function(G,J){return C.createElement(Y.Z,(0,M.Z)((0,M.Z)({},G),{},{ref:J,icon:r}))};H.displayName="SettingOutlined";var $=C.forwardRef(H)},13241:function(se,W,n){"use strict";n.r(W),n.d(W,{Overview:function(){return ze},default:function(){return Nt}});var M=n(93224),C=n(11849),I=n(2824),r=n(67294),Y=n(51615),H=n(69968),$=n(8935),ne=[{key:"taskCenter",i:"taskCenter",tabs:[{key:"1",title:"\u5F85\u529E\u4E8B\u9879"},{key:"2",title:"\u5DF2\u529E\u4E8B\u9879"},{key:"3",title:"\u6284\u9001\u4E8B\u9879"},{key:"4",title:"\u6211\u53D1\u8D77\u7684"},{key:"5",title:"\u5168\u90E8\u6570\u636E"}],name:"taskCenter","data-grid":{x:0,y:0,w:12,h:2,i:"taskCenter"},widgetProps:{}},{key:"quickSetting",i:"quickSetting",name:"quickSetting",title:"\u7CFB\u7EDF\u8BBE\u7F6E","data-grid":{x:0,y:2,w:6,h:1,i:"quickSetting"}}],G=n(91512),J=n(68654),De=n(54549),me=n(11628),w=n(68489),ae=n(2299),we=n(69610),Be=n(27361),Me=n.n(Be),e=n(85893),Le=function s(){var t=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,we.Z)(this,s),this._registry=void 0,this.registerComponent=function(i,o){t._registry[i]=o},this.getComponent=function(i){return Me()(t._registry,"".concat(i),function(o){return(0,e.jsxs)("div",{children:[i,"\u5BF9\u5E94\u7EC4\u4EF6\u672A\u6CE8\u518C"]})})},this._registry=a},Ue=new Le,le=Ue,Tt=r.createContext({}),ce=n(21063),he=n(18111),Ft=n(71194),ge=n(50146),At=n(49111),ye=n(19650),Pt=n(59250),Ve=n(13013),Rt=n(57663),L=n(71577),bt=n(30887),xe=n(54689),zt=n(34792),U=n(48086),Dt=n(18106),je=n(67164),oe=n(11075),Ce=n(15873),de=n(73218),Se=n(28991),He={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"},Qe=He,We=n(27029),Ze=function(t,a){return r.createElement(We.Z,(0,Se.Z)((0,Se.Z)({},t),{},{ref:a,icon:Qe}))};Ze.displayName="SendOutlined";var Ie=r.forwardRef(Ze),$e=n(44545),Ke=n(58491),Ye=n(57254),Ge=n(98244),Je=n(40520),wt=n(38842),Bt=n(54420),pe=n(22122),Q=n(96156),Xe=n(94184),q=n.n(Xe),qe=n(7085),Ne=n(65632),_e=function(s,t){var a={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(s);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(a[i[o]]=s[i[o]]);return a},et=function(t){var a,i,o=t.prefixCls,d=t.className,g=t.color,c=g===void 0?"blue":g,h=t.dot,y=t.pending,m=y===void 0?!1:y,p=t.position,F=t.label,A=t.children,k=_e(t,["prefixCls","className","color","dot","pending","position","label","children"]),N=r.useContext(Ne.E_),S=N.getPrefixCls,l=S("timeline",o),O=q()((a={},(0,Q.Z)(a,"".concat(l,"-item"),!0),(0,Q.Z)(a,"".concat(l,"-item-pending"),m),a),d),P=q()((i={},(0,Q.Z)(i,"".concat(l,"-item-head"),!0),(0,Q.Z)(i,"".concat(l,"-item-head-custom"),!!h),(0,Q.Z)(i,"".concat(l,"-item-head-").concat(c),!0),i));return r.createElement("li",(0,pe.Z)({},k,{className:O}),F&&r.createElement("div",{className:"".concat(l,"-item-label")},F),r.createElement("div",{className:"".concat(l,"-item-tail")}),r.createElement("div",{className:P,style:{borderColor:/blue|red|green|gray/.test(c||"")?void 0:c}},h),r.createElement("div",{className:"".concat(l,"-item-content")},A))},Oe=et,tt=n(96159),nt=function(s,t){var a={};for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&t.indexOf(i)<0&&(a[i]=s[i]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(s);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(s,i[o])&&(a[i[o]]=s[i[o]]);return a},ke=function(t){var a,i=r.useContext(Ne.E_),o=i.getPrefixCls,d=i.direction,g=t.prefixCls,c=t.pending,h=c===void 0?null:c,y=t.pendingDot,m=t.children,p=t.className,F=t.reverse,A=F===void 0?!1:F,k=t.mode,N=k===void 0?"":k,S=nt(t,["prefixCls","pending","pendingDot","children","className","reverse","mode"]),l=o("timeline",g),O=typeof h=="boolean"?null:h,P=h?r.createElement(Oe,{pending:!!h,dot:y||r.createElement(qe.Z,null)},O):null,B=r.Children.toArray(m);B.push(P),A&&B.reverse();var x=function(E,ee){return N==="alternate"?E.props.position==="right"?"".concat(l,"-item-right"):E.props.position==="left"||ee%2==0?"".concat(l,"-item-left"):"".concat(l,"-item-right"):N==="left"?"".concat(l,"-item-left"):N==="right"||E.props.position==="right"?"".concat(l,"-item-right"):""},Z=B.filter(function(f){return!!f}),u=r.Children.count(Z),v="".concat(l,"-item-last"),D=r.Children.map(Z,function(f,E){var ee=E===u-2?v:"",fe=E===u-1?v:"";return(0,tt.Tm)(f,{className:q()([f.props.className,!A&&!!h?ee:fe,x(f,E)])})}),X=B.some(function(f){var E;return!!((E=f==null?void 0:f.props)===null||E===void 0?void 0:E.label)}),R=q()(l,(a={},(0,Q.Z)(a,"".concat(l,"-pending"),!!h),(0,Q.Z)(a,"".concat(l,"-reverse"),!!A),(0,Q.Z)(a,"".concat(l,"-").concat(N),!!N&&!X),(0,Q.Z)(a,"".concat(l,"-label"),X),(0,Q.Z)(a,"".concat(l,"-rtl"),d==="rtl"),a),p);return r.createElement("ul",(0,pe.Z)({},S,{className:R}),D)};ke.Item=Oe;var at=ke,Ee=at,Mt=n(22385),rt=n(31097),Lt=n(94233),ue=n(51890),it=n(89366),st={save:"blue",agree:"green",refuse:"red",reject:"red",revoke:"red",transfer:"red",todo:"orange"},_=function(t){return(0,e.jsx)(rt.Z,{placement:"bottom",title:(0,e.jsxs)("div",{style:{textAlign:"center",fontSize:12},children:[t.name,(0,e.jsx)("br",{}),t.email]}),children:t.avatar?(0,e.jsx)(ue.C,{src:"/api/public/preview/".concat(t.avatar),size:22}):(0,e.jsx)(ue.C,{icon:(0,e.jsx)(it.Z,{}),size:22})})},lt=function(t){var a=function(){if(t.approvalType==="save"){var o;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(_,(0,C.Z)({},t.auditUser)),(o=t.auditUser)===null||o===void 0?void 0:o.name," \u53D1\u8D77\u65B0\u7684"]})}else if(t.approvalType==="agree"){var d;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(_,(0,C.Z)({},t.auditUser)),(d=t.auditUser)===null||d===void 0?void 0:d.name," \u5BA1\u6279\u901A\u8FC7"]})}else if(t.approvalType==="todo"){var g,c;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ue.C.Group,{maxCount:3,children:(g=t.waitAuditUserList)===null||g===void 0?void 0:g.filter(function(p){return!!p}).map(function(p){return(0,r.createElement)(_,(0,C.Z)((0,C.Z)({},p),{},{key:p.userId}))})}),(c=t.waitAuditUserList)===null||c===void 0?void 0:c.length,"\u6210\u5458\u5904\u7406\u4E2D..."]})}else if(t.approvalType==="refuse"){var h;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(_,(0,C.Z)({},t.auditUser)),(h=t.auditUser)===null||h===void 0?void 0:h.name," \u5BA1\u6279\u62D2\u7EDD"]})}else if(t.approvalType==="rollback"){var y;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(_,(0,C.Z)({},t.auditUser)),(y=t.auditUser)===null||y===void 0?void 0:y.name," \u56DE\u9000\u81F3 ",t.newActivityName]})}else if(t.approvalType==="revert"){var m;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(_,(0,C.Z)({},t.auditUser)),(m=t.auditUser)===null||m===void 0?void 0:m.name," \u64A4\u9500\u5904\u7406"]})}};return(0,e.jsxs)(Ee.Item,{color:st[t.approvalType]||"gray",children:[(0,e.jsx)("div",{className:"audit-time",children:t.createAt}),(0,e.jsxs)("div",{className:"record-item",children:[(0,e.jsx)("div",{className:"item-header",children:t.activityName}),(0,e.jsxs)("div",{className:"item-content",children:[(0,e.jsxs)("div",{className:"content-row",children:[(0,e.jsx)("span",{className:q()("action",t.approvalType),children:a()}),(0,e.jsx)("span",{})]}),t.comment&&(0,e.jsx)("div",{className:"content-row",children:(0,e.jsx)("span",{className:"comment",children:t.comment})})]})]})]},t.id)},ct=function(t){var a=t.processInstanceId,i=(0,r.useState)(),o=(0,I.Z)(i,2),d=o[0],g=o[1];return(0,r.useEffect)(function(){w.hi.getAuditRecord(a).then(function(c){g(c)})},[a]),(0,r.useEffect)(function(){var c=document.getElementsByClassName("ant-tabs-content-holder");c.length>0&&(c[0].scrollTop=c[0].scrollHeight)},[d]),(0,e.jsx)(Ee,{className:"audit-timeline",children:d==null?void 0:d.map(function(c){return(0,r.createElement)(lt,(0,C.Z)((0,C.Z)({},c),{},{key:c.id||c.activityId}))})})},Ut=n(47673),Te=n(4107),ot=Te.Z.TextArea;function dt(s){var t=(0,r.useState)(),a=(0,I.Z)(t,2),i=a[0],o=a[1];return(0,e.jsxs)(ge.Z,{visible:!0,title:"\u786E\u8BA4",onOk:function(){return s.onOk(i)},onCancel:s.onCancel,okButtonProps:s.buttonProps,children:[(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:10},children:"\u5904\u7406\u53CD\u9988"}),(0,e.jsx)(ot,{placeholder:"\u5728\u6B64\u5904\u8F93\u5165\u5904\u7406\u53CD\u9988\uFF0C\u53EF\u4E0D\u586B\u76F4\u63A5\u63D0\u4EA4",value:i,onChange:function(g){return o(g.target.value)}})]})}var Fe=je.Z.TabPane,K="task-edit-modal",ut=(0,ae.Pi)(function(s){var t=s.currentRecord,a=s.currIndex,i=s.total,o=s.onClose,d=s.onNav,g=s.taskType,c=(0,r.useState)(345),h=(0,I.Z)(c,2),y=h[0],m=h[1],p=(0,r.useRef)(null),F=(0,r.useState)(),A=(0,I.Z)(F,2),k=A[0],N=A[1],S=(0,r.useRef)(null),l=(0,r.useState)([]),O=(0,I.Z)(l,2),P=O[0],B=O[1],x=(0,r.useState)(),Z=(0,I.Z)(x,2),u=Z[0],v=Z[1];(0,r.useEffect)(function(){w.hi.loadFlowSchema({activityId:t.activityId,projectId:t.projectId}).then(function(b){return N(b)})},[t]);var D=(0,r.useState)(!1),X=(0,I.Z)(D,2),R=X[0],f=X[1];(0,r.useEffect)(function(){var b,z=t.answer,j=t.attachment;(b=S.current)===null||b===void 0||b.setValues(z,j)},[t]);var E=function(){return k?(0,e.jsx)(Je.O,{ref:S,schema:k,headerVisible:!1,footerVisible:!1,paginationVisible:!1,initialValues:t.answer,fieldPermission:t.fieldPermission}):(0,e.jsx)(e.Fragment,{})},ee=function(z){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;d(z==="up"?a-1:a+1,j)},fe=function(){return(0,e.jsx)("div",{style:{position:"absolute",height:"100%",width:"100%",overflow:"hidden"},children:(0,e.jsxs)(je.Z,{defaultActiveKey:"1",children:[(0,e.jsx)(Fe,{tab:"\u65E5\u5FD7",children:(0,e.jsx)(ct,{processInstanceId:t.processInstanceId})},"1"),(0,e.jsx)(Fe,{tab:"\u7559\u8A00",children:"Content of Tab Pane 2"},"2")]})})},Ot=function(){return(0,e.jsx)(xe.Z,{onClick:function(j){var T,te=j.key;(T=S.current)===null||T===void 0||T.submit().then(function(V){V?v({visible:!0,buttonProps:{type:"ghost",icon:(0,e.jsx)(oe.Z,{})},callback:function(Et){f(!0),w.hi.approvalTask({answer:V.values,attachment:V.attachments,answerId:t.answerId,taskId:t.id,type:"rollback",activityId:t.activityId,comment:Et,projectId:t.projectId,processInstanceId:t.processInstanceId,newActivityId:te}).then(function(){U.default.success("\u5DF2\u56DE\u9000"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},children:P==null?void 0:P.map(function(z,j){return(0,e.jsx)(xe.Z.Item,{children:(0,e.jsx)("a",{children:j!==P.length-1?z.activityName:"\u53D1\u8D77\u4EBA"})},z.activityId)})})},kt=function(){return(0,e.jsxs)(ye.Z,{children:[g===1&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(L.Z,{type:"primary",loading:R,icon:(0,e.jsx)(Ce.Z,{}),onClick:function(){var j;(j=S.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",icon:(0,e.jsx)(Ce.Z,{})},callback:function(V){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"agree",activityId:t.activityId,comment:V,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){U.default.success("\u5BA1\u6838\u901A\u8FC7"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},children:"\u901A\u8FC7"}),(0,e.jsx)(L.Z,{type:"primary",danger:!0,icon:(0,e.jsx)(de.Z,{}),loading:R,onClick:function(){var j;(j=S.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",danger:!0,icon:(0,e.jsx)(de.Z,{})},callback:function(V){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"refuse",activityId:t.activityId,comment:V,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){U.default.success("\u5DF2\u62D2\u7EDD"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},children:"\u62D2\u7EDD"}),(0,e.jsx)(Ve.Z,{overlay:Ot,placement:"topCenter",trigger:["click"],children:(0,e.jsx)(L.Z,{onClick:function(){w.hi.getRevertNodes(t.processInstanceId).then(function(j){j&&B(j)})},icon:(0,e.jsx)(oe.Z,{}),loading:R,children:"\u56DE\u9000"})})]}),g===2&&t.status===1&&t.latest&&t.approvalType!=="revert"&&(0,e.jsx)(L.Z,{onClick:function(){var j;(j=S.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",danger:!0,icon:(0,e.jsx)(de.Z,{})},callback:function(V){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"revert",activityId:t.activityId,newActivityId:t.activityId,comment:V,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){U.default.success("\u5DF2\u64A4\u56DE"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},icon:(0,e.jsx)(oe.Z,{}),loading:R,children:"\u64A4\u56DE"}),g===4&&t.status===6&&(0,e.jsx)(L.Z,{onClick:function(){var j;(j=S.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",icon:(0,e.jsx)(Ie,{})},callback:function(V){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"save",activityId:t.activityId,comment:V,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){U.default.success("\u5DF2\u64A4\u56DE"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},icon:(0,e.jsx)(Ie,{}),loading:R,children:"\u518D\u6B21\u63D0\u4EA4"}),(0,e.jsx)(L.Z,{onClick:function(){},icon:(0,e.jsx)($e.Z,{}),loading:R})]})};return(0,e.jsx)("div",{ref:p,className:"edit-data ",children:(0,e.jsxs)(ge.Z,{visible:!0,maskClosable:!1,title:!1,width:900,onCancel:function(){return o()},className:"task-edit-modal",footer:!1,children:[(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsxs)("div",{className:K+"-survey-container",style:{flex:1},children:[(0,e.jsx)("div",{className:K+"-survey-container-title",children:"\u6211\u7684\u5BA1\u6279"}),(0,e.jsx)("div",{className:K+"-survey-container-content",children:E()}),(0,e.jsxs)("div",{className:K+"-survey-container-footer",children:[(0,e.jsxs)("div",{className:"nav",children:[(0,e.jsxs)("span",{children:[a+1,"/",i]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(L.Z,{type:"text",shape:"circle",icon:(0,e.jsx)(Ke.Z,{}),disabled:a===0,onClick:function(){return ee("up")}}),(0,e.jsx)(L.Z,{type:"text",shape:"circle",icon:(0,e.jsx)(Ye.Z,{}),disabled:a===i-1,onClick:function(){return ee("down")}})]})]}),kt()]})]}),(0,e.jsxs)("div",{className:K+"-metaInfo-container",style:{width:y},children:[(0,e.jsx)("div",{className:K+"-metaInfo-container-title"}),(0,e.jsx)("div",{className:K+"-metaInfo-container-content",children:fe()}),(0,e.jsx)("div",{className:K+"-metaInfo-container-resizer",style:{transform:y===0?"rotateY(180deg) translate3d(100%,-50%,0)":"translate3d(0,-50%,0)"},onClick:function(){m(y===0?350:0)},children:(0,e.jsx)(Ge.Z,{})})]})]}),(u==null?void 0:u.visible)&&(0,e.jsx)(dt,{onOk:function(z){return u.callback(z)},onCancel:function(){return v(void 0)},buttonProps:u.buttonProps})]})})}),vt=(0,ae.Pi)(function(s){var t=s.projectId,a=s.taskType,i=(0,r.useContext)(ve),o=(0,w.iZ)(t),d=(0,w.Ge)(t),g=(0,r.useRef)(),c=d.tasks[a]||{list:[],total:0,current:1,pageSize:50},h=(0,r.useState)(),y=(0,I.Z)(h,2),m=y[0],p=y[1],F=(0,r.useState)(),A=(0,I.Z)(F,2),k=A[0],N=A[1];(0,r.useEffect)(function(){var x=c.list.length;if(m===void 0){N(void 0);return}if(x===0){p(void 0);return}if(m>=x){p(0);return}m!==void 0&&c.current&&c.total&&N({currIndex:m,total:c.total,currentRecord:c.list[m]})},[m,c]);var S=function(Z,u){d.loadFlowTasks({type:a,projectId:t,current:Z,pageSize:u})};(0,r.useEffect)(function(){(a||m===void 0)&&S()},[a,m]);var l=o.schema,O=(0,r.useMemo)(function(){var x=(0,he.ZZ)(l)||[];return x.splice(0,0,{name:"approvalStage",title:"\u5F53\u524D\u6D41\u7A0B\u72B6\u6001",width:180}),x.push({name:"createUser",title:"\u7533\u8BF7\u4EBA"}),x.push({name:"createAt",title:"\u7533\u8BF7\u65F6\u95F4",width:180}),x.push({name:"updateAt",title:"\u66F4\u65B0\u65F6\u95F4",width:180}),x},[l]),P=(0,r.useMemo)(function(){var x=(0,he.IR)(c.list,O);return x.forEach(function(Z){var u;Z.createUser=(u=Z.createUser)===null||u===void 0?void 0:u.name}),x},[c,O]),B=function(Z,u){k&&(u?d.removeTask(k.currentRecord.id,a):p(Z))};return(0,e.jsxs)("div",{children:[(0,e.jsx)(ce._$,{ref:g,width:i.width-10,height:i.height-95,data:P,schema:O,selectionMode:"row",allowSorting:!0,onDoubleClick:function(Z){var u;if(((u=Z.data)===null||u===void 0?void 0:u._i)!==void 0){var v;p((v=Z.data)===null||v===void 0?void 0:v._i)}}}),(0,e.jsxs)("div",{className:"statusBar-container",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{style:{fontSize:12,color:"##767e89",userSelect:"none"},children:"\u53CC\u51FB\u884C\u5BA1\u6279"})}),(0,e.jsxs)("div",{children:[(0,e.jsx)(ce.tl,{current:c.current,pageSize:c.pageSize,total:c.total,onChange:function(Z){S(Z.current,Z.pageSize)}}),(0,e.jsx)(ce.hY,{onClick:function(){return S(c.current,c.pageSize)}})]}),(0,e.jsx)("div",{})]}),k&&(0,e.jsx)(ut,(0,C.Z)((0,C.Z)({},k),{},{taskType:a,onClose:function(){p(void 0)},onNav:B}))]})}),ft=(0,ae.Pi)(function(s){var t=(0,r.useContext)(me.xI),a=(t==null?void 0:t.id)||s.projectId,i=(0,w.iZ)(a),o=St();return(0,r.useEffect)(function(){i.loadProject()},[i,a]),(0,e.jsx)("div",{style:{padding:"2px 5px"},className:"task-widget",children:(0,e.jsx)(vt,{projectId:a,taskType:parseInt(o.activeKey||"0")})})});le.registerComponent("taskCenter",ft);var Vt=n(13062),Ae=n(71230),Ht=n(77576),Pe=n(12028),Qt=n(89032),re=n(15746),Wt=n(20136),mt=n(55241),Re=n(3182),ht=n(94043),ie=n.n(ht),gt=n(23538),be=n(92592),yt=Te.Z.Search;function xt(s){return"".concat(window.location.origin,"/s/").concat(s)}var jt=function(){var t,a,i,o,d=(0,me.IE)(),g=d.loading,c=(t=d.project)===null||t===void 0||(a=t.setting)===null||a===void 0?void 0:a.status,h=(0,r.useState)(c===1),y=(0,I.Z)(h,2),m=y[0],p=y[1],F=(i=d.project)===null||i===void 0||(o=i.setting)===null||o===void 0?void 0:o.answerSetting.autoSave,A=(0,r.useState)(F),k=(0,I.Z)(A,2),N=k[0],S=k[1];(0,r.useEffect)(function(){p(c===1)},[c]),(0,r.useEffect)(function(){S(F)},[F]);var l=xt(d.id),O=(0,r.useState)(""),P=(0,I.Z)(O,2),B=P[0],x=P[1];(0,r.useEffect)(function(){function u(){return v.apply(this,arguments)}function v(){return v=(0,Re.Z)(ie().mark(function D(){return ie().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:be.toDataURL(l,{errorCorrectionLevel:"H",type:"image/jpeg",quality:.3,margin:1,color:{dark:"#010599FF",light:"#FFBF60FF"}}).then(function(f){x(f)}).catch(function(f){console.error(f)});case 1:case"end":return R.stop()}},D)})),v.apply(this,arguments)}u()},[l]);var Z=(0,r.useCallback)(function(){var u=(0,Re.Z)(ie().mark(function v(D){return ie().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:be.toDataURL(l,{errorCorrectionLevel:"H",margin:1,color:{dark:"#010599FF",light:"#FFBF60FF"},width:D}).then(function(f){x(f);var E=document.createElement("a");E.href=f,E.setAttribute("download","".concat(d.name,"_").concat(D,".png")),document.body.appendChild(E),E.click(),document.body.removeChild(E)});case 1:case"end":return R.stop()}},v)}));return function(v){return u.apply(this,arguments)}}(),[l,d]);return(0,e.jsx)(Ae.Z,{gutter:[20,20],style:{padding:10},children:(0,e.jsx)(re.Z,{sm:24,xs:24,children:(0,e.jsxs)(Ae.Z,{gutter:[10,10],children:[(0,e.jsxs)(re.Z,{span:24,className:"setting-item",children:[(0,e.jsx)(yt,{value:l,style:{width:360},enterButton:"\u6253\u5F00",className:"open-target",onSearch:function(){window.open("/s/".concat(d.id))}}),(0,e.jsx)(mt.Z,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("img",{src:B,height:150,width:150}),(0,e.jsx)("div",{style:{textAlign:"center"},children:(0,e.jsxs)(ye.Z,{children:[(0,e.jsx)(L.Z,{size:"small",type:"link",onClick:function(){return Z(256)},children:"\u5C0F\u53F7"}),(0,e.jsx)(L.Z,{size:"small",type:"link",onClick:function(){return Z(512)},children:"\u4E2D\u53F7"}),(0,e.jsx)(L.Z,{size:"small",type:"link",onClick:function(){return Z(1024)},children:"\u5927\u53F7"})]})})]}),title:"".concat(d.name,"(\u4E8C\u7EF4\u7801)"),trigger:["click"],children:(0,e.jsx)(gt.Z,{style:{fontSize:30}})})]}),(0,e.jsxs)(re.Z,{className:"setting-item",span:24,children:[(0,e.jsx)("div",{className:"title",children:"\u95EE\u5377\u5F00\u542F/\u505C\u6B62"}),(0,e.jsx)("div",{children:(0,e.jsx)(Pe.Z,{checked:m,onChange:function(v){p(v),w.hi.updateSetting({id:d.id,settingKey:"status",settingValue:v?1:0}).then(function(D){D.code===200?v?U.default.info("\u95EE\u5377\u5DF2\u5F00\u542F"):U.default.warn("\u95EE\u5377\u5DF2\u505C\u6B62"):U.default.error(D.message)})}})})]}),(0,e.jsxs)(re.Z,{className:"setting-item",span:24,children:[(0,e.jsx)("div",{className:"title",children:"\u95EE\u5377\u586B\u5199\u65F6\u81EA\u52A8\u4FDD\u5B58"}),(0,e.jsx)("div",{children:(0,e.jsx)(Pe.Z,{checked:N,onChange:function(v){S(v),w.hi.updateSetting({id:d.id,settingKey:"answerSetting.autoSave",settingValue:v}).then(function(D){D.code===200?v?U.default.info("\u6682\u5B58\u5DF2\u5F00\u542F"):U.default.warn("\u6682\u5B58\u5DF2\u505C\u6B62"):U.default.error(D.message)})}})})]})]})})})};le.registerComponent("quickSetting",(0,ae.Pi)(jt));var Ct=function(t){var a=t.tabs,i=t.defaultActive,o=(0,r.useState)(i||a[0].key),d=(0,I.Z)(o,2),g=d[0],c=d[1],h=function(m){c(m),t.onChange(m)};return(0,e.jsx)("div",{className:"tabs-nav-list",children:a.map(function(y){return(0,e.jsx)("div",{onClick:function(){return h(y.key)},className:q()("tabs-tab",{active:g===y.key}),children:y.title},y.key)})})},ve=r.createContext({});function St(){return(0,r.useContext)(ve)}var Zt=r.forwardRef(function(s,t){var a=s.style,i=s.className,o=s.key,d=s.children,g=s.name,c=s.title,h=s.tabs,y=s.widgetProps,m=s.toggleFullScreen,p=(0,M.Z)(s,["style","className","key","children","name","title","tabs","widgetProps","toggleFullScreen"]),F=(0,r.useState)(h&&h[0].key),A=(0,I.Z)(F,2),k=A[0],N=A[1],S=(0,r.useState)(!1),l=(0,I.Z)(S,2),O=l[0],P=l[1],B=function(){return h?(0,e.jsx)(Ct,{tabs:h,onChange:function(u){return N(u)}}):(0,e.jsx)("span",{className:"",children:c})};return(0,e.jsxs)("div",(0,C.Z)((0,C.Z)({style:(0,C.Z)({},a),className:["widget",i].join(" ")},p),{},{ref:t,children:[(0,e.jsxs)("div",{className:"header",children:[(0,e.jsxs)("span",{className:"title",children:[B(),(0,e.jsx)("div",{className:"drag-handle"})]}),(0,e.jsxs)("div",{className:"widget-controls",children:[O&&(0,e.jsx)(G.Z,{className:"control-item",onClick:function(){P(!1),m()}}),!O&&(0,e.jsx)(J.Z,{className:"control-item",onClick:function(){P(!0),m()}}),(0,e.jsx)(De.Z,{className:"control-item"})]})]}),(0,e.jsx)($.SizeMe,{monitorHeight:!0,children:function(Z){var u=Z.size;return(0,e.jsx)(ve.Provider,{value:{height:u.height||0,width:u.width||0,activeKey:k},children:(0,e.jsx)("div",{style:{height:"100%"},children:r.createElement(le.getComponent(g),y)})})}}),d]}),o)}),It=Zt,pt=n(18673),ze=function(t){var a=(0,Y.UO)(),i=a.id,o=(0,r.useState)(ne),d=(0,I.Z)(o,2),g=d[0],c=d[1],h=(0,r.useRef)(0),y=(0,r.useState)(),m=(0,I.Z)(y,2),p=m[0],F=m[1];if(i==="new")return(0,e.jsx)(pt.default,(0,C.Z)({},t));var A=function(N){if(p)c(p.cacheData),F(void 0);else{var S=JSON.parse(JSON.stringify(g.find(function(l){return l.key===N})));F({key:N,cacheData:g}),S["data-grid"]={x:0,y:0,w:12,h:(h.current-100)/150,i:N,static:!0},c([S])}};return(0,e.jsx)("div",{className:"survey-overview",children:(0,e.jsx)($.SizeMe,{monitorHeight:!0,children:function(N){var S=N.size;return h.current=S.height||0,(0,e.jsx)(H.Responsive,{autoSize:!1,className:"layout",onDrag:function(O){},draggableHandle:".drag-handle",breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:12,sm:12,xs:4,xxs:2},width:S.width||0,layouts:{lg:g.map(function(l){return l["data-grid"]}),md:g.map(function(l){return l["data-grid"]})},useCSSTransforms:!1,onLayoutChange:function(O){},children:g.map(function(l){var O=l.key,P=(0,M.Z)(l,["key"]);return(0,e.jsx)(It,(0,C.Z)((0,C.Z)({},P),{},{toggleFullScreen:function(){return A(O)}}),O)})})}})})},Nt=ze},54420:function(){}}]);
