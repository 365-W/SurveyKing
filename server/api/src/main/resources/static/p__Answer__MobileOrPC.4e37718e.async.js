(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1835],{36432:function(_,f,e){"use strict";e.r(f),e.d(f,{MobileOrPC:function(){return re},default:function(){return me}});var l=e(57106),v=e(99683),P=e(57338),L=e(25084),U=e(71194),Z=e(50146),$=e(57663),A=e(71577),j=e(9715),d=e(93766),w=e(47673),s=e(4107),g=e(2824),z=e(51615),h=e(67294),x=e(28991),V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},K=V,M=e(27029),S=function(a,r){return h.createElement(M.Z,(0,x.Z)((0,x.Z)({},a),{},{ref:r,icon:K}))};S.displayName="LockFilled";var H=h.forwardRef(S),B={icon:function(a,r){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:r}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:r}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:a}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:a}}]}},name:"eye",theme:"twotone"},J=B,N=function(a,r){return h.createElement(M.Z,(0,x.Z)((0,x.Z)({},a),{},{ref:r,icon:J}))};N.displayName="EyeTwoTone";var G=h.forwardRef(N),m=e(88633),Q=e(2299),I=e(87998),W=e(92725),R=e(30931),X=e(40208),te=e(71631),F=e(3182),ce=e(69610),ve=e(54941),fe=e(94043),D=e.n(fe),k=e(68489),i=e(54531),he=function(){function C(a){var r;(0,ce.Z)(this,C),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.startTime=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.confirmTempAnswerType=0,this.id=a,this.makeObservable(),this.loadProject(),this.startTime=new Date().getTime(),this.confirmTempAnswerType=(r=this.savedAnswer)!==null&&r!==void 0&&r.progress?1:0}return(0,ve.Z)(C,[{key:"makeObservable",value:function(){(0,i.Ou)(this,{id:i.LO.ref,survey:i.LO.ref,loading:i.LO.ref,saving:i.LO.ref,verifying:i.LO.ref,project:i.LO.ref,errorCode:i.LO.ref,errorMessage:i.LO.ref,progress:i.LO.ref,confirmTempAnswerType:i.LO.ref,passwordRequired:i.LO.computed,loginRequired:i.LO.computed,tempSaveId:i.LO.computed,savedAnswer:i.LO.computed,status:i.LO.computed,setting:i.LO.computed,tempSave:i.aD,saveData:i.aD,loadProject:i.aD,verifyPassword:i.aD,changeProgress:i.aD})}},{key:"setting",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.setting}},{key:"status",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.status}},{key:"passwordRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.passwordRequired}},{key:"loginRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.loginRequired}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var r=localStorage.getItem(this.tempSaveId);return r&&JSON.parse(r)}},{key:"tempSave",value:function(r){var u=localStorage.getItem(this.tempSaveId),t;u?(t=JSON.parse(u),t.answer=r,t.progress=this.progress):t={answer:r,metaInfo:{answerInfo:{startTime:new Date().getTime()}},progress:this.progress},localStorage.setItem(this.tempSaveId,JSON.stringify(t))}},{key:"saveData",value:function(){var a=(0,F.Z)(D().mark(function u(t){var E;return D().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.saving=!0,E={answer:t,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()}}},o.next=4,k.hi.post("/api/public/saveAnswer",E);case 4:localStorage.removeItem(this.tempSaveId),this.saving=!1;case 6:case"end":return o.stop()}},u,this)}));function r(u){return a.apply(this,arguments)}return r}()},{key:"loadProject",value:function(){var a=(0,F.Z)(D().mark(function u(){var t;return D().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return this.loading=!0,O.next=3,k.hi.post("/api/public/loadProject",{id:this.id});case 3:t=O.sent,t.success?(this.project=t.data,this.survey=t.data.survey):this.errorMessage=t.message,this.errorCode=t.code,this.loading=!1;case 7:case"end":return O.stop()}},u,this)}));function r(){return a.apply(this,arguments)}return r}()},{key:"verifyPassword",value:function(){var a=(0,F.Z)(D().mark(function u(t){var E;return D().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.verifying=!0,o.next=3,k.hi.post("/api/public/verifyPassword",{id:this.id,password:t});case 3:if(E=o.sent,this.verifying=!1,E.code!==200){o.next=8;break}return this.survey=E.data.survey,o.abrupt("return",!0);case 8:return o.abrupt("return",!1);case 9:case"end":return o.stop()}},u,this)}));function r(u){return a.apply(this,arguments)}return r}()},{key:"upload",value:function(){var a=(0,F.Z)(D().mark(function u(t,E){return D().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",k.hi.upload("/api/public/upload",{file:t},E));case 1:case"end":return o.stop()}},u)}));function r(u,t){return a.apply(this,arguments)}return r}()},{key:"changeProgress",value:function(r){this.progress=r}}]),C}(),ge=e(19319),n=e(85893),re=(0,Q.Pi)(function(){var C,a,r=(0,z.UO)(),u=r.id,t=(0,h.useMemo)(function(){return new he(u)},[u]),E=(0,h.useState)(!1),O=(0,g.Z)(E,2),o=O[0],pe=O[1],Y=(0,h.useMemo)(function(){return(0,I.SB)()},[]),ye=(0,h.useRef)(null),Ee=t.saving,Oe=t.loading,Pe=(C=t.setting)===null||C===void 0?void 0:C.answerSetting,b=Pe||{},ne=b.autoSave,q=b.progressBar,Ce=b.initialValues,je=b.questionNumber,Me=b.wechatOnly,De=(a=t.setting)===null||a===void 0?void 0:a.submittedSetting,Te=De||{},ae=Te.contentHtml,_e=t.errorMessage,ee=t.savedAnswer,se=t.confirmTempAnswerType,we=(0,h.useState)(),ie=(0,g.Z)(we,2),oe=ie[0],xe=ie[1],Se=(0,h.useState)({}),le=(0,g.Z)(Se,2),ue=le[0],Le=le[1],Ie=(0,h.useCallback)(function(T,c){q&&t.changeProgress(c),ne&&T&&t.tempSave(T)},[q]),Re=function(){var c;return(0,n.jsxs)("div",{className:"password-confirm",children:[(0,n.jsx)("h3",{children:(c=t.project)===null||c===void 0?void 0:c.name}),(0,n.jsx)(Z.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,n.jsxs)(d.Z,{style:{margin:"10px 0"},children:[(0,n.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,n.jsx)(d.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:ue.validateStatus,help:ue.help,children:(0,n.jsx)(s.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,n.jsx)(H,{}),onChange:function(y){return xe(y.target.value)},iconRender:function(y){return y?(0,n.jsx)(G,{}):(0,n.jsx)(m.Z,{})}})}),(0,n.jsx)(A.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:t.verifying,onClick:function(){oe&&t.verifyPassword(oe).then(function(y){y||Le({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},Ze=function(){return(0,n.jsx)(L.Z,{visible:!0,width:"100%",closable:!1,bodyStyle:{padding:0},children:(0,n.jsx)(ge.default,{onOk:function(){t.loadProject()}})})},de=function(c){var p,y;return(0,n.jsxs)("div",{className:"render-failure ".concat(Y?"mobile":"phone"),children:[((p=t.project)===null||p===void 0?void 0:p.name)&&(0,n.jsx)("div",{className:"title",children:(y=t.project)===null||y===void 0?void 0:y.name}),(0,n.jsxs)("div",{className:"content",children:[(0,n.jsx)("div",{children:(0,n.jsx)(R.AT,{})}),(0,n.jsx)("h2",{children:_e||c}),(0,n.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Ae=function(){if(t.loading)return(0,n.jsx)(W.Z,{});if(t.errorCode!==200)return de();if(Me&&!(0,I.CL)())return de("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(t.survey&&!o)return se===1&&ne?(0,n.jsx)(R.oq,{}):(0,n.jsx)(X.O,{ref:ye,loading:Ee||Oe,progressBar:q,questionNumber:je,theme:Y?"antdmobile":"antd",schema:t.survey,onChange:Ie,initialValues:se===3?void 0:(ee==null?void 0:ee.answer)||Ce,onUpload:t.upload,onSubmit:function(p){t.saveData(p).then(function(){return pe(!0)})}});if(t.loginRequired)return(0,n.jsx)("div",{children:Ze()});if(t.passwordRequired)return(0,n.jsx)("div",{children:Re()})},Be=function(){return o?ae?(0,n.jsxs)("div",{className:"success-content",children:[(0,n.jsx)(R.hl,{html:ae}),(0,n.jsx)("div",{style:{textAlign:"center"},children:(0,n.jsx)(A.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")})]}):(0,n.jsx)(v.ZP,{status:"success",title:"\u7B54\u6848\u5DF2\u4FDD\u5B58!",extra:[(0,n.jsx)(A.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")]}):(0,n.jsx)(n.Fragment,{})},be=function(){var c,p,y=(c=t.survey)===null||c===void 0||(p=c.attribute)===null||p===void 0?void 0:p.backgroundImage;if(y)return{backgroundImage:"url(/api/public/preview/".concat(y,")")}};return(0,n.jsx)(I.ff.Provider,{value:t,children:(0,n.jsxs)("div",{className:"survey ".concat(Y?"mobile":"pc"),style:be(),children:[Ae(),Be()]})})}),me=re},57838:function(_,f,e){"use strict";e.d(f,{Z:function(){return P}});var l=e(28481),v=e(67294);function P(){var L=v.useReducer(function($){return $+1},0),U=(0,l.Z)(L,2),Z=U[1];return Z}},15746:function(_,f,e){"use strict";var l=e(21584);f.Z=l.Z},89032:function(_,f,e){"use strict";var l=e(38842),v=e.n(l),P=e(6999)},27049:function(_,f,e){"use strict";var l=e(22122),v=e(96156),P=e(67294),L=e(94184),U=e.n(L),Z=e(65632),$=function(j,d){var w={};for(var s in j)Object.prototype.hasOwnProperty.call(j,s)&&d.indexOf(s)<0&&(w[s]=j[s]);if(j!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,s=Object.getOwnPropertySymbols(j);g<s.length;g++)d.indexOf(s[g])<0&&Object.prototype.propertyIsEnumerable.call(j,s[g])&&(w[s[g]]=j[s[g]]);return w},A=function(d){return P.createElement(Z.C,null,function(w){var s,g=w.getPrefixCls,z=w.direction,h=d.prefixCls,x=d.type,V=x===void 0?"horizontal":x,K=d.orientation,M=K===void 0?"center":K,S=d.orientationMargin,H=d.className,B=d.children,J=d.dashed,N=d.plain,G=$(d,["prefixCls","type","orientation","orientationMargin","className","children","dashed","plain"]),m=g("divider",h),Q=M.length>0?"-".concat(M):M,I=!!B,W=M==="left"&&S!=null,R=M==="right"&&S!=null,X=U()(m,"".concat(m,"-").concat(V),(s={},(0,v.Z)(s,"".concat(m,"-with-text"),I),(0,v.Z)(s,"".concat(m,"-with-text").concat(Q),I),(0,v.Z)(s,"".concat(m,"-dashed"),!!J),(0,v.Z)(s,"".concat(m,"-plain"),!!N),(0,v.Z)(s,"".concat(m,"-rtl"),z==="rtl"),(0,v.Z)(s,"".concat(m,"-no-default-orientation-margin-left"),W),(0,v.Z)(s,"".concat(m,"-no-default-orientation-margin-right"),R),s),H),te=(0,l.Z)((0,l.Z)({},W&&{marginLeft:S}),R&&{marginRight:S});return P.createElement("div",(0,l.Z)({className:X},G,{role:"separator"}),B&&P.createElement("span",{className:"".concat(m,"-inner-text"),style:te},B))})};f.Z=A},48736:function(_,f,e){"use strict";var l=e(38842),v=e.n(l),P=e(62563),L=e.n(P)},71230:function(_,f,e){"use strict";var l=e(92820);f.Z=l.Z},13062:function(_,f,e){"use strict";var l=e(38842),v=e.n(l),P=e(6999)},62563:function(){}}]);
