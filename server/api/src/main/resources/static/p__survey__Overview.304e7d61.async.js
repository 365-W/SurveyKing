(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[6420],{11075:function(fe,Q,n){"use strict";n.d(Q,{Z:function(){return Y}});var H=n(28991),Z=n(67294),N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"},i=N,q=n(27029),$=function(_,ee){return Z.createElement(q.Z,(0,H.Z)((0,H.Z)({},_),{},{ref:ee,icon:i}))};$.displayName="RollbackOutlined";var Y=Z.forwardRef($)},24616:function(fe,Q,n){"use strict";n.d(Q,{Z:function(){return Y}});var H=n(28991),Z=n(67294),N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},i=N,q=n(27029),$=function(_,ee){return Z.createElement(q.Z,(0,H.Z)((0,H.Z)({},_),{},{ref:ee,icon:i}))};$.displayName="SettingOutlined";var Y=Z.forwardRef($)},57529:function(){},13241:function(fe,Q,n){"use strict";n.r(Q),n.d(Q,{Overview:function(){return De},default:function(){return Nt}});var H=n(93224),Z=n(11849),N=n(2824),i=n(67294),q=n(51615),$=n(69968),Y=n(8935),re=[{key:"taskCenter",i:"taskCenter",tabs:[{key:"1",title:"\u5F85\u529E\u4E8B\u9879"},{key:"2",title:"\u5DF2\u529E\u4E8B\u9879"},{key:"3",title:"\u6284\u9001\u4E8B\u9879"},{key:"4",title:"\u6211\u53D1\u8D77\u7684"},{key:"5",title:"\u5168\u90E8\u6570\u636E"}],name:"taskCenter","data-grid":{x:0,y:0,w:12,h:2,i:"taskCenter"},widgetProps:{}},{key:"quickSetting",i:"quickSetting",name:"quickSetting",title:"\u7CFB\u7EDF\u8BBE\u7F6E","data-grid":{x:0,y:2,w:6,h:1,i:"quickSetting"}}],_=n(91512),ee=n(68654),ze=n(54549),me=n(11628),w=n(68489),ne=n(2299),we=n(69610),Be=n(27361),Me=n.n(Be),e=n(85893),Le=function s(){var t=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,we.Z)(this,s),this._registry=void 0,this.registerComponent=function(r,o){t._registry[r]=o},this.getComponent=function(r){return Me()(t._registry,"".concat(r),function(o){return(0,e.jsxs)("div",{children:[r,"\u5BF9\u5E94\u7EC4\u4EF6\u672A\u6CE8\u518C"]})})},this._registry=a},Ue=new Le,se=Ue,Tt=i.createContext({}),le=n(21063),he=n(18111),Ft=n(71194),ge=n(50146),At=n(49111),ye=n(19650),Pt=n(59250),We=n(13013),Rt=n(57663),M=n(71577),bt=n(30887),xe=n(54689),Dt=n(34792),L=n(48086),zt=n(18106),je=n(67164),ce=n(11075),Ce=n(15873),oe=n(73218),Se=n(28991),He={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"},Ve=He,$e=n(27029),Ze=function(t,a){return i.createElement($e.Z,(0,Se.Z)((0,Se.Z)({},t),{},{ref:a,icon:Ve}))};Ze.displayName="SendOutlined";var Ie=i.forwardRef(Ze),Ke=n(44545),Qe=n(58491),Ye=n(57254),Ge=n(98244),Je=n(4159),wt=n(38663),Bt=n(57529),pe=n(22122),W=n(96156),Xe=n(94184),G=n.n(Xe),qe=n(7085),Ne=n(65632),_e=function(s,t){var a={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(s);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(s,r[o])&&(a[r[o]]=s[r[o]]);return a},et=function(t){var a,r,o=t.prefixCls,d=t.className,g=t.color,c=g===void 0?"blue":g,h=t.dot,y=t.pending,m=y===void 0?!1:y,I=t.position,F=t.label,A=t.children,O=_e(t,["prefixCls","className","color","dot","pending","position","label","children"]),p=i.useContext(Ne.E_),C=p.getPrefixCls,l=C("timeline",o),k=G()((a={},(0,W.Z)(a,"".concat(l,"-item"),!0),(0,W.Z)(a,"".concat(l,"-item-pending"),m),a),d),P=G()((r={},(0,W.Z)(r,"".concat(l,"-item-head"),!0),(0,W.Z)(r,"".concat(l,"-item-head-custom"),!!h),(0,W.Z)(r,"".concat(l,"-item-head-").concat(c),!0),r));return i.createElement("li",(0,pe.Z)({},O,{className:k}),F&&i.createElement("div",{className:"".concat(l,"-item-label")},F),i.createElement("div",{className:"".concat(l,"-item-tail")}),i.createElement("div",{className:P,style:{borderColor:/blue|red|green|gray/.test(c||"")?void 0:c}},h),i.createElement("div",{className:"".concat(l,"-item-content")},A))},ke=et,tt=n(96159),nt=function(s,t){var a={};for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(s);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(s,r[o])&&(a[r[o]]=s[r[o]]);return a},Oe=function(t){var a,r=i.useContext(Ne.E_),o=r.getPrefixCls,d=r.direction,g=t.prefixCls,c=t.pending,h=c===void 0?null:c,y=t.pendingDot,m=t.children,I=t.className,F=t.reverse,A=F===void 0?!1:F,O=t.mode,p=O===void 0?"":O,C=nt(t,["prefixCls","pending","pendingDot","children","className","reverse","mode"]),l=o("timeline",g),k=typeof h=="boolean"?null:h,P=h?i.createElement(ke,{pending:!!h,dot:y||i.createElement(qe.Z,null)},k):null,B=i.Children.toArray(m);B.push(P),A&&B.reverse();var x=function(E,X){return p==="alternate"?E.props.position==="right"?"".concat(l,"-item-right"):E.props.position==="left"||X%2==0?"".concat(l,"-item-left"):"".concat(l,"-item-right"):p==="left"?"".concat(l,"-item-left"):p==="right"||E.props.position==="right"?"".concat(l,"-item-right"):""},S=B.filter(function(f){return!!f}),u=i.Children.count(S),v="".concat(l,"-item-last"),z=i.Children.map(S,function(f,E){var X=E===u-2?v:"",ve=E===u-1?v:"";return(0,tt.Tm)(f,{className:G()([f.props.className,!A&&!!h?X:ve,x(f,E)])})}),K=B.some(function(f){var E;return!!((E=f==null?void 0:f.props)===null||E===void 0?void 0:E.label)}),R=G()(l,(a={},(0,W.Z)(a,"".concat(l,"-pending"),!!h),(0,W.Z)(a,"".concat(l,"-reverse"),!!A),(0,W.Z)(a,"".concat(l,"-").concat(p),!!p&&!K),(0,W.Z)(a,"".concat(l,"-label"),K),(0,W.Z)(a,"".concat(l,"-rtl"),d==="rtl"),a),I);return i.createElement("ul",(0,pe.Z)({},C,{className:R}),z)};Oe.Item=ke;var at=Oe,Ee=at,Mt=n(22385),it=n(31097),Lt=n(94233),de=n(51890),rt=n(89366),st={save:"blue",agree:"green",refuse:"red",reject:"red",revoke:"red",transfer:"red",todo:"orange"},J=function(t){return(0,e.jsx)(it.Z,{placement:"bottom",title:(0,e.jsxs)("div",{style:{textAlign:"center",fontSize:12},children:[t.name,(0,e.jsx)("br",{}),t.email]}),children:t.avatar?(0,e.jsx)(de.C,{src:"/api/public/preview/".concat(t.avatar),size:22}):(0,e.jsx)(de.C,{icon:(0,e.jsx)(rt.Z,{}),size:22})})},lt=function(t){var a=function(){if(t.approvalType==="save"){var o;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(J,(0,Z.Z)({},t.auditUser)),(o=t.auditUser)===null||o===void 0?void 0:o.name," \u53D1\u8D77\u65B0\u7684"]})}else if(t.approvalType==="agree"){var d;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(J,(0,Z.Z)({},t.auditUser)),(d=t.auditUser)===null||d===void 0?void 0:d.name," \u5BA1\u6279\u901A\u8FC7"]})}else if(t.approvalType==="todo"){var g,c;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(de.C.Group,{maxCount:3,children:(g=t.waitAuditUserList)===null||g===void 0?void 0:g.filter(function(I){return!!I}).map(function(I){return(0,i.createElement)(J,(0,Z.Z)((0,Z.Z)({},I),{},{key:I.userId}))})}),(c=t.waitAuditUserList)===null||c===void 0?void 0:c.length,"\u6210\u5458\u5904\u7406\u4E2D..."]})}else if(t.approvalType==="refuse"){var h;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(J,(0,Z.Z)({},t.auditUser)),(h=t.auditUser)===null||h===void 0?void 0:h.name," \u5BA1\u6279\u62D2\u7EDD"]})}else if(t.approvalType==="rollback"){var y;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(J,(0,Z.Z)({},t.auditUser)),(y=t.auditUser)===null||y===void 0?void 0:y.name," \u56DE\u9000\u81F3 ",t.newActivityName]})}else if(t.approvalType==="revert"){var m;return(0,e.jsxs)(e.Fragment,{children:[t.auditUser&&(0,e.jsx)(J,(0,Z.Z)({},t.auditUser)),(m=t.auditUser)===null||m===void 0?void 0:m.name," \u64A4\u9500\u5904\u7406"]})}};return(0,e.jsxs)(Ee.Item,{color:st[t.approvalType]||"gray",children:[(0,e.jsx)("div",{className:"audit-time",children:t.createAt}),(0,e.jsxs)("div",{className:"record-item",children:[(0,e.jsx)("div",{className:"item-header",children:t.activityName}),(0,e.jsxs)("div",{className:"item-content",children:[(0,e.jsxs)("div",{className:"content-row",children:[(0,e.jsx)("span",{className:G()("action",t.approvalType),children:a()}),(0,e.jsx)("span",{})]}),t.comment&&(0,e.jsx)("div",{className:"content-row",children:(0,e.jsx)("span",{className:"comment",children:t.comment})})]})]})]},t.id)},ct=function(t){var a=t.processInstanceId,r=(0,i.useState)(),o=(0,N.Z)(r,2),d=o[0],g=o[1];return(0,i.useEffect)(function(){w.hi.getAuditRecord(a).then(function(c){g(c)})},[a]),(0,i.useEffect)(function(){var c=document.getElementsByClassName("ant-tabs-content-holder");c.length>0&&(c[0].scrollTop=c[0].scrollHeight)},[d]),(0,e.jsx)(Ee,{className:"audit-timeline",children:d==null?void 0:d.map(function(c){return(0,i.createElement)(lt,(0,Z.Z)((0,Z.Z)({},c),{},{key:c.id||c.activityId}))})})},Ut=n(47673),Te=n(4107),ot=Te.Z.TextArea;function dt(s){var t=(0,i.useState)(),a=(0,N.Z)(t,2),r=a[0],o=a[1];return(0,e.jsxs)(ge.Z,{visible:!0,title:"\u786E\u8BA4",onOk:function(){return s.onOk(r)},onCancel:s.onCancel,okButtonProps:s.buttonProps,children:[(0,e.jsx)("div",{style:{fontWeight:"bold",marginBottom:10},children:"\u5904\u7406\u53CD\u9988"}),(0,e.jsx)(ot,{placeholder:"\u5728\u6B64\u5904\u8F93\u5165\u5904\u7406\u53CD\u9988\uFF0C\u53EF\u4E0D\u586B\u76F4\u63A5\u63D0\u4EA4",value:r,onChange:function(g){return o(g.target.value)}})]})}var Fe=je.Z.TabPane,V="task-edit-modal",ut=(0,ne.Pi)(function(s){var t=s.currentRecord,a=s.currIndex,r=s.total,o=s.onClose,d=s.onNav,g=s.taskType,c=(0,i.useState)(345),h=(0,N.Z)(c,2),y=h[0],m=h[1],I=(0,i.useRef)(null),F=(0,i.useState)(),A=(0,N.Z)(F,2),O=A[0],p=A[1],C=(0,i.useRef)(null),l=(0,i.useState)([]),k=(0,N.Z)(l,2),P=k[0],B=k[1],x=(0,i.useState)(),S=(0,N.Z)(x,2),u=S[0],v=S[1];(0,i.useEffect)(function(){w.hi.loadFlowSchema({activityId:t.activityId,projectId:t.projectId}).then(function(b){return p(b)})},[t]);var z=(0,i.useState)(!1),K=(0,N.Z)(z,2),R=K[0],f=K[1];(0,i.useEffect)(function(){var b,D=t.answer,j=t.attachment;(b=C.current)===null||b===void 0||b.setValues(D,j)},[t]);var E=function(){return O?(0,e.jsx)(Je.O,{ref:C,schema:O,headerVisible:!1,footerVisible:!1,paginationVisible:!1,initialValues:t.answer,fieldPermission:t.fieldPermission}):(0,e.jsx)(e.Fragment,{})},X=function(D){var j=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;d(D==="up"?a-1:a+1,j)},ve=function(){return(0,e.jsx)("div",{style:{position:"absolute",height:"100%",width:"100%",overflow:"hidden"},children:(0,e.jsxs)(je.Z,{defaultActiveKey:"1",children:[(0,e.jsx)(Fe,{tab:"\u65E5\u5FD7",children:(0,e.jsx)(ct,{processInstanceId:t.processInstanceId})},"1"),(0,e.jsx)(Fe,{tab:"\u7559\u8A00",children:"Content of Tab Pane 2"},"2")]})})},kt=function(){return(0,e.jsx)(xe.Z,{onClick:function(j){var T,te=j.key;(T=C.current)===null||T===void 0||T.submit().then(function(U){U?v({visible:!0,buttonProps:{type:"ghost",icon:(0,e.jsx)(ce.Z,{})},callback:function(Et){f(!0),w.hi.approvalTask({answer:U.values,attachment:U.attachments,answerId:t.answerId,taskId:t.id,type:"rollback",activityId:t.activityId,comment:Et,projectId:t.projectId,processInstanceId:t.processInstanceId,newActivityId:te}).then(function(){L.default.success("\u5DF2\u56DE\u9000"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},children:P==null?void 0:P.map(function(D,j){return(0,e.jsx)(xe.Z.Item,{children:(0,e.jsx)("a",{children:j!==P.length-1?D.activityName:"\u53D1\u8D77\u4EBA"})},D.activityId)})})},Ot=function(){return(0,e.jsxs)(ye.Z,{children:[g===1&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(M.Z,{type:"primary",loading:R,icon:(0,e.jsx)(Ce.Z,{}),onClick:function(){var j;(j=C.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",icon:(0,e.jsx)(Ce.Z,{})},callback:function(U){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"agree",activityId:t.activityId,comment:U,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){L.default.success("\u5BA1\u6838\u901A\u8FC7"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},children:"\u901A\u8FC7"}),(0,e.jsx)(M.Z,{type:"primary",danger:!0,icon:(0,e.jsx)(oe.Z,{}),loading:R,onClick:function(){var j;(j=C.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",danger:!0,icon:(0,e.jsx)(oe.Z,{})},callback:function(U){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"refuse",activityId:t.activityId,comment:U,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){L.default.success("\u5DF2\u62D2\u7EDD"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},children:"\u62D2\u7EDD"}),(0,e.jsx)(We.Z,{overlay:kt,placement:"topCenter",trigger:["click"],children:(0,e.jsx)(M.Z,{onClick:function(){w.hi.getRevertNodes(t.processInstanceId).then(function(j){j&&B(j)})},icon:(0,e.jsx)(ce.Z,{}),loading:R,children:"\u56DE\u9000"})})]}),g===2&&t.status===1&&t.latest&&t.approvalType!=="revert"&&(0,e.jsx)(M.Z,{onClick:function(){var j;(j=C.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",danger:!0,icon:(0,e.jsx)(oe.Z,{})},callback:function(U){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"revert",activityId:t.activityId,newActivityId:t.activityId,comment:U,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){L.default.success("\u5DF2\u64A4\u56DE"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},icon:(0,e.jsx)(ce.Z,{}),loading:R,children:"\u64A4\u56DE"}),g===4&&t.status===6&&(0,e.jsx)(M.Z,{onClick:function(){var j;(j=C.current)===null||j===void 0||j.submit().then(function(T){T?v({visible:!0,buttonProps:{type:"primary",icon:(0,e.jsx)(Ie,{})},callback:function(U){f(!0),w.hi.approvalTask({answer:T.values,attachment:T.attachments,answerId:t.answerId,taskId:t.id,type:"save",activityId:t.activityId,comment:U,projectId:t.projectId,processInstanceId:t.processInstanceId}).then(function(){L.default.success("\u5DF2\u64A4\u56DE"),f(!1),v(void 0),d(a,!0)})}}):f(!1)})},icon:(0,e.jsx)(Ie,{}),loading:R,children:"\u518D\u6B21\u63D0\u4EA4"}),(0,e.jsx)(M.Z,{onClick:function(){},icon:(0,e.jsx)(Ke.Z,{}),loading:R})]})};return(0,e.jsx)("div",{ref:I,className:"edit-data ",children:(0,e.jsxs)(ge.Z,{visible:!0,maskClosable:!1,title:!1,width:900,onCancel:function(){return o()},className:"task-edit-modal",footer:!1,children:[(0,e.jsxs)("div",{style:{display:"flex"},children:[(0,e.jsxs)("div",{className:V+"-survey-container",style:{flex:1},children:[(0,e.jsx)("div",{className:V+"-survey-container-title",children:"\u6211\u7684\u5BA1\u6279"}),(0,e.jsx)("div",{className:V+"-survey-container-content",children:E()}),(0,e.jsxs)("div",{className:V+"-survey-container-footer",children:[(0,e.jsxs)("div",{className:"nav",children:[(0,e.jsxs)("span",{children:[a+1,"/",r]}),(0,e.jsxs)("div",{children:[(0,e.jsx)(M.Z,{type:"text",shape:"circle",icon:(0,e.jsx)(Qe.Z,{}),disabled:a===0,onClick:function(){return X("up")}}),(0,e.jsx)(M.Z,{type:"text",shape:"circle",icon:(0,e.jsx)(Ye.Z,{}),disabled:a===r-1,onClick:function(){return X("down")}})]})]}),Ot()]})]}),(0,e.jsxs)("div",{className:V+"-metaInfo-container",style:{width:y},children:[(0,e.jsx)("div",{className:V+"-metaInfo-container-title"}),(0,e.jsx)("div",{className:V+"-metaInfo-container-content",children:ve()}),(0,e.jsx)("div",{className:V+"-metaInfo-container-resizer",style:{transform:y===0?"rotateY(180deg) translate3d(100%,-50%,0)":"translate3d(0,-50%,0)"},onClick:function(){m(y===0?350:0)},children:(0,e.jsx)(Ge.Z,{})})]})]}),(u==null?void 0:u.visible)&&(0,e.jsx)(dt,{onOk:function(D){return u.callback(D)},onCancel:function(){return v(void 0)},buttonProps:u.buttonProps})]})})}),vt=(0,ne.Pi)(function(s){var t=s.projectId,a=s.taskType,r=(0,i.useContext)(ue),o=(0,w.iZ)(t),d=(0,w.Ge)(t),g=(0,i.useRef)(),c=d.tasks[a]||{list:[],total:0,current:1,pageSize:50},h=(0,i.useState)(),y=(0,N.Z)(h,2),m=y[0],I=y[1],F=(0,i.useState)(),A=(0,N.Z)(F,2),O=A[0],p=A[1];(0,i.useEffect)(function(){var x=c.list.length;if(m===void 0){p(void 0);return}if(x===0){I(void 0);return}if(m>=x){I(0);return}m!==void 0&&c.current&&c.total&&p({currIndex:m,total:c.total,currentRecord:c.list[m]})},[m,c]);var C=function(S,u){d.loadFlowTasks({type:a,projectId:t,current:S,pageSize:u})};(0,i.useEffect)(function(){(a||m===void 0)&&C()},[a,m]);var l=o.schema,k=(0,i.useMemo)(function(){var x=(0,he.ZZ)(l)||[];return x.splice(0,0,{name:"approvalStage",title:"\u5F53\u524D\u6D41\u7A0B\u72B6\u6001",width:180}),x.push({name:"createUser",title:"\u7533\u8BF7\u4EBA"}),x.push({name:"createAt",title:"\u7533\u8BF7\u65F6\u95F4",width:180}),x.push({name:"updateAt",title:"\u66F4\u65B0\u65F6\u95F4",width:180}),x},[l]),P=(0,i.useMemo)(function(){var x=(0,he.IR)(c.list,k);return x.forEach(function(S){var u;S.createUser=(u=S.createUser)===null||u===void 0?void 0:u.name}),x},[c,k]),B=function(S,u){O&&(u?d.removeTask(O.currentRecord.id,a):I(S))};return(0,e.jsxs)("div",{children:[(0,e.jsx)(le._$,{ref:g,width:r.width-10,height:r.height-95,data:P,schema:k,selectionMode:"row",allowSorting:!0,onDoubleClick:function(S){var u;if(((u=S.data)===null||u===void 0?void 0:u._i)!==void 0){var v;I((v=S.data)===null||v===void 0?void 0:v._i)}}}),(0,e.jsxs)("div",{className:"statusBar-container",children:[(0,e.jsx)("div",{children:(0,e.jsx)("div",{style:{fontSize:12,color:"##767e89",userSelect:"none"},children:"\u53CC\u51FB\u884C\u5BA1\u6279"})}),(0,e.jsxs)("div",{children:[(0,e.jsx)(le.tl,{current:c.current,pageSize:c.pageSize,total:c.total,onChange:function(S){C(S.current,S.pageSize)}}),(0,e.jsx)(le.hY,{onClick:function(){return C(c.current,c.pageSize)}})]}),(0,e.jsx)("div",{})]}),O&&(0,e.jsx)(ut,(0,Z.Z)((0,Z.Z)({},O),{},{taskType:a,onClose:function(){I(void 0)},onNav:B}))]})}),ft=(0,ne.Pi)(function(s){var t=(0,i.useContext)(me.xI),a=(t==null?void 0:t.id)||s.projectId,r=(0,w.iZ)(a),o=St();return(0,i.useEffect)(function(){r.loadProject()},[r,a]),(0,e.jsx)("div",{style:{padding:"2px 5px"},className:"task-widget",children:(0,e.jsx)(vt,{projectId:a,taskType:parseInt(o.activeKey||"0")})})});se.registerComponent("taskCenter",ft);var Wt=n(13062),Ae=n(71230),Ht=n(77576),Pe=n(12028),Vt=n(89032),ae=n(15746),$t=n(20136),mt=n(55241),Re=n(3182),ht=n(94043),ie=n.n(ht),gt=n(23538),be=n(92592),yt=Te.Z.Search;function xt(s){return"".concat(window.location.origin,"/s/").concat(s)}var jt=function(){var t,a,r,o,d=(0,me.IE)(),g=d.loading,c=(t=d.project)===null||t===void 0||(a=t.setting)===null||a===void 0?void 0:a.status,h=(0,i.useState)(c===1),y=(0,N.Z)(h,2),m=y[0],I=y[1],F=(r=d.project)===null||r===void 0||(o=r.setting)===null||o===void 0?void 0:o.answerSetting.autoSave,A=(0,i.useState)(F),O=(0,N.Z)(A,2),p=O[0],C=O[1];(0,i.useEffect)(function(){I(c===1)},[c]),(0,i.useEffect)(function(){C(F)},[F]);var l=xt(d.id),k=(0,i.useState)(""),P=(0,N.Z)(k,2),B=P[0],x=P[1];(0,i.useEffect)(function(){function u(){return v.apply(this,arguments)}function v(){return v=(0,Re.Z)(ie().mark(function z(){return ie().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:be.toDataURL(l,{errorCorrectionLevel:"H",type:"image/jpeg",quality:.3,margin:1,color:{dark:"#010599FF",light:"#FFBF60FF"}}).then(function(f){x(f)}).catch(function(f){console.error(f)});case 1:case"end":return R.stop()}},z)})),v.apply(this,arguments)}u()},[l]);var S=(0,i.useCallback)(function(){var u=(0,Re.Z)(ie().mark(function v(z){return ie().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:be.toDataURL(l,{errorCorrectionLevel:"H",margin:1,color:{dark:"#010599FF",light:"#FFBF60FF"},width:z}).then(function(f){x(f);var E=document.createElement("a");E.href=f,E.setAttribute("download","".concat(d.name,"_").concat(z,".png")),document.body.appendChild(E),E.click(),document.body.removeChild(E)});case 1:case"end":return R.stop()}},v)}));return function(v){return u.apply(this,arguments)}}(),[l,d]);return(0,e.jsx)(Ae.Z,{gutter:[20,20],style:{padding:10},children:(0,e.jsx)(ae.Z,{sm:24,xs:24,children:(0,e.jsxs)(Ae.Z,{gutter:[10,10],children:[(0,e.jsxs)(ae.Z,{span:24,className:"setting-item",children:[(0,e.jsx)(yt,{value:l,style:{width:360},enterButton:"\u6253\u5F00",className:"open-target",onSearch:function(){window.open("/s/".concat(d.id))}}),(0,e.jsx)(mt.Z,{content:(0,e.jsxs)("div",{children:[(0,e.jsx)("img",{src:B,height:150,width:150}),(0,e.jsx)("div",{style:{textAlign:"center"},children:(0,e.jsxs)(ye.Z,{children:[(0,e.jsx)(M.Z,{size:"small",type:"link",onClick:function(){return S(256)},children:"\u5C0F\u53F7"}),(0,e.jsx)(M.Z,{size:"small",type:"link",onClick:function(){return S(512)},children:"\u4E2D\u53F7"}),(0,e.jsx)(M.Z,{size:"small",type:"link",onClick:function(){return S(1024)},children:"\u5927\u53F7"})]})})]}),title:"".concat(d.name,"(\u4E8C\u7EF4\u7801)"),trigger:["click"],children:(0,e.jsx)(gt.Z,{style:{fontSize:30}})})]}),(0,e.jsxs)(ae.Z,{className:"setting-item",span:24,children:[(0,e.jsx)("div",{className:"title",children:"\u95EE\u5377\u5F00\u542F/\u505C\u6B62"}),(0,e.jsx)("div",{children:(0,e.jsx)(Pe.Z,{checked:m,onChange:function(v){I(v),w.hi.updateSetting({id:d.id,settingKey:"status",settingValue:v?1:0}).then(function(z){z.code===200?v?L.default.info("\u95EE\u5377\u5DF2\u5F00\u542F"):L.default.warn("\u95EE\u5377\u5DF2\u505C\u6B62"):L.default.error(z.message)})}})})]}),(0,e.jsxs)(ae.Z,{className:"setting-item",span:24,children:[(0,e.jsx)("div",{className:"title",children:"\u95EE\u5377\u586B\u5199\u65F6\u81EA\u52A8\u4FDD\u5B58"}),(0,e.jsx)("div",{children:(0,e.jsx)(Pe.Z,{checked:p,onChange:function(v){C(v),w.hi.updateSetting({id:d.id,settingKey:"answerSetting.autoSave",settingValue:v}).then(function(z){z.code===200?v?L.default.info("\u6682\u5B58\u5DF2\u5F00\u542F"):L.default.warn("\u6682\u5B58\u5DF2\u505C\u6B62"):L.default.error(z.message)})}})})]})]})})})};se.registerComponent("quickSetting",(0,ne.Pi)(jt));var Ct=function(t){var a=t.tabs,r=t.defaultActive,o=(0,i.useState)(r||a[0].key),d=(0,N.Z)(o,2),g=d[0],c=d[1],h=function(m){c(m),t.onChange(m)};return(0,e.jsx)("div",{className:"tabs-nav-list",children:a.map(function(y){return(0,e.jsx)("div",{onClick:function(){return h(y.key)},className:G()("tabs-tab",{active:g===y.key}),children:y.title},y.key)})})},ue=i.createContext({});function St(){return(0,i.useContext)(ue)}var Zt=i.forwardRef(function(s,t){var a=s.style,r=s.className,o=s.key,d=s.children,g=s.name,c=s.title,h=s.tabs,y=s.widgetProps,m=s.toggleFullScreen,I=(0,H.Z)(s,["style","className","key","children","name","title","tabs","widgetProps","toggleFullScreen"]),F=(0,i.useState)(h&&h[0].key),A=(0,N.Z)(F,2),O=A[0],p=A[1],C=(0,i.useState)(!1),l=(0,N.Z)(C,2),k=l[0],P=l[1],B=function(){return h?(0,e.jsx)(Ct,{tabs:h,onChange:function(u){return p(u)}}):(0,e.jsx)("span",{className:"",children:c})};return(0,e.jsxs)("div",(0,Z.Z)((0,Z.Z)({style:(0,Z.Z)({},a),className:["widget",r].join(" ")},I),{},{ref:t,children:[(0,e.jsxs)("div",{className:"header",children:[(0,e.jsxs)("span",{className:"title",children:[B(),(0,e.jsx)("div",{className:"drag-handle"})]}),(0,e.jsxs)("div",{className:"widget-controls",children:[k&&(0,e.jsx)(_.Z,{className:"control-item",onClick:function(){P(!1),m()}}),!k&&(0,e.jsx)(ee.Z,{className:"control-item",onClick:function(){P(!0),m()}}),(0,e.jsx)(ze.Z,{className:"control-item"})]})]}),(0,e.jsx)(Y.SizeMe,{monitorHeight:!0,children:function(S){var u=S.size;return(0,e.jsx)(ue.Provider,{value:{height:u.height||0,width:u.width||0,activeKey:O},children:(0,e.jsx)("div",{style:{height:"100%"},children:i.createElement(se.getComponent(g),y)})})}}),d]}),o)}),It=Zt,pt=n(93118),De=function(t){var a=(0,q.UO)(),r=a.id,o=(0,i.useState)(re),d=(0,N.Z)(o,2),g=d[0],c=d[1],h=(0,i.useRef)(0),y=(0,i.useState)(),m=(0,N.Z)(y,2),I=m[0],F=m[1];if(r==="new")return(0,e.jsx)(pt.default,(0,Z.Z)({},t));var A=function(p){if(I)c(I.cacheData),F(void 0);else{var C=JSON.parse(JSON.stringify(g.find(function(l){return l.key===p})));F({key:p,cacheData:g}),C["data-grid"]={x:0,y:0,w:12,h:(h.current-100)/150,i:p,static:!0},c([C])}};return(0,e.jsx)("div",{className:"survey-overview",children:(0,e.jsx)(Y.SizeMe,{monitorHeight:!0,children:function(p){var C=p.size;return h.current=C.height||0,(0,e.jsx)($.Responsive,{autoSize:!1,className:"layout",onDrag:function(k){},draggableHandle:".drag-handle",breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:12,sm:12,xs:4,xxs:2},width:C.width||0,layouts:{lg:g.map(function(l){return l["data-grid"]}),md:g.map(function(l){return l["data-grid"]})},useCSSTransforms:!1,onLayoutChange:function(k){},children:g.map(function(l){var k=l.key,P=(0,H.Z)(l,["key"]);return(0,e.jsx)(It,(0,Z.Z)((0,Z.Z)({},P),{},{toggleFullScreen:function(){return A(k)}}),k)})})}})})},Nt=De}}]);
