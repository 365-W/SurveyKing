(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{DVlV:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return h})),r.d(t,"b",(function(){return l}));var a=r("9og8"),n=r("WmNS"),s=r.n(n),c=r("nzmB"),o=r("hF6A");class i{constructor(e){this.records=[],this.selected=void 0,this.currentIndex=-1,this.projectStore=void 0,this.loading=void 0,this.reportData=void 0,this.progress=void 0,this.pagination={current:1,pageSize:20,total:0},this.projectStore=e,this.makeObservable()}makeObservable(){Object(c["e"])(this,{loading:c["h"].ref,pagination:c["h"].ref,records:c["h"].ref,selected:c["h"].ref,currentIndex:c["h"].ref,reportData:c["h"].ref,progress:c["h"].ref,shortId:c["h"].computed,loadData:c["b"],loadReportData:c["b"],downloadSurvey:c["b"],downloadCurrentAttachment:c["b"],downloadSurveyAttachment:c["b"]})}get shortId(){return this.projectStore.shortId}loadData(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].loadData(t.shortId,e||t.pagination);case 2:a=r.sent,a&&(t.pagination=a.pagination,t.records=a.records);case 4:case"end":return r.stop()}}),r)})))()}saveData(e){var t=this;return Object(a["a"])(s.a.mark((function r(){return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,e.shortId=t.shortId,r.next=4,o["b"].saveAnswer(e);case 4:t.loading=!1;case 5:case"end":return r.stop()}}),r)})))()}updateData(e){var t=this;return Object(a["a"])(s.a.mark((function r(){return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].updateAnswer(e);case 2:t.loadData();case 3:case"end":return r.stop()}}),r)})))()}deleteData(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a,n;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=[],a=void 0!==e?[t.records[e].id]:(null===(n=t.records)||void 0===n?void 0:n.reduce(((e,r,a)=>{var n;return null!==(n=t.selected)&&void 0!==n&&n.includes(a)&&e.push(r.id),e}),[]))||[],r.next=4,o["b"].deleteAnswer(a);case 4:t.loadData();case 5:case"end":return r.stop()}}),r)})))()}loadReportData(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,o["b"].loadReportData(t.shortId,e);case 3:a=r.sent,a&&(t.reportData=a),t.loading=!1;case 6:case"end":return r.stop()}}),r)})))()}downloadSurvey(){var e=this;return Object(a["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["b"].download("/api/answers/download?shortId=".concat(e.shortId,"&type=SURVEY_ANSWER"),(t=>{e.progress=t}));case 2:case"end":return t.stop()}}),t)})))()}downloadCurrentAttachment(e){var t=this;return Object(a["a"])(s.a.mark((function r(){return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].download("/api/answers/download?shortId=".concat(t.shortId,"&answerId=").concat(e,"&type=ANSWER_ATTACHMENT"),(e=>{t.progress=e}));case 2:case"end":return r.stop()}}),r)})))()}downloadSurveyAttachment(){var e=this;return Object(a["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["b"].download("/api/answers/download?shortId=".concat(e.shortId,"&type=ANSWER_ATTACHMENT"),(t=>{e.progress=t}));case 2:case"end":return t.stop()}}),t)})))()}upload(e,t){return Object(a["a"])(s.a.mark((function r(){return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",o["b"].upload("/api/public/upload",{file:e},t));case 1:case"end":return r.stop()}}),r)})))()}}r("miYZ");var d=r("tsqr"),u=r("k1fw");class h{constructor(e,t){this.id=void 0,this.shortId=void 0,this.project=void 0,this.loading=void 0,this.isPC=void 0,this.bgi=[],this.hi=[],this.qt=[],this.st=[],this.currentSchema=void 0,this.currentCategory=void 0,this.shortId=e,this.id=t,this.makeObservable(),this.loadImages("BACKGROUND_IMAGE"),this.loadImages("HEADER_IMAGE")}makeObservable(){Object(c["e"])(this,{id:c["h"].ref,shortId:c["h"].ref,loading:c["h"].ref,project:c["h"].ref,bgi:c["h"],hi:c["h"],qt:c["h"].ref,st:c["h"].ref,currentSchema:c["h"].ref,currentCategory:c["h"].ref,schema:c["h"].computed,setting:c["h"].computed,name:c["h"].computed,saveOrUpdateProject:c["b"],loadImages:c["b"],updateSetting:c["b"],uploadImage:c["b"],loadTemplate:c["b"],saveTemplate:c["b"],deleteTemplate:c["b"]})}get name(){var e;return null===(e=this.project)||void 0===e?void 0:e.name}get schema(){var e;return null===(e=this.project)||void 0===e?void 0:e.survey}get setting(){var e;return null===(e=this.project)||void 0===e?void 0:e.setting}loadProject(){var e=this;return Object(a["a"])(s.a.mark((function t(){var r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.shortId||"new"===e.shortId){t.next=6;break}return e.loading=!0,t.next=4,o["b"].loadProject(e.shortId);case 4:r=t.sent,r&&(e.project=r);case 6:e.loading=!1;case 7:case"end":return t.stop()}}),t)})))()}saveOrUpdateProject(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if("new"!==t.shortId){r.next=9;break}return r.next=3,o["b"].saveProject(Object(u["a"])(Object(u["a"])({},e),{},{setting:{answerSetting:{progressBar:!0,autoSave:!0}}}));case 3:return a=r.sent,a.success&&(t.shortId=a.data),t.loadProject(),r.abrupt("return",a);case 9:return r.next=11,o["b"].updateProject(Object(u["a"])(Object(u["a"])({},e),{},{id:t.id,shortId:t.shortId}));case 11:return r.abrupt("return",r.sent);case 12:case"end":return r.stop()}}),r)})))()}updateSetting(e){var t=this;return Object(a["a"])(s.a.mark((function r(){return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].updateSetting(t.shortId,e);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))()}deleteProject(e){return Object(a["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["b"].deleteProject(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}loadImages(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,o["b"].loadImages(e);case 3:a=r.sent,"BACKGROUND_IMAGE"===e&&a?t.bgi=a:"HEADER_IMAGE"===e&&a&&(t.hi=a),t.loading=!1;case 6:case"end":return r.stop()}}),r)})))()}uploadImage(e,t,r){var n=this;return Object(a["a"])(s.a.mark((function a(){var c;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n.loading=!0,a.next=3,o["b"].uploadImage(e,t,r);case 3:return c=a.sent,"BACKGROUND_IMAGE"===e&&c.success?n.bgi.push(c.data):"HEADER_IMAGE"===e&&c.success&&n.hi.push(c.data),n.loading=!1,a.abrupt("return",c);case 7:case"end":return a.stop()}}),a)})))()}deleteImage(e,t){var r=this;return Object(a["a"])(s.a.mark((function a(){var n;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o["b"].deleteImage(e);case 2:return n=a.sent,"BACKGROUND_IMAGE"===t&&(r.bgi=r.bgi.filter((t=>t.attachmentId!==e))),"HEADER_IMAGE"===t&&(r.hi=r.hi.filter((t=>t.attachmentId!==e))),a.abrupt("return",n);case 6:case"end":return a.stop()}}),a)})))()}loadTemplate(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].loadTemplate(e);case 2:a=r.sent,a&&("Survey"===e?t.st=a:t.qt=a);case 4:case"end":return r.stop()}}),r)})))()}saveTemplate(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].saveTemplate(e);case 2:return a=r.sent,a.success?("Survey"===e.questionType?t.st=[...t.st,Object(u["a"])(Object(u["a"])({},e),{},{id:a.data})]:t.qt=[...t.qt,Object(u["a"])(Object(u["a"])({},e),{},{id:a.data,owner:!0})],t.currentSchema=void 0):d["default"].error(a.message),r.abrupt("return",a);case 5:case"end":return r.stop()}}),r)})))()}deleteTemplate(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].deleteTemplate(e);case 2:return a=r.sent,a.success&&t.currentCategory&&(t.qt=[...t.qt.filter((t=>t.id!==e))]),r.abrupt("return",a);case 5:case"end":return r.stop()}}),r)})))()}}class l{constructor(){this.projects=void 0,this.loading=!1,this.makeObservable()}makeObservable(){Object(c["e"])(this,{projects:c["h"].ref,loading:c["h"].ref})}loadProjects(e){var t=this;return Object(a["a"])(s.a.mark((function r(){var a;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,o["b"].loadProjects(e);case 3:a=r.sent,a&&(t.projects=a),t.loading=!1;case 6:case"end":return r.stop()}}),r)})))()}}},Ww8N:function(e,t,r){},yZnS:function(e,t,r){"use strict";r.r(t),r.d(t,"Home",(function(){return D}));r("5Dmo");var a=r("3S7+"),n=(r("+L6B"),r("2/Rp")),s=(r("14J3"),r("BMrR")),c=(r("jCWc"),r("kPKH")),o=(r("IzEo"),r("bx4M")),i=(r("Awhp"),r("KrTs")),d=(r("qVdP"),r("jsC+")),u=(r("R9oj"),r("ECub")),h=(r("5NDa"),r("5rEg")),l=(r("fOrg"),r("+KLJ")),p=(r("lUTK"),r("BvKs")),j=r("tJVT"),b=(r("2qtc"),r("kLXV")),v=r("q1tI"),m=r("Ue1A"),w=r("RCxd"),x=r("G3dp"),O=r("U+PY"),g=r("UdsK"),f=r("eFNv"),I=r("GZ0F"),k=r("aIfO"),y=r("xvlK"),A=r("Ty5D"),T=(r("Ww8N"),r("jOlz")),E=r("DVlV"),C=r("6qww"),S=r("nKUr"),P=b["a"].confirm,D=Object(T["i"])((()=>{var e=Object(v["useState"])(),t=Object(j["a"])(e,2),r=(t[0],t[1]),b=Object(v["useMemo"])((()=>new E["b"]),[]),T=b.projects||[],D=b.loading,N=Object(C["a"])(),R=Object(v["useRef"])(""),G=Object(A["g"])();Object(v["useEffect"])((()=>{b.loadProjects()}),[]);var M=(e,t,r)=>{e.stopPropagation(),"more"!==r&&G.push("/survey/".concat(t.shortId,"/").concat(r))},U=e=>Object(S["jsxs"])(p["a"],{onClick:e=>e.domEvent.stopPropagation(),children:[Object(S["jsx"])(p["a"].Item,{onClick:()=>window.open("/s/".concat(e.shortId)),children:"\u9884\u89c8"},"preview"),Object(S["jsx"])(p["a"].Item,{onClick:()=>{r(e.shortId),P({title:"\u95ee\u5377\u91cd\u547d\u540d",icon:void 0,content:Object(S["jsxs"])("div",{children:[Object(S["jsx"])(l["a"],{message:"\u95ee\u5377\u91cd\u547d\u540d\u6210\u529f\uff0c\u7cfb\u7edf\u5185\u5404\u5904\u5c06\u663e\u793a\u91cd\u547d\u540d\u6807\u9898\u3002\u6b64\u64cd\u4f5c\u4e0d\u5f71\u54cd\u516c\u5f00\u95ee\u5377\u540d\u79f0",type:"info",showIcon:!0}),Object(S["jsx"])(h["a"],{style:{marginTop:10},onChange:e=>R.current=e.target.value,defaultValue:e.name})]}),okText:"\u786e\u8ba4",okType:"primary",cancelText:"\u53d6\u6d88",onOk:()=>{new E["c"](e.shortId).saveOrUpdateProject({name:R.current}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u91cd\u547d\u540d"},"rename"),0===e.status&&Object(S["jsx"])(p["a"].Item,{onClick:()=>{r(e.shortId),P({title:"\u786e\u5b9a\u53d1\u5e03\u5f53\u524d\u95ee\u5377?",icon:Object(S["jsx"])(m["a"],{style:{color:"#1890ff"}}),content:"\u53ea\u6709\u53d1\u5e03\u7684\u95ee\u5377\u624d\u80fd\u6536\u96c6\u6570\u636e",okText:"\u53d1\u5e03",okType:"primary",cancelText:"\u53d6\u6d88",onOk:()=>{new E["c"](e.shortId).saveOrUpdateProject({status:1}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u53d1\u5e03"},"publish"),1===e.status&&Object(S["jsx"])(p["a"].Item,{onClick:()=>{r(e.shortId),P({title:"\u786e\u5b9a\u505c\u6b62\u5f53\u524d\u95ee\u5377?",icon:Object(S["jsx"])(w["a"],{}),content:"\u505c\u6b62\u4e4b\u540e\u95ee\u5377\u5c06\u4e0d\u80fd\u7ee7\u7eed\u6536\u96c6\u6570\u636e",okText:"\u505c\u6b62",okType:"danger",cancelText:"\u53d6\u6d88",onOk:()=>{new E["c"](e.shortId).saveOrUpdateProject({status:0}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u505c\u6b62"},"stop"),Object(S["jsx"])(p["a"].Item,{onClick:()=>{r(e.shortId),P({title:"\u786e\u5b9a\u5220\u9664\u5f53\u524d\u95ee\u5377?",icon:Object(S["jsx"])(w["a"],{}),content:"\u5220\u9664\u4e4b\u540e\u53ef\u4ee5\u5728\u56de\u6536\u7ad9\u91cc\u9762\u627e\u56de",okText:"\u5220\u9664",okType:"danger",cancelText:"\u53d6\u6d88",onOk:()=>{new E["c"](e.shortId).deleteProject(e.id).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u5220\u9664"},"delete")]}),q=()=>0===T.length?Object(S["jsx"])(u["a"],{image:u["a"].PRESENTED_IMAGE_SIMPLE,imageStyle:{height:60},description:Object(S["jsx"])("span",{children:"\u5f53\u524d\u8fd8\u6ca1\u6709\u521b\u5efa\u95ee\u5377"})}):Object(S["jsx"])(s["a"],{gutter:[15,15],children:T.map((e=>Object(S["jsx"])(c["a"],{xs:24,sm:8,children:Object(S["jsx"])(o["a"],{onClick:()=>G.push("/survey/".concat(e.shortId)),hoverable:!0,actions:[Object(S["jsx"])(x["a"],{onClick:t=>M(t,e,"edit")},"edit"),Object(S["jsx"])(O["a"],{onClick:t=>M(t,e,"data")},"data"),Object(S["jsx"])(g["a"],{onClick:t=>M(t,e,"report")},"report"),Object(S["jsx"])(f["a"],{onClick:t=>M(t,e,"setting")},"setting"),Object(S["jsx"])(d["a"],{overlay:U(e),trigger:["click"],children:Object(S["jsx"])(I["a"],{onClick:t=>M(t,e,"more")},"ellipsis")})],children:Object(S["jsxs"])("div",{children:[Object(S["jsx"])("div",{className:"title",children:e.name}),Object(S["jsxs"])("div",{className:"content",children:[Object(S["jsx"])("div",{className:"publish-status",children:1===e.status?Object(S["jsx"])(i["a"],{status:"processing",text:"\u6536\u96c6\u4e2d",className:"yes"}):Object(S["jsx"])(i["a"],{status:"warning",text:"\u672a\u53d1\u5e03",className:"no"})}),Object(S["jsxs"])("div",{className:"total",children:[Object(S["jsx"])("span",{children:e.total}),"\u4efd\u6570\u636e"]})]})]})})},e.shortId)))});return Object(S["jsxs"])("div",{className:"survey-home",children:[Object(S["jsx"])(o["a"],{className:"survey-home-header",title:Object(S["jsx"])("div",{className:"survey-home-title",children:"\u6211\u7684\u95ee\u5377"}),extra:Object(S["jsx"])(a["a"],{title:"\u9000\u51fa",children:Object(S["jsx"])(n["a"],{type:"text",shape:"circle",icon:Object(S["jsx"])(k["a"],{}),loading:D,onClick:()=>N.logout()})}),children:Object(S["jsx"])(s["a"],{className:"survey-home-search",gutter:[4,4],children:Object(S["jsx"])(c["a"],{xs:24,sm:12,children:Object(S["jsxs"])("div",{children:[Object(S["jsx"])(h["a"].Search,{className:"search",placeholder:"\u95ee\u5377\u68c0\u7d22",onSearch:e=>{b.loadProjects(e)}}),Object(S["jsx"])(n["a"],{type:"primary",icon:Object(S["jsx"])(y["a"],{}),onClick:()=>G.push("/survey/new"),children:"\u65b0\u5efa"})]})})})}),Object(S["jsx"])(o["a"],{className:"survey-home-content",loading:D,children:q()})]})}));t["default"]=D}}]);