(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{DVlV:function(e,t,r){"use strict";r.d(t,"a",(function(){return i})),r.d(t,"c",(function(){return l})),r.d(t,"b",(function(){return u}));var a=r("9og8"),s=r("WmNS"),n=r.n(s),c=r("nzmB"),o=r("hF6A");class i{constructor(e){this.records=[],this.selected=void 0,this.currentIndex=-1,this.projectStore=void 0,this.loading=void 0,this.reportData=void 0,this.pagination={current:1,pageSize:20,total:0},this.projectStore=e,this.makeObservable()}makeObservable(){Object(c["e"])(this,{loading:c["g"].ref,pagination:c["g"].ref,records:c["g"].ref,selected:c["g"].ref,currentIndex:c["g"].ref,reportData:c["g"].ref,shortId:c["g"].computed,loadData:c["b"],loadReportData:c["b"]})}get shortId(){return this.projectStore.shortId}loadData(e){var t=this;return Object(a["a"])(n.a.mark((function r(){var a;return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].loadData(t.shortId,e||t.pagination);case 2:a=r.sent,a&&(t.pagination=a.pagination,t.records=a.records);case 4:case"end":return r.stop()}}),r)})))()}saveData(e){var t=this;return Object(a["a"])(n.a.mark((function r(){return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,e.shortId=t.shortId,r.next=4,o["b"].saveAnswer(e);case 4:t.loading=!1;case 5:case"end":return r.stop()}}),r)})))()}updateData(e){var t=this;return Object(a["a"])(n.a.mark((function r(){return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].updateAnswer(e);case 2:t.loadData();case 3:case"end":return r.stop()}}),r)})))()}deleteData(e){var t=this;return Object(a["a"])(n.a.mark((function r(){var a,s;return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a=[],a=void 0!==e?[t.records[e].id]:(null===(s=t.records)||void 0===s?void 0:s.reduce(((e,r,a)=>{var s;return null!==(s=t.selected)&&void 0!==s&&s.includes(a)&&e.push(r.id),e}),[]))||[],r.next=4,o["b"].deleteAnswer(a);case 4:t.loadData();case 5:case"end":return r.stop()}}),r)})))()}loadReportData(e){var t=this;return Object(a["a"])(n.a.mark((function r(){var a;return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,o["b"].loadReportData(t.shortId,e);case 3:a=r.sent,a&&(t.reportData=a),t.loading=!1;case 6:case"end":return r.stop()}}),r)})))()}}var d=r("k1fw");class l{constructor(e,t){this.id=void 0,this.shortId=void 0,this.project=void 0,this.loading=void 0,this.isPC=void 0,this.shortId=e,this.id=t,this.makeObservable()}makeObservable(){Object(c["e"])(this,{id:c["g"].ref,shortId:c["g"].ref,loading:c["g"].ref,project:c["g"].ref,schema:c["g"].computed,setting:c["g"].computed,name:c["g"].computed,saveOrUpdateProject:c["b"]})}get name(){var e;return null===(e=this.project)||void 0===e?void 0:e.name}get schema(){var e;return null===(e=this.project)||void 0===e?void 0:e.survey}get setting(){var e;return null===(e=this.project)||void 0===e?void 0:e.setting}loadProject(){var e=this;return Object(a["a"])(n.a.mark((function t(){var r;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.shortId||"new"===e.shortId){t.next=6;break}return e.loading=!0,t.next=4,o["b"].loadProject(e.shortId);case 4:r=t.sent,r&&(e.project=r);case 6:e.loading=!1;case 7:case"end":return t.stop()}}),t)})))()}saveOrUpdateProject(e){var t=this;return Object(a["a"])(n.a.mark((function r(){var a,s;return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.loading=!0,"new"!==t.shortId){r.next=11;break}return r.next=4,o["b"].saveProject(Object(d["a"])(Object(d["a"])({},e),{},{setting:{answerSetting:{progressBar:!0,autoSave:!0}}}));case 4:return a=r.sent,t.shortId=a.data,t.loadProject(),t.loading=!1,r.abrupt("return",a.data);case 11:return r.next=13,o["b"].updateProject(Object(d["a"])(Object(d["a"])({},e),{},{id:t.id,shortId:t.shortId}));case 13:return s=r.sent,t.loading=!1,r.abrupt("return",s.data);case 16:case"end":return r.stop()}}),r)})))()}updateSetting(e){var t=this;return Object(a["a"])(n.a.mark((function r(){return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log(t.setting,e),r.next=3,o["b"].updateSetting(t.shortId,e);case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}}),r)})))()}deleteProject(e){return Object(a["a"])(n.a.mark((function t(){return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["b"].deleteProject(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}}class u{constructor(){this.projects=void 0,this.loading=!1,this.makeObservable()}makeObservable(){Object(c["e"])(this,{projects:c["g"].ref,loading:c["g"].ref})}loadProjects(e){var t=this;return Object(a["a"])(n.a.mark((function r(){var a;return n.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,o["b"].loadProjects(e);case 3:a=r.sent,a&&(t.projects=a),t.loading=!1;case 6:case"end":return r.stop()}}),r)})))()}}},Ww8N:function(e,t,r){},yZnS:function(e,t,r){"use strict";r.r(t),r.d(t,"Home",(function(){return E}));r("5Dmo");var a=r("3S7+"),s=(r("+L6B"),r("2/Rp")),n=(r("14J3"),r("BMrR")),c=(r("jCWc"),r("kPKH")),o=(r("IzEo"),r("bx4M")),i=(r("Awhp"),r("KrTs")),d=(r("qVdP"),r("jsC+")),l=(r("R9oj"),r("ECub")),u=(r("5NDa"),r("5rEg")),j=(r("fOrg"),r("+KLJ")),h=(r("lUTK"),r("BvKs")),p=r("tJVT"),b=(r("2qtc"),r("kLXV")),v=r("q1tI"),O=r("Ue1A"),x=r("RCxd"),g=r("G3dp"),m=r("U+PY"),w=r("UdsK"),f=r("eFNv"),k=r("GZ0F"),I=r("aIfO"),P=r("xvlK"),y=r("Ty5D"),C=(r("Ww8N"),r("jOlz")),D=r("DVlV"),N=r("6qww"),T=r("nKUr"),S=b["a"].confirm,E=Object(C["i"])((()=>{var e=Object(v["useState"])(),t=Object(p["a"])(e,2),r=(t[0],t[1]),b=Object(v["useMemo"])((()=>new D["b"]),[]),C=b.projects||[],E=b.loading,U=Object(N["a"])(),R=Object(v["useRef"])(""),K=Object(y["g"])();Object(v["useEffect"])((()=>{b.loadProjects()}),[]);var V=(e,t,r)=>{e.stopPropagation(),"more"!==r&&K.push("/survey/".concat(t.shortId,"/").concat(r))},A=e=>Object(T["jsxs"])(h["a"],{onClick:e=>e.domEvent.stopPropagation(),children:[Object(T["jsx"])(h["a"].Item,{onClick:()=>window.open("/s/".concat(e.shortId)),children:"\u9884\u89c8"},"preview"),Object(T["jsx"])(h["a"].Item,{onClick:()=>{r(e.shortId),S({title:"\u95ee\u5377\u91cd\u547d\u540d",icon:void 0,content:Object(T["jsxs"])("div",{children:[Object(T["jsx"])(j["a"],{message:"\u95ee\u5377\u91cd\u547d\u540d\u6210\u529f\uff0c\u7cfb\u7edf\u5185\u5404\u5904\u5c06\u663e\u793a\u91cd\u547d\u540d\u6807\u9898\u3002\u6b64\u64cd\u4f5c\u4e0d\u5f71\u54cd\u516c\u5f00\u95ee\u5377\u540d\u79f0",type:"info",showIcon:!0}),Object(T["jsx"])(u["a"],{style:{marginTop:10},onChange:e=>R.current=e.target.value,defaultValue:e.name})]}),okText:"\u786e\u8ba4",okType:"primary",cancelText:"\u53d6\u6d88",onOk:()=>{new D["c"](e.shortId).saveOrUpdateProject({name:R.current}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u91cd\u547d\u540d"},"rename"),0===e.status&&Object(T["jsx"])(h["a"].Item,{onClick:()=>{r(e.shortId),S({title:"\u786e\u5b9a\u53d1\u5e03\u5f53\u524d\u95ee\u5377?",icon:Object(T["jsx"])(O["a"],{style:{color:"#1890ff"}}),content:"\u53ea\u6709\u53d1\u5e03\u7684\u95ee\u5377\u624d\u80fd\u6536\u96c6\u6570\u636e",okText:"\u53d1\u5e03",okType:"primary",cancelText:"\u53d6\u6d88",onOk:()=>{new D["c"](e.shortId).saveOrUpdateProject({status:1}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u53d1\u5e03"},"publish"),1===e.status&&Object(T["jsx"])(h["a"].Item,{onClick:()=>{r(e.shortId),S({title:"\u786e\u5b9a\u505c\u6b62\u5f53\u524d\u95ee\u5377?",icon:Object(T["jsx"])(x["a"],{}),content:"\u505c\u6b62\u4e4b\u540e\u95ee\u5377\u5c06\u4e0d\u80fd\u7ee7\u7eed\u6536\u96c6\u6570\u636e",okText:"\u505c\u6b62",okType:"danger",cancelText:"\u53d6\u6d88",onOk:()=>{new D["c"](e.shortId).saveOrUpdateProject({status:0}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u505c\u6b62"},"stop"),Object(T["jsx"])(h["a"].Item,{onClick:()=>{r(e.shortId),S({title:"\u786e\u5b9a\u5220\u9664\u5f53\u524d\u95ee\u5377?",icon:Object(T["jsx"])(x["a"],{}),content:"\u5220\u9664\u4e4b\u540e\u53ef\u4ee5\u5728\u56de\u6536\u7ad9\u91cc\u9762\u627e\u56de",okText:"\u5220\u9664",okType:"danger",cancelText:"\u53d6\u6d88",onOk:()=>{new D["c"](e.shortId).deleteProject(e.id).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u5220\u9664"},"delete")]}),B=()=>0===C.length?Object(T["jsx"])(l["a"],{image:l["a"].PRESENTED_IMAGE_SIMPLE,imageStyle:{height:60},description:Object(T["jsx"])("span",{children:"\u5f53\u524d\u8fd8\u6ca1\u6709\u521b\u5efa\u95ee\u5377"})}):Object(T["jsx"])(n["a"],{gutter:[15,15],children:C.map((e=>Object(T["jsx"])(c["a"],{xs:24,sm:8,children:Object(T["jsx"])(o["a"],{onClick:()=>K.push("/survey/".concat(e.shortId)),hoverable:!0,actions:[Object(T["jsx"])(g["a"],{onClick:t=>V(t,e,"edit")},"edit"),Object(T["jsx"])(m["a"],{onClick:t=>V(t,e,"data")},"data"),Object(T["jsx"])(w["a"],{onClick:t=>V(t,e,"report")},"report"),Object(T["jsx"])(f["a"],{onClick:t=>V(t,e,"setting")},"setting"),Object(T["jsx"])(d["a"],{overlay:A(e),trigger:["click"],children:Object(T["jsx"])(k["a"],{onClick:t=>V(t,e,"more")},"ellipsis")})],children:Object(T["jsxs"])("div",{children:[Object(T["jsx"])("div",{className:"title",children:e.name}),Object(T["jsxs"])("div",{className:"content",children:[Object(T["jsx"])("div",{className:"publish-status",children:1===e.status?Object(T["jsx"])(i["a"],{status:"processing",text:"\u6536\u96c6\u4e2d",className:"yes"}):Object(T["jsx"])(i["a"],{status:"warning",text:"\u672a\u53d1\u5e03",className:"no"})}),Object(T["jsxs"])("div",{className:"total",children:[Object(T["jsx"])("span",{children:e.total}),"\u4efd\u6570\u636e"]})]})]})})},e.shortId)))});return Object(T["jsxs"])("div",{className:"survey-home",children:[Object(T["jsx"])(o["a"],{className:"survey-home-header",title:Object(T["jsx"])("div",{className:"survey-home-title",children:"\u6211\u7684\u95ee\u5377"}),extra:Object(T["jsx"])(a["a"],{title:"\u9000\u51fa",children:Object(T["jsx"])(s["a"],{type:"text",shape:"circle",icon:Object(T["jsx"])(I["a"],{}),loading:E,onClick:()=>U.logout()})}),children:Object(T["jsx"])(n["a"],{className:"survey-home-search",gutter:[4,4],children:Object(T["jsx"])(c["a"],{xs:24,sm:12,children:Object(T["jsxs"])("div",{children:[Object(T["jsx"])(u["a"].Search,{className:"search",placeholder:"\u95ee\u5377\u68c0\u7d22",onSearch:e=>{b.loadProjects(e)}}),Object(T["jsx"])(s["a"],{type:"primary",icon:Object(T["jsx"])(P["a"],{}),onClick:()=>K.push("/survey/new"),children:"\u65b0\u5efa"})]})})})}),Object(T["jsx"])(o["a"],{className:"survey-home-content",loading:E,children:B()})]})}));t["default"]=E}}]);