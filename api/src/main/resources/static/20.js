(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[20],{DVlV:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return u}));var r=a("9og8"),n=a("WmNS"),s=a.n(n),c=a("nzmB"),o=a("hF6A");class i{constructor(e){this.records=[],this.selected=void 0,this.currentIndex=-1,this.projectStore=void 0,this.loading=void 0,this.reportData=void 0,this.pagination={current:1,pageSize:20,total:0},this.projectStore=e,this.makeObservable()}makeObservable(){Object(c["e"])(this,{loading:c["g"].ref,pagination:c["g"].ref,records:c["g"].ref,selected:c["g"].ref,currentIndex:c["g"].ref,reportData:c["g"].ref,shortId:c["g"].computed,loadData:c["b"],loadReportData:c["b"]})}get shortId(){return this.projectStore.shortId}loadData(e){var t=this;return Object(r["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o["b"].loadData(t.shortId,e||t.pagination);case 2:r=a.sent,r&&(t.pagination=r.pagination,t.records=r.records);case 4:case"end":return a.stop()}}),a)})))()}saveData(e){var t=this;return Object(r["a"])(s.a.mark((function a(){return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,e.shortId=t.shortId,a.next=4,o["b"].saveAnswer(e);case 4:t.loading=!1;case 5:case"end":return a.stop()}}),a)})))()}updateData(e){var t=this;return Object(r["a"])(s.a.mark((function a(){return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o["b"].updateAnswer(e);case 2:t.loadData();case 3:case"end":return a.stop()}}),a)})))()}deleteData(e){var t=this;return Object(r["a"])(s.a.mark((function a(){var r,n;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=[],r=void 0!==e?[t.records[e].id]:(null===(n=t.records)||void 0===n?void 0:n.reduce(((e,a,r)=>{var n;return null!==(n=t.selected)&&void 0!==n&&n.includes(r)&&e.push(a.id),e}),[]))||[],a.next=4,o["b"].deleteAnswer(r);case 4:t.loadData();case 5:case"end":return a.stop()}}),a)})))()}loadReportData(e){var t=this;return Object(r["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.next=3,o["b"].loadReportData(t.shortId,e);case 3:r=a.sent,r&&(t.reportData=r),t.loading=!1;case 6:case"end":return a.stop()}}),a)})))()}}var d=a("k1fw");class l{constructor(e,t){this.id=void 0,this.shortId=void 0,this.project=void 0,this.loading=void 0,this.isPC=void 0,this.bgi=[],this.hi=[],this.shortId=e,this.id=t,this.makeObservable()}makeObservable(){Object(c["e"])(this,{id:c["g"].ref,shortId:c["g"].ref,loading:c["g"].ref,project:c["g"].ref,bgi:c["g"],hi:c["g"],schema:c["g"].computed,setting:c["g"].computed,name:c["g"].computed,saveOrUpdateProject:c["b"],loadImages:c["b"],updateSetting:c["b"],uploadImage:c["b"]})}get name(){var e;return null===(e=this.project)||void 0===e?void 0:e.name}get schema(){var e;return null===(e=this.project)||void 0===e?void 0:e.survey}get setting(){var e;return null===(e=this.project)||void 0===e?void 0:e.setting}loadProject(){var e=this;return Object(r["a"])(s.a.mark((function t(){var a;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.shortId||"new"===e.shortId){t.next=6;break}return e.loading=!0,t.next=4,o["b"].loadProject(e.shortId);case 4:a=t.sent,a&&(e.project=a);case 6:e.loading=!1;case 7:case"end":return t.stop()}}),t)})))()}saveOrUpdateProject(e){var t=this;return Object(r["a"])(s.a.mark((function a(){var r,n;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if("new"!==t.shortId){a.next=9;break}return a.next=3,o["b"].saveProject(Object(d["a"])(Object(d["a"])({},e),{},{setting:{answerSetting:{progressBar:!0,autoSave:!0}}}));case 3:return r=a.sent,t.shortId=r.data,t.loadProject(),a.abrupt("return",r.data);case 9:return a.next=11,o["b"].updateProject(Object(d["a"])(Object(d["a"])({},e),{},{id:t.id,shortId:t.shortId}));case 11:return n=a.sent,a.abrupt("return",n.data);case 13:case"end":return a.stop()}}),a)})))()}updateSetting(e){var t=this;return Object(r["a"])(s.a.mark((function a(){return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,o["b"].updateSetting(t.shortId,e);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()}deleteProject(e){return Object(r["a"])(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o["b"].deleteProject(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()}loadImages(e){var t=this;return Object(r["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.next=3,o["b"].loadImages(e);case 3:r=a.sent,"BACKGROUND_IMAGE"===e&&r?t.bgi=r:"HEADER_IMAGE"===e&&r&&(t.hi=r),t.loading=!1;case 6:case"end":return a.stop()}}),a)})))()}uploadImage(e,t){var a=this;return Object(r["a"])(s.a.mark((function r(){var n;return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return a.loading=!0,r.next=3,o["b"].uploadImage(e,t);case 3:n=r.sent,"BACKGROUND_IMAGE"===e?a.bgi.push(n.data):"HEADER_IMAGE"===e&&a.hi.push(n.data),a.loading=!1;case 6:case"end":return r.stop()}}),r)})))()}deleteImage(e,t){var a=this;return Object(r["a"])(s.a.mark((function r(){return s.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,o["b"].deleteImage(e);case 2:"BACKGROUND_IMAGE"===t&&(a.bgi=a.bgi.filter((t=>t.attachmentId!==e))),"HEADER_IMAGE"===t&&(a.hi=a.hi.filter((t=>t.attachmentId!==e)));case 4:case"end":return r.stop()}}),r)})))()}}class u{constructor(){this.projects=void 0,this.loading=!1,this.makeObservable()}makeObservable(){Object(c["e"])(this,{projects:c["g"].ref,loading:c["g"].ref})}loadProjects(e){var t=this;return Object(r["a"])(s.a.mark((function a(){var r;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.loading=!0,a.next=3,o["b"].loadProjects(e);case 3:r=a.sent,r&&(t.projects=r),t.loading=!1;case 6:case"end":return a.stop()}}),a)})))()}}},Ww8N:function(e,t,a){},yZnS:function(e,t,a){"use strict";a.r(t),a.d(t,"Home",(function(){return S}));a("5Dmo");var r=a("3S7+"),n=(a("+L6B"),a("2/Rp")),s=(a("14J3"),a("BMrR")),c=(a("jCWc"),a("kPKH")),o=(a("IzEo"),a("bx4M")),i=(a("Awhp"),a("KrTs")),d=(a("qVdP"),a("jsC+")),l=(a("R9oj"),a("ECub")),u=(a("5NDa"),a("5rEg")),h=(a("fOrg"),a("+KLJ")),j=(a("lUTK"),a("BvKs")),p=a("tJVT"),b=(a("2qtc"),a("kLXV")),v=a("q1tI"),g=a("Ue1A"),O=a("RCxd"),x=a("G3dp"),m=a("U+PY"),w=a("UdsK"),f=a("eFNv"),I=a("GZ0F"),k=a("aIfO"),P=a("xvlK"),y=a("Ty5D"),D=(a("Ww8N"),a("jOlz")),C=a("DVlV"),E=a("6qww"),N=a("nKUr"),A=b["a"].confirm,S=Object(D["i"])((()=>{var e=Object(v["useState"])(),t=Object(p["a"])(e,2),a=(t[0],t[1]),b=Object(v["useMemo"])((()=>new C["b"]),[]),D=b.projects||[],S=b.loading,T=Object(E["a"])(),R=Object(v["useRef"])(""),U=Object(y["g"])();Object(v["useEffect"])((()=>{b.loadProjects()}),[]);var G=(e,t,a)=>{e.stopPropagation(),"more"!==a&&U.push("/survey/".concat(t.shortId,"/").concat(a))},K=e=>Object(N["jsxs"])(j["a"],{onClick:e=>e.domEvent.stopPropagation(),children:[Object(N["jsx"])(j["a"].Item,{onClick:()=>window.open("/s/".concat(e.shortId)),children:"\u9884\u89c8"},"preview"),Object(N["jsx"])(j["a"].Item,{onClick:()=>{a(e.shortId),A({title:"\u95ee\u5377\u91cd\u547d\u540d",icon:void 0,content:Object(N["jsxs"])("div",{children:[Object(N["jsx"])(h["a"],{message:"\u95ee\u5377\u91cd\u547d\u540d\u6210\u529f\uff0c\u7cfb\u7edf\u5185\u5404\u5904\u5c06\u663e\u793a\u91cd\u547d\u540d\u6807\u9898\u3002\u6b64\u64cd\u4f5c\u4e0d\u5f71\u54cd\u516c\u5f00\u95ee\u5377\u540d\u79f0",type:"info",showIcon:!0}),Object(N["jsx"])(u["a"],{style:{marginTop:10},onChange:e=>R.current=e.target.value,defaultValue:e.name})]}),okText:"\u786e\u8ba4",okType:"primary",cancelText:"\u53d6\u6d88",onOk:()=>{new C["c"](e.shortId).saveOrUpdateProject({name:R.current}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u91cd\u547d\u540d"},"rename"),0===e.status&&Object(N["jsx"])(j["a"].Item,{onClick:()=>{a(e.shortId),A({title:"\u786e\u5b9a\u53d1\u5e03\u5f53\u524d\u95ee\u5377?",icon:Object(N["jsx"])(g["a"],{style:{color:"#1890ff"}}),content:"\u53ea\u6709\u53d1\u5e03\u7684\u95ee\u5377\u624d\u80fd\u6536\u96c6\u6570\u636e",okText:"\u53d1\u5e03",okType:"primary",cancelText:"\u53d6\u6d88",onOk:()=>{new C["c"](e.shortId).saveOrUpdateProject({status:1}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u53d1\u5e03"},"publish"),1===e.status&&Object(N["jsx"])(j["a"].Item,{onClick:()=>{a(e.shortId),A({title:"\u786e\u5b9a\u505c\u6b62\u5f53\u524d\u95ee\u5377?",icon:Object(N["jsx"])(O["a"],{}),content:"\u505c\u6b62\u4e4b\u540e\u95ee\u5377\u5c06\u4e0d\u80fd\u7ee7\u7eed\u6536\u96c6\u6570\u636e",okText:"\u505c\u6b62",okType:"danger",cancelText:"\u53d6\u6d88",onOk:()=>{new C["c"](e.shortId).saveOrUpdateProject({status:0}).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u505c\u6b62"},"stop"),Object(N["jsx"])(j["a"].Item,{onClick:()=>{a(e.shortId),A({title:"\u786e\u5b9a\u5220\u9664\u5f53\u524d\u95ee\u5377?",icon:Object(N["jsx"])(O["a"],{}),content:"\u5220\u9664\u4e4b\u540e\u53ef\u4ee5\u5728\u56de\u6536\u7ad9\u91cc\u9762\u627e\u56de",okText:"\u5220\u9664",okType:"danger",cancelText:"\u53d6\u6d88",onOk:()=>{new C["c"](e.shortId).deleteProject(e.id).then((e=>{200===e.code&&b.loadProjects()}))}})},children:"\u5220\u9664"},"delete")]}),M=()=>0===D.length?Object(N["jsx"])(l["a"],{image:l["a"].PRESENTED_IMAGE_SIMPLE,imageStyle:{height:60},description:Object(N["jsx"])("span",{children:"\u5f53\u524d\u8fd8\u6ca1\u6709\u521b\u5efa\u95ee\u5377"})}):Object(N["jsx"])(s["a"],{gutter:[15,15],children:D.map((e=>Object(N["jsx"])(c["a"],{xs:24,sm:8,children:Object(N["jsx"])(o["a"],{onClick:()=>U.push("/survey/".concat(e.shortId)),hoverable:!0,actions:[Object(N["jsx"])(x["a"],{onClick:t=>G(t,e,"edit")},"edit"),Object(N["jsx"])(m["a"],{onClick:t=>G(t,e,"data")},"data"),Object(N["jsx"])(w["a"],{onClick:t=>G(t,e,"report")},"report"),Object(N["jsx"])(f["a"],{onClick:t=>G(t,e,"setting")},"setting"),Object(N["jsx"])(d["a"],{overlay:K(e),trigger:["click"],children:Object(N["jsx"])(I["a"],{onClick:t=>G(t,e,"more")},"ellipsis")})],children:Object(N["jsxs"])("div",{children:[Object(N["jsx"])("div",{className:"title",children:e.name}),Object(N["jsxs"])("div",{className:"content",children:[Object(N["jsx"])("div",{className:"publish-status",children:1===e.status?Object(N["jsx"])(i["a"],{status:"processing",text:"\u6536\u96c6\u4e2d",className:"yes"}):Object(N["jsx"])(i["a"],{status:"warning",text:"\u672a\u53d1\u5e03",className:"no"})}),Object(N["jsxs"])("div",{className:"total",children:[Object(N["jsx"])("span",{children:e.total}),"\u4efd\u6570\u636e"]})]})]})})},e.shortId)))});return Object(N["jsxs"])("div",{className:"survey-home",children:[Object(N["jsx"])(o["a"],{className:"survey-home-header",title:Object(N["jsx"])("div",{className:"survey-home-title",children:"\u6211\u7684\u95ee\u5377"}),extra:Object(N["jsx"])(r["a"],{title:"\u9000\u51fa",children:Object(N["jsx"])(n["a"],{type:"text",shape:"circle",icon:Object(N["jsx"])(k["a"],{}),loading:S,onClick:()=>T.logout()})}),children:Object(N["jsx"])(s["a"],{className:"survey-home-search",gutter:[4,4],children:Object(N["jsx"])(c["a"],{xs:24,sm:12,children:Object(N["jsxs"])("div",{children:[Object(N["jsx"])(u["a"].Search,{className:"search",placeholder:"\u95ee\u5377\u68c0\u7d22",onSearch:e=>{b.loadProjects(e)}}),Object(N["jsx"])(n["a"],{type:"primary",icon:Object(N["jsx"])(P["a"],{}),onClick:()=>U.push("/survey/new"),children:"\u65b0\u5efa"})]})})})}),Object(N["jsx"])(o["a"],{className:"survey-home-content",loading:S,children:M()})]})}));t["default"]=S}}]);