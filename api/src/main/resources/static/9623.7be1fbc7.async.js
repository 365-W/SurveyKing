(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[9623],{29623:function(L,S,d){"use strict";d.d(S,{j$:function(){return g},Ox:function(){return x}});var v=d(69610),y=d(54941),i=d(54531),A=function(){function h(n,e){(0,v.Z)(this,h),this.context=void 0,this.props=void 0,this.current=0,this.history=[],this.updateTimer=null,this.maxSize=100,this.context=n,this.props=e,this.push(),this.makeObservable()}return(0,y.Z)(h,[{key:"makeObservable",value:function(){(0,i.Ou)(this,{allowRedo:i.LO.computed,allowUndo:i.LO.computed,current:i.LO.ref,history:i.LO.shallow,push:i.aD,undo:i.aD,redo:i.aD,goTo:i.aD,clear:i.aD})}},{key:"list",value:function(){return this.history}},{key:"push",value:function(){this.current<this.history.length-1&&(this.history=this.history.slice(0,this.current+1)),this.current=this.history.length,this.history.push(this.context.serialize());var e=this.history.length-this.maxSize;e>0&&(this.history.splice(0,e),this.current=this.history.length-1)}},{key:"allowUndo",get:function(){return this.history.length>0&&this.current-1>=0}},{key:"allowRedo",get:function(){return this.history.length>this.current+1}},{key:"redo",value:function(){if(this.allowRedo){var e,t=this.history[this.current+1];this.context.from(t),this.current++,(e=this.props)!==null&&e!==void 0&&e.onRedo&&this.props.onRedo(t)}}},{key:"undo",value:function(){if(this.allowUndo){var e,t=this.history[this.current-1];this.context.from(t),this.current--,(e=this.props)!==null&&e!==void 0&&e.onUndo&&this.props.onUndo(t)}}},{key:"goTo",value:function(e){this.history[e]&&(this.context.from(this.history[e]),this.current=e)}},{key:"clear",value:function(){this.history=[],this.current=0}}]),h}(),T=d(69646),C=d(86582),R=d(11849),u=d(93224),c=d(64031),N=d(77596),w=new Map,k=new Set,I=(0,N.kP)("1234567890abcdefghijklmnopqrstuvwxyz",4);function x(){var h=I();return k.has(h)?x():(k.add(h),h)}function Z(h){for(var n=arguments.length,e=new Array(n>1?n-1:0),t=1;t<n;t++)e[t-1]=arguments[t];return JSON.parse(JSON.stringify(h,function(r,a){if(a!=null&&!(a instanceof Array&&a.length===0)&&e.indexOf(r)===-1&&!r.startsWith("_"))return a}))}var W=function(n,e){var t=function o(s){s.depth=s.parent?s.parent.depth+1:0,s.children.forEach(o)},r=function(s){s.parent=e,s.root=e.root,t(s)},a=function(s){return r(s),W(s.children,s),s};return n.map(function(o){return a(o),w.has(o.id)||w.set(o.id,o),o})},D=function(n){n.parent&&(n.parent.children=n.parent.children.filter(function(e){return e!==n}))},f=function(){function h(n,e){var t=this;(0,v.Z)(this,h),this.parent=void 0,this.root=void 0,this.operation=void 0,this.form=void 0,this.id=void 0,this.title=void 0,this.depth=0,this.index=0,this.hidden=!1,this.focus=!1,this.type=void 0,this.children=[];var r=n.schema,a=r.children,o=(0,u.Z)(r,["children"]);this.id=n.schema.id||x(),this.title=n.schema.title||"",o.dataSource&&o.dataSource.forEach(function(s){s.value||(s.value=x())}),o.row&&o.row.forEach(function(s){s.id||(s.id=x())}),this.form=(0,c.Np)({initialValues:o,effects:function(O){(0,c.Zj)("title",function(b){t.title=b.value}),(0,c.Zj)("type",function(b){t.type=b.value})}}),this.children=a&&a.map(function(s){return h.fromSchema(s,t)})||[],this.type=o.type,e?(this.parent=e,this.depth=e.depth+1,this.root=e.root):this.root=this,w.set(this.id,this),this.operation=n==null?void 0:n.operation,this.makeObservable(),this.resetIndex()}return(0,y.Z)(h,[{key:"isVoid",get:function(){return this.type==="Pagination"||this.type==="SplitLine"||this.type==="Remark"}},{key:"actionVisible",get:function(){return!(this.type==="Pagination"&&this.index===0)}},{key:"makeObservable",value:function(){(0,i.Ou)(this,{type:i.LO.ref,parent:i.LO.ref,actionVisible:i.LO.computed,isVoid:i.LO.computed,hidden:i.LO.ref,focus:i.LO,form:i.LO.ref,index:i.LO,children:i.LO.shallow,prependNode:i.aD,appendNodeAtIndex:i.aD,remove:i.aD})}},{key:"serialize",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Z.apply(void 0,[(0,R.Z)((0,R.Z)({},(0,i.ZN)(this.form.values)),{},{id:this.id,type:this.type,children:this.children.map(function(a){return a.serialize()})})].concat(t))}},{key:"findById",value:function(e){var t;if(!!e){if(this.id===e)return this;if(((t=this.children)===null||t===void 0?void 0:t.length)>0)return w.get(e)}}},{key:"getParents",value:function(e){var t=e||this;return t!=null&&t.parent?[t.parent].concat(this.getParents(t.parent)):[]}},{key:"getParentByDepth",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=this.parent;return(t==null?void 0:t.depth)===e?t:t==null?void 0:t.getParentByDepth(e)}},{key:"contains",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return r.every(function(o){return o===e||(o==null?void 0:o.parent)===e||(o==null?void 0:o.getParentByDepth(e.depth))===e})}},{key:"triggerMutation",value:function(){var e;this!==null&&this!==void 0&&(e=this.root)!==null&&e!==void 0&&e.operation&&this.root.operation.snapshot()}},{key:"resetNodesParent",value:function(e,t){var r=this;return W(e.filter(function(a){return a!==r}),t)}},{key:"resetIndex",value:function(){if(this.children){var e=0,t=0;this.children.forEach(function(r,a){r.isVoid?r.type==="Pagination"?(r.index=t,t++):r.index=-1:(r.index=e,e++)})}}},{key:"prependNode",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];if(r.some(function(s){return s.contains(e)}))return[];var o=this.resetNodesParent(r,this);if(!o.length)return[];this.children=o.concat(this.children),this.triggerMutation(),this.resetIndex()}},{key:"appendNode",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];if(r.some(function(s){return s.contains(e)}))return[];var o=this.resetNodesParent(r,this);if(!o.length)return[];this.children=T.VS.apply(void 0,[this.children,this.children.length].concat((0,C.Z)(o))),this.resetIndex()}},{key:"appendNodeAtIndex",value:function(e){for(var t=this,r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];if(a.some(function(O){return O.contains(t)}))return[];var s=this.resetNodesParent(a,this);if(!s.length)return[];this.children=T.VS.apply(void 0,[this.children,e].concat(a)),this.resetIndex()}},{key:"insertAfter",value:function(){for(var e=this,t,r=this.parent,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];if(o.some(function(b){return b.contains(e)}))return[];if(r!=null&&(t=r.children)!==null&&t!==void 0&&t.length){var O=this.resetNodesParent(o,r);if(!O.length)return[];r.children=r.children.reduce(function(b,E){return E===e?b.concat([E]).concat(O):b.concat([E])},[])}return[]}},{key:"deleteNode",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.children=this.children.filter(function(a){return!t.includes(a)}),w.delete(this.id)}},{key:"remove",value:function(){var e;D(this),(e=this.parent)===null||e===void 0||e.resetIndex()}},{key:"copy",value:function(){var e,t=h.fromSchema(this.serialize("id"));(e=this.parent)===null||e===void 0||e.appendNodeAtIndex(this.index+1,t)}}],[{key:"fromSchema",value:function(e,t){return new h({schema:e},t)}}]),h}(),l=(0,T.JH)(),P=function(){function h(n){(0,v.Z)(this,h),this.workspace=void 0,this.requests={snapshot:-1},this.focusNode=void 0,this.workspace=n,this.makeObservable()}return(0,y.Z)(h,[{key:"makeObservable",value:function(){(0,i.Ou)(this,{focusNode:i.LO.ref,removeNodes:i.aD,cloneNodes:i.aD,dropAddNode:i.aD,dropSortNode:i.aD,addNode:i.aD,addNodeWithTemplate:i.aD,switchFocusNode:i.aD,focusClean:i.aD,batchAddNode:i.aD,batchReplaceNode:i.aD,changePreviewTheme:i.aD,changePreviewType:i.aD,changeWorkbench:i.aD,changeBackgroundImage:i.aD,templatePreview:i.aD,fromTemplate:i.aD})}},{key:"snapshot",value:function(){var e=this;(0,T.mO)(this.requests.snapshot),this.requests.snapshot=(0,T.LQ)(function(){e.workspace.history.push()})}},{key:"dropAddNode",value:function(e,t){var r=t.type,a=t.addedIndex,o=t.template;if(r&&!o&&(o=l.getQuestionTemplate(r)),!!o){var s=f.fromSchema(o);e.appendNodeAtIndex(a,s);var O=this.workspace.tree;if(o.type==="Pagination"&&O.children.filter(function(E){return E.type==="Pagination"}).length===1){var b=f.fromSchema(o);O.prependNode(b)}this.snapshot()}}},{key:"dropSortNode",value:function(e,t,r){e.remove(),t.appendNodeAtIndex(r,e),this.snapshot()}},{key:"addNode",value:function(e,t){var r=l.getQuestionTemplate(e);return this.addNodeWithTemplate(r,t)}},{key:"addNodeWithTemplate",value:function(e,t){var r=this,a=this.workspace.tree,o=f.fromSchema(e,t);if(t)t.appendNode(o);else if(e.type==="QuestionSet"||e.type==="Pagination"){if(a.appendNode(o),e.type==="Pagination"&&a.children.filter(function(b){return b.type==="Pagination"}).length===1){var s=f.fromSchema(e,t);a.prependNode(s)}e.type==="Pagination"&&this.rebuildPagination()}else{var O=a.children.slice(-1)[0];O&&O.type==="QuestionSet"?O.appendNode(o):a.appendNode(o),setTimeout(function(){r.switchFocusNode(o)},20)}return this.snapshot(),o}},{key:"batchAddNode",value:function(e,t){e.forEach(function(r){t.appendNode(f.fromSchema(r,t))}),this.snapshot()}},{key:"batchReplaceNode",value:function(e,t){t.children=[],this.batchAddNode(e,t),this.snapshot()}},{key:"removeNodes",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];r.forEach(function(o){if(o.type==="Pagination"){var s,O=(s=o.parent)===null||s===void 0?void 0:s.children.filter(function(j){return j.type==="Pagination"}).length;if(O===2){var b,E=(b=o.parent)===null||b===void 0?void 0:b.children[0];E&&E.type==="Pagination"&&E.remove()}e.rebuildPagination()}o.remove()}),this.snapshot()}},{key:"copyNode",value:function(e){e.copy(),this.snapshot()}},{key:"cloneNodes",value:function(){}},{key:"switchFocusNode",value:function(e){this.focusNode!==e&&(this.focusNode&&(this.focusNode.focus=!1),this.focusNode=e,e.focus=!0)}},{key:"focusClean",value:function(){this.focusNode&&(this.focusNode.focus=!1),this.focusNode=void 0}},{key:"changePreviewTheme",value:function(e){this.workspace.workbench.type==="PREVIEW"&&(this.workspace.workbench.previewTheme=e)}},{key:"changePreviewType",value:function(e){this.workspace.workbench.type==="PREVIEW"&&(this.workspace.workbench.previewType=e)}},{key:"changeWorkbench",value:function(e){this.workspace.workbench.type=e}},{key:"rebuildPagination",value:function(){var e=this.workspace.tree.children.filter(function(t){return t.type==="Pagination"});e.forEach(function(t,r){t.form.values.attribute={currentPage:r+1,totalPage:e.length}})}},{key:"changeBackgroundImage",value:function(e,t){var r=this.workspace.tree;r.form.values.attribute||(r.form.values.attribute={}),r.form.values.attribute[e]=t,this.snapshot()}},{key:"templatePreview",value:function(e){this.snapshot(),this.workspace.workbench.previewType="PC",this.workspace.workbench.type="PREVIEW",this.workspace.from(e)}},{key:"fromTemplate",value:function(e){this.snapshot(),this.workspace.from(e),this.workspace.workbench.type="EDITOR"}}]),h}(),p=function(){function h(n){(0,v.Z)(this,h),this.type=void 0,this.previewTheme=void 0,this.previewType=void 0,this.operation=void 0,this.type="EDITOR",this.previewTheme="antd",this.previewType="PHONE",this.operation=n,this.makeObservable()}return(0,y.Z)(h,[{key:"makeObservable",value:function(){(0,i.Ou)(this,{type:i.LO.ref,previewType:i.LO.ref,previewTheme:i.LO.ref})}}]),h}(),m=(0,T.JH)(),g=function(){function h(n){var e=this;(0,v.Z)(this,h),this.history=void 0,this.operation=void 0,this.tree=void 0,this.workbench=void 0,this.operation=new P(this),this.tree=new f({operation:this.operation,schema:n||m.getQuestionTemplate("Survey")}),this.workbench=new p(this.operation),this.history=new A(this,{onRedo:function(r){e.from(r),e.operation.focusClean()},onUndo:function(r){e.from(r),e.operation.focusClean()}}),this.makeObservable()}return(0,y.Z)(h,[{key:"makeObservable",value:function(){(0,i.Ou)(this,{tree:i.LO.ref})}},{key:"serialize",value:function(){return this.tree.serialize()}},{key:"from",value:function(e){this.tree=f.fromSchema(e)}},{key:"getEventContext",value:function(){return{workspace:this}}},{key:"dispatch",value:function(e){}}]),h}()},23063:function(L,S,d){"use strict";d.d(S,{ZX:function(){return y},Gb:function(){return A},Y7:function(){return C}});var v=d(67294),y=v.createContext({}),i=v.createContext({}),A=v.createContext({}),T=v.createContext({}),C=v.createContext({})},69646:function(L,S,d){"use strict";d.d(S,{Gb:function(){return y.Gb},Y7:function(){return y.Y7},ZX:function(){return y.ZX},mO:function(){return c},Gr:function(){return W},JH:function(){return v.JH},Cp:function(){return A},VS:function(){return N.VS},j1:function(){return v.j1},QT:function(){return v.QT},RY:function(){return v.RY},LQ:function(){return u},$Z:function(){return T},WO:function(){return N.WO}});var v=d(61974),y=d(23063),i=function(f){return Array.isArray(f)?f:f?[f]:[]},A=function(f){for(var l=arguments.length,P=new Array(l>1?l-1:0),p=1;p<l;p++)P[p-1]=arguments[p];return P.forEach(function(m){return f.query(f.path.concat(m)).take(function(g){return g.display="none"})})},T=function(f){for(var l=arguments.length,P=new Array(l>1?l-1:0),p=1;p<l;p++)P[p-1]=arguments[p];return P.forEach(function(m){return f.query(f.path.concat(m)).take(function(g){return g.display="visible"})})},C=function(f){for(var l=arguments.length,P=new Array(l>1?l-1:0),p=1;p<l;p++)P[p-1]=arguments[p];return P.forEach(function(m){return f.query(f.path.concat(m)).take(function(g){g.display==="none"&&f.value&&(g.caches.value=void 0,delete f.value[m]),g.display="visible"})})},R=d(16308),u=function(f,l){return window.requestIdleCallback(f,l)},c=function(f){window.cancelIdleCallback(f)},N=d(84821),w=d(86582),k=d(11849),I=d(67294),x=d(2299),Z=d(85893);function W(D,f){return function(l){var P=l.name||(f==null?void 0:f.name);if(!P)throw new Error("field name \u672A\u5B9A\u4E49");var p=(0,I.useMemo)(function(){return(0,x.$j)(D,(0,x.jM)(function(m,g){return(0,k.Z)((0,k.Z)({},m),{},{onChange:function(n){g.onInput(n)},hasError:g.errors.length>0})}))},[]);return(0,Z.jsx)(x.gN,(0,k.Z)((0,k.Z)((0,k.Z)({},l),f),{},{name:P,component:[p,l],reactions:[function(m){var g=l.syncDisplay;g&&(typeof g=="string"||typeof g=="object"&&Object.keys(g).forEach(function(t){var r=m.query(m.path.parent().concat(t)).get("value");g[t].includes(r)?m.display="visible":m.display="none"}));var h=l.mirrorFieldAddress;if(h){var n=m.query(h),e=n.get("value");e?m.visible=!0:n.take()!==void 0&&(m.visible=!1)}}].concat((0,w.Z)(l.reactions||[]))}))}}},61974:function(L,S,d){"use strict";d.d(S,{JH:function(){return A},RY:function(){return T},QT:function(){return C},j1:function(){return R}});var v={},y={},i={questionTypes:{},questionSettings:{},questionOperations:{},registerDesignerIcons:function(c){Object.assign(v,c)},getDesignerIcon:function(c){return v[c]},registerQuestionTemplates:function(c){Object.assign(y,c)},getQuestionTemplate:function(c){return y[c]||{type:c}}},A=function(){return i};function T(u,c){i.questionTypes[u]=c}function C(u,c){i.questionSettings[u]=c}function R(u,c){i.questionOperations[u]=c}},84821:function(L,S,d){"use strict";d.d(S,{vC:function(){return i},JY:function(){return A},WO:function(){return C},VS:function(){return R}});var v=d(9963),y=d(86582);function i(u){var c=1;for(var N in u)if(!!u.hasOwnProperty(N)&&typeof u[N]=="object"&&A(u[N])){var w=i(u[N])+1;c=Math.max(w,c)}return c}function A(u){return u==null||typeof u=="number"&&u.toString()==="NaN"?!1:!(typeof u=="string"&&u.trim()==="")}var T={compile:function(c,N){var w=Object.keys(N||{}),k=w.map(function(I){return N[I]});return(0,v.Z)(Function,(0,y.Z)(w).concat(["return (".concat(c,");")])).apply(void 0,(0,y.Z)(k))}};function C(u){var c=document.createElement("div");return c.innerHTML=u,c.textContent||c.innerText||""}function R(u,c){for(var N=arguments.length,w=new Array(N>2?N-2:0),k=2;k<N;k++)w[k-2]=arguments[k];return u.length===0?w:c>=u.length?u.concat(w):u.reduce(function(I,x,Z){return c===Z&&I.push.apply(I,w),I.push(x),I},[])}}}]);
