(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[1379],{2444:function(ye,T,a){"use strict";a.r(T),a.d(T,{MobileOrPC:function(){return L},default:function(){return re}});var je=a(57106),k=a(99683),Se=a(71194),R=a(50146),xe=a(57663),B=a(71577),Ce=a(9715),E=a(93766),Ie=a(47673),A=a(4107),C=a(2824),$=a(51615),c=a(67294),y=a(28991),V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM540 701v53c0 4.4-3.6 8-8 8h-40c-4.4 0-8-3.6-8-8v-53a48.01 48.01 0 1156 0zm152-237H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224z"}}]},name:"lock",theme:"filled"},J=V,P=a(27029),Z=function(s,r){return c.createElement(P.Z,(0,y.Z)((0,y.Z)({},s),{},{ref:r,icon:J}))};Z.displayName="LockFilled";var H=c.forwardRef(Z),U={icon:function(s,r){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M81.8 537.8a60.3 60.3 0 010-51.5C176.6 286.5 319.8 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c-192.1 0-335.4-100.5-430.2-300.2z",fill:r}},{tag:"path",attrs:{d:"M512 258c-161.3 0-279.4 81.8-362.7 254C232.6 684.2 350.7 766 512 766c161.4 0 279.5-81.8 362.7-254C791.4 339.8 673.3 258 512 258zm-4 430c-97.2 0-176-78.8-176-176s78.8-176 176-176 176 78.8 176 176-78.8 176-176 176z",fill:r}},{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258s279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766z",fill:s}},{tag:"path",attrs:{d:"M508 336c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z",fill:s}}]}},name:"eye",theme:"twotone"},G=U,O=function(s,r){return c.createElement(P.Z,(0,y.Z)((0,y.Z)({},s),{},{ref:r,icon:G}))};O.displayName="EyeTwoTone";var K=c.forwardRef(O),Q=a(88633),W=a(95566),D=a(98210),X=a(92725),I=a(55317),Y=a(42874),we=a(56717),j=a(3182),q=a(69610),_=a(54941),ee=a(94043),m=a.n(ee),S=a(89835),i=a(77883),te=function(){function h(s){(0,q.Z)(this,h),this.shortId=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.startTime=void 0,this.shortId=s,this.makeObservable(),this.loadProject(),this.startTime=new Date().getTime()}return(0,_.Z)(h,[{key:"makeObservable",value:function(){(0,i.Ou)(this,{shortId:i.LO.ref,survey:i.LO.ref,loading:i.LO.ref,saving:i.LO.ref,verifying:i.LO.ref,project:i.LO.ref,passwordRequired:i.LO.computed,tempSaveId:i.LO.computed,savedAnswer:i.LO.computed,status:i.LO.computed,setting:i.LO.computed,tempSave:i.aD,saveData:i.aD,loadProject:i.aD,verifyPassword:i.aD})}},{key:"setting",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.setting}},{key:"status",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.status}},{key:"passwordRequired",get:function(){var r;return(r=this.project)===null||r===void 0?void 0:r.passwordRequired}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.shortId}},{key:"savedAnswer",get:function(){var r=localStorage.getItem(this.tempSaveId);return r&&JSON.parse(r)}},{key:"tempSave",value:function(r,o){var e=localStorage.getItem(this.tempSaveId),l;e?(l=JSON.parse(e),l.answer=r):l={answer:r,attachment:o,metaInfo:{answerInfo:{startTime:new Date().getTime()}}},localStorage.setItem(this.tempSaveId,JSON.stringify(l))}},{key:"saveData",value:function(){var s=(0,j.Z)(m().mark(function o(e,l){var d;return m().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.saving=!0,d={answer:e,attachment:l,shortId:this.shortId,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()}}},g.next=4,S.hi.post("/api/public/saveAnswer",d,!1);case 4:localStorage.removeItem(this.tempSaveId),this.saving=!1;case 6:case"end":return g.stop()}},o,this)}));function r(o,e){return s.apply(this,arguments)}return r}()},{key:"loadProject",value:function(){var s=(0,j.Z)(m().mark(function o(){var e;return m().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.loading=!0,d.next=3,S.hi.get("/api/public/loadProject?shortId=".concat(this.shortId));case 3:e=d.sent,this.project=e,this.survey=e==null?void 0:e.survey,this.loading=!1;case 7:case"end":return d.stop()}},o,this)}));function r(){return s.apply(this,arguments)}return r}()},{key:"verifyPassword",value:function(){var s=(0,j.Z)(m().mark(function o(e){var l;return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.verifying=!0,n.next=3,S.hi.post("/api/public/verifyPassword",{shortId:this.shortId,password:e},!1);case 3:if(l=n.sent,this.verifying=!1,l.code!==200){n.next=8;break}return this.survey=l.data.survey,n.abrupt("return",!0);case 8:return n.abrupt("return",!1);case 9:case"end":return n.stop()}},o,this)}));function r(o){return s.apply(this,arguments)}return r}()},{key:"upload",value:function(){var s=(0,j.Z)(m().mark(function o(e,l){return m().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",S.hi.upload("/api/public/upload",{file:e},l));case 1:case"end":return n.stop()}},o)}));function r(o,e){return s.apply(this,arguments)}return r}()}]),h}(),t=a(85893),L=(0,W.Pi)(function(){var h,s,r=(0,$.UO)(),o=r.shortId,e=(0,c.useMemo)(function(){return new te(o)},[o]),l=(0,c.useState)(!1),d=(0,C.Z)(l,2),n=d[0],g=d[1],x=(0,c.useMemo)(function(){return(0,D.SB)()},[]),ae=(0,c.useRef)(null),se=e.saving,ne=e.loading,ie=(h=e.setting)===null||h===void 0?void 0:h.autoSave,ue=(s=e.setting)===null||s===void 0?void 0:s.progressBar,oe=(0,c.useState)(),M=(0,C.Z)(oe,2),b=M[0],le=M[1],ve=(0,c.useState)({}),N=(0,C.Z)(ve,2),z=N[0],de=N[1],ce=function(){return ue?(0,t.jsx)(I.ko,{}):(0,t.jsx)(t.Fragment,{})},he=function(){var u;return(0,t.jsxs)("div",{className:"password-confirm",children:[(0,t.jsx)("h3",{children:(u=e.project)===null||u===void 0?void 0:u.name}),(0,t.jsx)(R.Z,{visible:!0,footer:null,closable:!1,width:350,children:(0,t.jsxs)(E.Z,{style:{margin:"10px 0"},children:[(0,t.jsx)("div",{style:{textAlign:"center",fontSize:20,marginBottom:10},children:"\u8BF7\u8F93\u5165\u5BC6\u7801\u586B\u5199\u95EE\u5377"}),(0,t.jsx)(E.Z.Item,{rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801!"}],validateStatus:z.validateStatus,help:z.help,children:(0,t.jsx)(A.Z.Password,{size:"large",placeholder:"\u5BC6\u7801",prefix:(0,t.jsx)(H,{}),onChange:function(f){return le(f.target.value)},iconRender:function(f){return f?(0,t.jsx)(K,{}):(0,t.jsx)(Q.Z,{})}})}),(0,t.jsx)(B.Z,{type:"primary",size:"large",htmlType:"submit",block:!0,loading:e.verifying,onClick:function(){b&&e.verifyPassword(b).then(function(f){f||de({help:"\u5BC6\u7801\u9A8C\u8BC1\u5931\u8D25",validateStatus:"error"})})},children:"\u9A8C\u8BC1\u5E76\u586B\u5199\u95EE\u5377"})]})})]})},fe=function(){var u;if((u=e.project)!==null&&u!==void 0&&u.name){var v;return(0,t.jsxs)("div",{className:"render-failure ".concat(x?"mobile":"phone"),children:[(0,t.jsx)("div",{className:"title",children:(v=e.project)===null||v===void 0?void 0:v.name}),(0,t.jsxs)("div",{className:"content",children:[(0,t.jsx)("div",{children:(0,t.jsx)(I.AT,{})}),(0,t.jsx)("h2",{children:"\u62B1\u6B49\uFF01\u4F60\u8BBF\u95EE\u7684\u95EE\u5377\u5DF2\u505C\u6B62\u6536\u96C6\u6570\u636E"}),(0,t.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})}return(0,t.jsx)("div",{className:"render-failure ".concat(x?"mobile":"phone"),children:(0,t.jsxs)("div",{className:"content",children:[(0,t.jsx)("div",{children:(0,t.jsx)(I.AT,{})}),(0,t.jsx)("h2",{children:"\u5BF9\u4E0D\u8D77, \u4F60\u8BBF\u95EE\u7684\u9875\u9762\u4E0D\u5B58\u5728"}),(0,t.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})})},me=function(){if(e.loading)return(0,t.jsx)(X.Z,{});if(e.status!==1)return fe();if(e.survey&&!n){var u,v;return(0,t.jsx)(Y.m,{ref:ae,loading:se||ne,questionNumber:(u=e.setting)===null||u===void 0?void 0:u.questionNumber,theme:x?"antdmobile":"antd",schema:e.survey,onChange:function(w,F){ie&&e.tempSave(w,F)},initialValues:(v=e.savedAnswer)===null||v===void 0?void 0:v.answer,onUpload:e.upload,onSubmit:function(w,F){e.saveData(w,F).then(function(){return g(!0)})}})}if(e.passwordRequired)return(0,t.jsx)("div",{children:he()})},ge=function(){return n?(0,t.jsx)(k.ZP,{status:"success",title:"\u7B54\u6848\u5DF2\u4FDD\u5B58!",extra:[(0,t.jsx)(B.Z,{type:"link",onClick:function(){return window.close()},children:"\u5173\u95ED"},"console")]}):(0,t.jsx)(t.Fragment,{})},pe=function(){var u,v,f=(u=e.survey)===null||u===void 0||(v=u.attribute)===null||v===void 0?void 0:v.backgroundImage;if(f)return{backgroundImage:"url(/api/public/preview/".concat(f,")")}};return(0,t.jsx)(D.ff.Provider,{value:e,children:(0,t.jsxs)("div",{className:"survey ".concat(x?"mobile":"pc"),style:pe(),children:[ce(),me(),ge()]})})}),re=L}}]);
