(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{bUpz:function(e,t,a){"use strict";a.r(t),a.d(t,"Report",(function(){return K}));var i=a("q1tI"),r=(a("TpwP"),a("+59K")),n=a("DVlV"),s=a("j0GH"),c=Object(i["createContext"])({}),l=c.Provider;c.Consumer;function o(e){var t,a=["Single","Multi","Cascader","Select","QuestionSet"];if(a.includes(e.type))return!0;if(("FillBlank"===e.type||"MultipleBlank"===e.type)&&(null!==(t=e.children)&&void 0!==t&&t.find((e=>{var t;return"number"===(null===(t=e.attribute)||void 0===t?void 0:t.dataType)}))))return!0;return!1}var d={Single:"\u5355\u9009\u9898",Multi:"\u591a\u9009\u9898",Cascader:"\u7ea7\u8054\u9898",Select:"\u4e0b\u62c9\u9898",FillBlank:"\u586b\u7a7a\u9898",MultipleBlank:"\u591a\u9879\u586b\u7a7a\u9898"};class j{constructor(){this._init=this._init.bind(this),this._cleanUp=this._cleanUp.bind(this),this.convertFromInput=this.convertFromInput.bind(this)}_init(){this.canvas=document.createElement("canvas"),this.imgPreview=document.createElement("img"),this.imgPreview.style="position: absolute; top: -9999px",document.body.appendChild(this.imgPreview),this.canvasCtx=this.canvas.getContext("2d")}_cleanUp(){document.body.removeChild(this.imgPreview)}convertFromInput(e,t){this._init();var a=this;this.imgPreview.onload=function(){var e=new Image;a.canvas.width=a.imgPreview.clientWidth,a.canvas.height=a.imgPreview.clientHeight,e.crossOrigin="anonymous",e.src=a.imgPreview.src,e.onload=function(){a.canvasCtx.drawImage(e,0,0);var i=a.canvas.toDataURL("image/png");"function"==typeof t&&t(i),a._cleanUp()}},this.imgPreview.src=e}}var u=a("nKUr"),h=e=>{var t;return e?null===(t=e.children)||void 0===t?void 0:t.filter((e=>o(e))).map((e=>"QuestionSet"===e.type?Object(u["jsx"])(v,{schema:e},e.id):Object(u["jsx"])(N,{schema:e},e.id))):Object(u["jsx"])(u["Fragment"],{})},b=Object(r["a"])((()=>{var e=Object(s["a"])(),t=e.schema;return Object(u["jsx"])("div",{children:h(t)})})),v=e=>Object(u["jsx"])("div",{children:h(e.schema)}),p=(a("14J3"),a("BMrR")),m=(a("g9YV"),a("wCAj")),x=(a("jCWc"),a("kPKH")),O=(a("+L6B"),a("2/Rp")),g=a("tJVT"),w=a("QEW4"),y=a("IrRn"),f=a("G+eS"),k=a("TLXH"),I=a("Sbuk"),C=a("k5Tp"),S=a("LadE"),B=a("Syqx"),P=a("/zI/"),F=a("l6yY");y["a"]([C["a"],S["a"],B["a"],k["a"],I["a"],F["a"],P["a"]]);var R=Object(i["forwardRef"])(((e,t)=>{var a=e.data,r=e.labels,n=e.loading,s=e.name,c=e.type,l=Object(i["useRef"])(null),o=Object(i["useRef"])();return Object(i["useEffect"])((()=>{if(l.current){var e=f["b"](l.current);return o.current=e,()=>{e.dispose()}}}),[]),Object(i["useImperativeHandle"])(t,(()=>({saveAsImage(){var e;return null===(e=o.current)||void 0===e?void 0:e.getDataURL({type:"png"})}}))),Object(i["useEffect"])((()=>{!n&&o.current?(o.current.hideLoading(),o.current.clear(),"horizontalBar"===c?o.current.setOption({title:{text:s},tooltip:{show:!0,trigger:"item"},xAxis:{show:!1},yAxis:{type:"category",data:r},series:[{data:a,type:"bar",barWidth:15,showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"}}]}):"pie"===c?o.current.setOption({title:{text:s},tooltip:{show:!0,trigger:"item"},series:[{name:s,type:"pie",radius:"60%",data:null===a||void 0===a?void 0:a.map(((e,t)=>({name:r[t],value:e}))),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},labelLine:{length:10,length2:25}}]}):"bar"===c&&o.current.setOption({title:{text:s},tooltip:{show:!0,trigger:"item"},xAxis:{type:"category",data:r,axisLabel:{interval:0,rotate:30}},yAxis:{show:!1},series:[{data:a,type:"bar",barWidth:15,showBackground:!0,backgroundStyle:{color:"rgba(180, 180, 180, 0.2)"}}]})):o.current&&o.current.showLoading()}),[n,c,a]),Object(u["jsx"])("div",{ref:l,style:{height:300}})})),q=a("PPVq"),N=Object(r["a"])((e=>{var t,a,r=e.schema,n=Object(i["useContext"])(c),s=n.loading,l=n.reportData,o=Object(i["useState"])("bar"),h=Object(g["a"])(o,2),b=h[0],v=h[1],y=(null===l||void 0===l||null===(t=l.statistics[r.id])||void 0===t?void 0:t.total)||0,f=Object(i["useRef"])(null),k=Object(i["useMemo"])((()=>"FillBlank"===r.type?[{title:"\u5408\u8ba1",dataIndex:"sum",width:"25%"},{title:"\u5e73\u5747\u503c",dataIndex:"average",width:"25%"},{title:"\u6700\u9ad8\u503c",dataIndex:"max",width:"25%"},{title:"\u6700\u4f4e\u503c",dataIndex:"min",width:"25%"}]:[{title:"\u9009\u9879",dataIndex:"title",width:"50%"},{title:"\u6570\u636e\u91cf",dataIndex:"total",width:"25%",sorter:(e,t)=>e.total-t.total,showSorterTooltip:!1},{title:"\u5360\u6bd4",dataIndex:"percent",width:"25%",sorter:(e,t)=>parseFloat(e.percent)-parseFloat(t.percent),showSorterTooltip:!1}]),[r.type]),I=()=>{var e,t=null===(e=f.current)||void 0===e?void 0:e.saveAsImage();t&&(new j).convertFromInput(t,(e=>{var t=document.createElement("a");t.href=e,t.download="haha.png",t.click(),t.remove()}))},C=()=>{var e;return null===(e=r.children)||void 0===e?void 0:e.map((e=>{var t=e.id,a=e.title,i=null===l||void 0===l?void 0:l.statistics[t];if(i){var r=i.total||0,n=(r/(y||1)*100).toFixed(2)+"%";return{id:t,title:Object(q["n"])(a),total:r,percent:n,min:i.min,max:i.max,average:i.average,sum:i.sum}}return{id:t,title:Object(q["n"])(a),total:0,percent:"0%"}}))},S=()=>{var e,t;if("FillBlank"===r.type||"MatrixFillBlank"===r.type)return Object(u["jsx"])(u["Fragment"],{});var a=(null===(e=r.children)||void 0===e?void 0:e.map((e=>Object(q["n"])(e.title))))||[],i=(null===(t=r.children)||void 0===t?void 0:t.map((e=>{var t;return(null===l||void 0===l||null===(t=l.statistics[e.id])||void 0===t?void 0:t.total)||0})))||[];return Object(u["jsxs"])(x["a"],{span:24,className:"question-chart",children:[Object(u["jsx"])("div",{className:"question-chart-btns",children:Object(u["jsxs"])(O["a"].Group,{size:"small",children:[Object(u["jsx"])(O["a"],{type:"link",onClick:()=>v("bar"),children:"\u6761\u5f62\u56fe"}),Object(u["jsx"])(O["a"],{type:"link",onClick:()=>v("horizontalBar"),children:"\u67f1\u5f62\u56fe"}),Object(u["jsx"])(O["a"],{type:"link",onClick:()=>v("pie"),children:"\u6247\u5f62\u56fe"}),Object(u["jsx"])(O["a"],{type:"link",icon:Object(u["jsx"])("div",{className:"divider"})}),Object(u["jsx"])(O["a"],{type:"link",icon:Object(u["jsx"])(w["a"],{}),onClick:I})]})}),Object(u["jsx"])("div",{children:Object(u["jsx"])(R,{type:b,loading:s,labels:a,data:i,ref:f})})]})},B=()=>Object(u["jsx"])(x["a"],{span:24,children:Object(u["jsx"])(m["a"],{pagination:!1,size:"small",bordered:!0,columns:k,rowKey:"id",dataSource:C()})});return Object(u["jsx"])("div",{className:"question-item",children:Object(u["jsxs"])(p["a"],{gutter:[12,12],className:"question-content",children:[Object(u["jsx"])(x["a"],{xs:24,sm:12,children:Object(u["jsxs"])(p["a"],{children:[Object(u["jsx"])(x["a"],{span:24,children:Object(u["jsx"])("span",{className:"question-label",children:Object(q["n"])(r.title)})}),S()]})}),Object(u["jsx"])(x["a"],{xs:24,sm:12,children:Object(u["jsxs"])(p["a"],{children:[Object(u["jsx"])(x["a"],{span:24,children:Object(u["jsx"])("div",{className:"question-title",children:Object(u["jsxs"])("div",{className:"question-data-desc",children:[Object(u["jsxs"])("div",{children:["\u7c7b\u578b\uff1a",d[r.type]]}),Object(u["jsxs"])("div",{children:["\u5fc5\u586b\uff1a",null!==(a=r.attribute)&&void 0!==a&&a.required?"\u662f":"\u5426"]}),Object(u["jsxs"])("div",{children:[y,"\u6761\u6570\u636e"]})]})})}),B()]})})]})})})),L=(a("qVdP"),a("jsC+")),E=(a("lUTK"),a("BvKs")),M=(a("5NDa"),a("5rEg")),U=a("jLSY"),D=a("sVM9"),T=a.n(D),_=M["a"].Search,z=Object(r["a"])((()=>{var e=Object(i["useContext"])(c),t=e.reportData,a=Object(u["jsxs"])(E["a"],{children:[Object(u["jsx"])(E["a"].Item,{children:"\u6309\u6570\u636e\u5185\u5bb9\u7b5b\u9009"}),Object(u["jsx"])(E["a"].Item,{children:"\u6309\u63d0\u4ea4\u65e5\u671f\u7b5b\u9009"})]});return Object(u["jsxs"])("div",{className:"report-header",children:[Object(u["jsxs"])("span",{children:["\u5171",(null===t||void 0===t?void 0:t.total)||0,"\u6761\u6570\u636e"]}),Object(u["jsxs"])("div",{children:[Object(u["jsx"])(_,{size:"small",placeholder:"\u641c\u7d22",onSearch:t=>{e.loadReportData(t)},style:{width:200,marginRight:10}}),Object(u["jsx"])(L["a"],{overlay:a,placement:"bottomRight",children:Object(u["jsx"])(U["a"],{style:{cursor:"pointer"}})})]}),Object(u["jsx"])(T.a,{})]})})),A=()=>Object(u["jsx"])(z,{}),V=()=>Object(u["jsx"])("div",{className:"report-container",children:Object(u["jsx"])(b,{})}),K=(a("jpyg"),Object(r["a"])((()=>{var e=Object(s["a"])(),t=Object(i["useMemo"])((()=>new n["a"](e)),[e]);return Object(i["useEffect"])((()=>{t.loadReportData()}),[]),Object(u["jsx"])("div",{className:"survey-report",children:Object(u["jsxs"])(l,{value:t,children:[Object(u["jsx"])(A,{}),Object(u["jsx"])(V,{})]})})})));t["default"]=K},jpyg:function(e,t,a){}}]);